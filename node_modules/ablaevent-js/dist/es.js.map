{"version":3,"file":"es.js","sources":["../src/config.ts","../src/uuidv7.ts","../src/utils.ts","../src/autocapture-utils.ts","../src/extensions/rageclick.ts","../src/storage.ts","../src/posthog-persistence.ts","../src/autocapture.ts","../src/posthog-featureflags.ts","../src/extensions/sessionrecording-utils.ts","../src/extensions/sessionrecording.ts","../src/extensions/web-performance.ts","../src/decide.ts","../src/extensions/cloud.ts","../src/extensions/toolbar.ts","../src/gdpr-utils.ts","../src/base-request-queue.ts","../src/request-queue.ts","../src/capture-metrics.ts","../node_modules/fflate/esm/browser.js","../src/types.ts","../src/send-request.ts","../src/retry-queue.ts","../src/sessionid.ts","../src/extensions/sentry-integration.ts","../src/extensions/segment-integration.ts","../src/page-view-id.ts","../src/extensions/exceptions/type-checking.ts","../src/extensions/exceptions/stack-trace.ts","../src/extensions/exceptions/error-conversion.ts","../src/extensions/exceptions/exception-autocapture.ts","../src/posthog-surveys.ts","../src/posthog-core.ts","../src/rate-limiter.ts","../src/compression.ts","../src/loader-module.ts"],"sourcesContent":["import { version } from '../package.json'\n\n// overriden in posthog-core,\n// e.g.     Config.DEBUG = Config.DEBUG || instance.get_config('debug')\nconst Config = {\n    DEBUG: false,\n    LIB_VERSION: version,\n}\n\nexport default Config\n","/**\n * uuidv7: An experimental implementation of the proposed UUID Version 7\n *\n * @license Apache-2.0\n * @copyright 2021-2023 LiosK\n * @packageDocumentation\n *\n * from https://github.com/LiosK/uuidv7/blob/e501462ea3d23241de13192ceae726956f9b3b7d/src/index.ts\n */\n\n// polyfill for IE11\nif (!Math.trunc) {\n    Math.trunc = function (v) {\n        return v < 0 ? Math.ceil(v) : Math.floor(v)\n    }\n}\n\n// polyfill for IE11\nif (!Number.isInteger) {\n    Number.isInteger = function (value) {\n        return typeof value === 'number' && isFinite(value) && Math.floor(value) === value\n    }\n}\n\nconst DIGITS = '0123456789abcdef'\n\n/** Represents a UUID as a 16-byte byte array. */\nexport class UUID {\n    /** @param bytes - The 16-byte byte array representation. */\n    constructor(readonly bytes: Readonly<Uint8Array>) {\n        if (bytes.length !== 16) {\n            throw new TypeError('not 128-bit length')\n        }\n    }\n\n    /**\n     * Builds a byte array from UUIDv7 field values.\n     *\n     * @param unixTsMs - A 48-bit `unix_ts_ms` field value.\n     * @param randA - A 12-bit `rand_a` field value.\n     * @param randBHi - The higher 30 bits of 62-bit `rand_b` field value.\n     * @param randBLo - The lower 32 bits of 62-bit `rand_b` field value.\n     */\n    static fromFieldsV7(unixTsMs: number, randA: number, randBHi: number, randBLo: number): UUID {\n        if (\n            !Number.isInteger(unixTsMs) ||\n            !Number.isInteger(randA) ||\n            !Number.isInteger(randBHi) ||\n            !Number.isInteger(randBLo) ||\n            unixTsMs < 0 ||\n            randA < 0 ||\n            randBHi < 0 ||\n            randBLo < 0 ||\n            unixTsMs > 0xffff_ffff_ffff ||\n            randA > 0xfff ||\n            randBHi > 0x3fff_ffff ||\n            randBLo > 0xffff_ffff\n        ) {\n            throw new RangeError('invalid field value')\n        }\n\n        const bytes = new Uint8Array(16)\n        bytes[0] = unixTsMs / 2 ** 40\n        bytes[1] = unixTsMs / 2 ** 32\n        bytes[2] = unixTsMs / 2 ** 24\n        bytes[3] = unixTsMs / 2 ** 16\n        bytes[4] = unixTsMs / 2 ** 8\n        bytes[5] = unixTsMs\n        bytes[6] = 0x70 | (randA >>> 8)\n        bytes[7] = randA\n        bytes[8] = 0x80 | (randBHi >>> 24)\n        bytes[9] = randBHi >>> 16\n        bytes[10] = randBHi >>> 8\n        bytes[11] = randBHi\n        bytes[12] = randBLo >>> 24\n        bytes[13] = randBLo >>> 16\n        bytes[14] = randBLo >>> 8\n        bytes[15] = randBLo\n        return new UUID(bytes)\n    }\n\n    /** @returns The 8-4-4-4-12 canonical hexadecimal string representation. */\n    toString(): string {\n        let text = ''\n        for (let i = 0; i < this.bytes.length; i++) {\n            text = text + DIGITS.charAt(this.bytes[i] >>> 4) + DIGITS.charAt(this.bytes[i] & 0xf)\n            if (i === 3 || i === 5 || i === 7 || i === 9) {\n                text += '-'\n            }\n        }\n\n        if (text.length !== 36) {\n            // We saw one customer whose bundling code was mangling the UUID generation\n            // rather than accept a bad UUID, we throw an error here.\n            throw new Error('Invalid UUIDv7 was generated')\n        }\n        return text\n    }\n\n    /** Creates an object from `this`. */\n    clone(): UUID {\n        return new UUID(this.bytes.slice(0))\n    }\n\n    /** Returns true if `this` is equivalent to `other`. */\n    equals(other: UUID): boolean {\n        return this.compareTo(other) === 0\n    }\n\n    /**\n     * Returns a negative integer, zero, or positive integer if `this` is less\n     * than, equal to, or greater than `other`, respectively.\n     */\n    compareTo(other: UUID): number {\n        for (let i = 0; i < 16; i++) {\n            const diff = this.bytes[i] - other.bytes[i]\n            if (diff !== 0) {\n                return Math.sign(diff)\n            }\n        }\n        return 0\n    }\n}\n\n/** Encapsulates the monotonic counter state. */\nclass V7Generator {\n    private timestamp = 0\n    private counter = 0\n    private readonly random = new DefaultRandom()\n\n    /**\n     * Generates a new UUIDv7 object from the current timestamp, or resets the\n     * generator upon significant timestamp rollback.\n     *\n     * This method returns monotonically increasing UUIDs unless the up-to-date\n     * timestamp is significantly (by ten seconds or more) smaller than the one\n     * embedded in the immediately preceding UUID. If such a significant clock\n     * rollback is detected, this method resets the generator and returns a new\n     * UUID based on the current timestamp.\n     */\n    generate(): UUID {\n        const value = this.generateOrAbort()\n        if (value !== undefined) {\n            return value\n        } else {\n            // reset state and resume\n            this.timestamp = 0\n            const valueAfterReset = this.generateOrAbort()\n            if (valueAfterReset === undefined) {\n                throw new Error('Could not generate UUID after timestamp reset')\n            }\n            return valueAfterReset\n        }\n    }\n\n    /**\n     * Generates a new UUIDv7 object from the current timestamp, or returns\n     * `undefined` upon significant timestamp rollback.\n     *\n     * This method returns monotonically increasing UUIDs unless the up-to-date\n     * timestamp is significantly (by ten seconds or more) smaller than the one\n     * embedded in the immediately preceding UUID. If such a significant clock\n     * rollback is detected, this method aborts and returns `undefined`.\n     */\n    generateOrAbort(): UUID | undefined {\n        const MAX_COUNTER = 0x3ff_ffff_ffff\n        const ROLLBACK_ALLOWANCE = 10_000 // 10 seconds\n\n        const ts = Date.now()\n        if (ts > this.timestamp) {\n            this.timestamp = ts\n            this.resetCounter()\n        } else if (ts + ROLLBACK_ALLOWANCE > this.timestamp) {\n            // go on with previous timestamp if new one is not much smaller\n            this.counter++\n            if (this.counter > MAX_COUNTER) {\n                // increment timestamp at counter overflow\n                this.timestamp++\n                this.resetCounter()\n            }\n        } else {\n            // abort if clock went backwards to unbearable extent\n            return undefined\n        }\n\n        return UUID.fromFieldsV7(\n            this.timestamp,\n            Math.trunc(this.counter / 2 ** 30),\n            this.counter & (2 ** 30 - 1),\n            this.random.nextUint32()\n        )\n    }\n\n    /** Initializes the counter at a 42-bit random integer. */\n    private resetCounter(): void {\n        this.counter = this.random.nextUint32() * 0x400 + (this.random.nextUint32() & 0x3ff)\n    }\n}\n\n/** A global flag to force use of cryptographically strong RNG. */\ndeclare const UUIDV7_DENY_WEAK_RNG: boolean\n\n/** Stores `crypto.getRandomValues()` available in the environment. */\nlet getRandomValues: <T extends Uint8Array | Uint32Array>(buffer: T) => T = (buffer) => {\n    // fall back on Math.random() unless the flag is set to true\n    if (typeof UUIDV7_DENY_WEAK_RNG !== 'undefined' && UUIDV7_DENY_WEAK_RNG) {\n        throw new Error('no cryptographically strong RNG available')\n    }\n\n    for (let i = 0; i < buffer.length; i++) {\n        buffer[i] = Math.trunc(Math.random() * 0x1_0000) * 0x1_0000 + Math.trunc(Math.random() * 0x1_0000)\n    }\n    return buffer\n}\n\n// detect Web Crypto API\nif (typeof crypto !== 'undefined' && crypto.getRandomValues) {\n    getRandomValues = (buffer) => crypto.getRandomValues(buffer)\n}\n\n/**\n * Wraps `crypto.getRandomValues()` and compatibles to enable buffering; this\n * uses a small buffer by default to avoid unbearable throughput decline in some\n * environments as well as the waste of time and space for unused values.\n */\nclass DefaultRandom {\n    private readonly buffer = new Uint32Array(8)\n    private cursor = Infinity\n    nextUint32(): number {\n        if (this.cursor >= this.buffer.length) {\n            getRandomValues(this.buffer)\n            this.cursor = 0\n        }\n        return this.buffer[this.cursor++]\n    }\n}\n\nlet defaultGenerator: V7Generator | undefined\n\n/**\n * Generates a UUIDv7 string.\n *\n * @returns The 8-4-4-4-12 canonical hexadecimal string representation\n * (\"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\").\n */\nexport const uuidv7 = (): string => uuidv7obj().toString()\n\n/** Generates a UUIDv7 object. */\nconst uuidv7obj = (): UUID => (defaultGenerator || (defaultGenerator = new V7Generator())).generate()\n","import Config from './config'\nimport { Breaker, EventHandler, Properties, UUIDVersion } from './types'\nimport { uuidv7 } from './uuidv7'\n\n/*\n * Saved references to long variable names, so that closure compiler can\n * minimize file size.\n */\n\nconst ArrayProto = Array.prototype\nconst ObjProto = Object.prototype\nconst toString = ObjProto.toString\nconst hasOwnProperty = ObjProto.hasOwnProperty\nconst win: Window & typeof globalThis = typeof window !== 'undefined' ? window : ({} as typeof window)\nconst navigator = win.navigator || { userAgent: '' }\nconst document = win.document || {}\nconst userAgent = navigator.userAgent\nconst localDomains = ['localhost', '127.0.0.1']\n\nconst nativeForEach = ArrayProto.forEach,\n    nativeIndexOf = ArrayProto.indexOf,\n    nativeIsArray = Array.isArray,\n    breaker: Breaker = {}\n\n// Console override\nconst logger = {\n    /** @type {function(...*)} */\n    log: function (...args: any[]) {\n        if (Config.DEBUG && !_isUndefined(window.console) && window.console) {\n            // Don't log PostHog debug messages in rrweb\n            const log =\n                '__rrweb_original__' in window.console.log\n                    ? (window.console.log as any)['__rrweb_original__']\n                    : window.console.log\n\n            try {\n                log.apply(window.console, args)\n            } catch (err) {\n                _eachArray(args, function (arg) {\n                    log(arg)\n                })\n            }\n        }\n    },\n    /** @type {function(...*)} */\n    error: function (..._args: any[]) {\n        if (Config.DEBUG && !_isUndefined(window.console) && window.console) {\n            const args = ['PostHog error:', ..._args]\n            // Don't log PostHog debug messages in rrweb\n            const error =\n                '__rrweb_original__' in window.console.error\n                    ? (window.console.error as any)['__rrweb_original__']\n                    : window.console.error\n            try {\n                error.apply(window.console, args)\n            } catch (err) {\n                _eachArray(args, function (arg) {\n                    error(arg)\n                })\n            }\n        }\n    },\n    /** @type {function(...*)} */\n    critical: function (..._args: any[]) {\n        if (!_isUndefined(window.console) && window.console) {\n            const args = ['PostHog error:', ..._args]\n            // Don't log PostHog debug messages in rrweb\n            const error =\n                '__rrweb_original__' in window.console.error\n                    ? (window.console.error as any)['__rrweb_original__']\n                    : window.console.error\n            try {\n                error.apply(window.console, args)\n            } catch (err) {\n                _eachArray(args, function (arg) {\n                    error(arg)\n                })\n            }\n        }\n    },\n}\n\n// UNDERSCORE\n// Embed part of the Underscore Library\nexport const _trim = function (str: string): string {\n    return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '')\n}\n\nexport const _bind_instance_methods = function (obj: Record<string, any>): void {\n    for (const func in obj) {\n        if (typeof obj[func] === 'function') {\n            obj[func] = obj[func].bind(obj)\n        }\n    }\n}\n\nexport function _eachArray<E = any>(\n    obj: E[] | null | undefined,\n    iterator: (value: E, key: number) => void | Breaker,\n    thisArg?: any\n): void {\n    if (Array.isArray(obj)) {\n        if (nativeForEach && obj.forEach === nativeForEach) {\n            obj.forEach(iterator, thisArg)\n        } else if ('length' in obj && obj.length === +obj.length) {\n            for (let i = 0, l = obj.length; i < l; i++) {\n                if (i in obj && iterator.call(thisArg, obj[i], i) === breaker) {\n                    return\n                }\n            }\n        }\n    }\n}\n\n/**\n * @param {*=} obj\n * @param {function(...*)=} iterator\n * @param {Object=} thisArg\n */\nexport function _each(obj: any, iterator: (value: any, key: any) => void | Breaker, thisArg?: any): void {\n    if (obj === null || obj === undefined) {\n        return\n    }\n    if (Array.isArray(obj)) {\n        return _eachArray(obj, iterator, thisArg)\n    }\n    for (const key in obj) {\n        if (hasOwnProperty.call(obj, key)) {\n            if (iterator.call(thisArg, obj[key], key) === breaker) {\n                return\n            }\n        }\n    }\n}\n\nexport const _extend = function (obj: Record<string, any>, ...args: Record<string, any>[]): Record<string, any> {\n    _eachArray(args, function (source) {\n        for (const prop in source) {\n            if (source[prop] !== void 0) {\n                obj[prop] = source[prop]\n            }\n        }\n    })\n    return obj\n}\n\nexport const _isArray =\n    nativeIsArray ||\n    function (obj: any): obj is any[] {\n        return toString.call(obj) === '[object Array]'\n    }\n\n// from a comment on http://dbj.org/dbj/?p=286\n// fails on only one very rare and deliberate custom object:\n// let bomb = { toString : undefined, valueOf: function(o) { return \"function BOMBA!\"; }};\nexport const _isFunction = function (f: any): f is (...args: any[]) => any {\n    try {\n        return /^\\s*\\bfunction\\b/.test(f)\n    } catch (x) {\n        return false\n    }\n}\n\nexport const _include = function (\n    obj: null | string | Array<any> | Record<string, any>,\n    target: any\n): boolean | Breaker {\n    let found = false\n    if (obj === null) {\n        return found\n    }\n    if (nativeIndexOf && obj.indexOf === nativeIndexOf) {\n        return obj.indexOf(target) != -1\n    }\n    _each(obj, function (value) {\n        if (found || (found = value === target)) {\n            return breaker\n        }\n        return\n    })\n    return found\n}\n\nexport function _includes<T = any>(str: T[] | string, needle: T): boolean {\n    return (str as any).indexOf(needle) !== -1\n}\n\n/**\n * Object.entries() polyfill\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries\n */\nexport function _entries<T = any>(obj: Record<string, T>): [string, T][] {\n    const ownProps = Object.keys(obj)\n    let i = ownProps.length\n    const resArray = new Array(i) // preallocate the Array\n\n    while (i--) {\n        resArray[i] = [ownProps[i], obj[ownProps[i]]]\n    }\n    return resArray\n}\n\n// Underscore Addons\nexport const _isObject = function (obj: any): obj is Record<string, any> {\n    return obj === Object(obj) && !_isArray(obj)\n}\n\nexport const _isEmptyObject = function (obj: any): obj is Record<string, any> {\n    if (_isObject(obj)) {\n        for (const key in obj) {\n            if (hasOwnProperty.call(obj, key)) {\n                return false\n            }\n        }\n        return true\n    }\n    return false\n}\n\nexport const _isUndefined = function (obj: any): obj is undefined {\n    return obj === void 0\n}\n\nexport const _isString = function (obj: any): obj is string {\n    return toString.call(obj) == '[object String]'\n}\n\nexport const _isDate = function (obj: any): obj is Date {\n    return toString.call(obj) == '[object Date]'\n}\n\nexport const _isNumber = function (obj: any): obj is number {\n    return toString.call(obj) == '[object Number]'\n}\n\nexport const _encodeDates = function (obj: Properties): Properties {\n    _each(obj, function (v, k) {\n        if (_isDate(v)) {\n            obj[k] = _formatDate(v)\n        } else if (_isObject(v)) {\n            obj[k] = _encodeDates(v) // recurse\n        }\n    })\n    return obj\n}\n\nexport const _timestamp = function (): number {\n    Date.now =\n        Date.now ||\n        function () {\n            return +new Date()\n        }\n    return Date.now()\n}\n\nexport const _formatDate = function (d: Date): string {\n    // YYYY-MM-DDTHH:MM:SS in UTC\n    function pad(n: number) {\n        return n < 10 ? '0' + n : n\n    }\n    return (\n        d.getUTCFullYear() +\n        '-' +\n        pad(d.getUTCMonth() + 1) +\n        '-' +\n        pad(d.getUTCDate()) +\n        'T' +\n        pad(d.getUTCHours()) +\n        ':' +\n        pad(d.getUTCMinutes()) +\n        ':' +\n        pad(d.getUTCSeconds())\n    )\n}\n\nexport const _safewrap = function <F extends (...args: any[]) => any = (...args: any[]) => any>(f: F): F {\n    return function (...args) {\n        try {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            return f.apply(this, args)\n        } catch (e) {\n            logger.critical('Implementation error. Please turn on debug and contact support@posthog.com.')\n            logger.critical(e)\n        }\n    } as F\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport const _safewrap_class = function (klass: Function, functions: string[]): void {\n    for (let i = 0; i < functions.length; i++) {\n        klass.prototype[functions[i]] = _safewrap(klass.prototype[functions[i]])\n    }\n}\n\nexport const _safewrap_instance_methods = function (obj: Record<string, any>): void {\n    for (const func in obj) {\n        if (typeof obj[func] === 'function') {\n            obj[func] = _safewrap(obj[func])\n        }\n    }\n}\n\nexport const _strip_empty_properties = function (p: Properties): Properties {\n    const ret: Properties = {}\n    _each(p, function (v, k) {\n        if (_isString(v) && v.length > 0) {\n            ret[k] = v\n        }\n    })\n    return ret\n}\n\n/**\n * Deep copies an object.\n * It handles cycles by replacing all references to them with `undefined`\n * Also supports customizing native values\n *\n * @param value\n * @param customizer\n * @returns {{}|undefined|*}\n */\nfunction deepCircularCopy<T extends Record<string, any> = Record<string, any>>(\n    value: T,\n    customizer?: <K extends keyof T = keyof T>(value: T[K], key?: K) => T[K]\n): T | undefined {\n    const COPY_IN_PROGRESS_SET = new Set()\n\n    function internalDeepCircularCopy(value: T, key?: string): T | undefined {\n        if (value !== Object(value)) return customizer ? customizer(value as any, key) : value // primitive value\n\n        if (COPY_IN_PROGRESS_SET.has(value)) return undefined\n        COPY_IN_PROGRESS_SET.add(value)\n        let result: T\n\n        if (_isArray(value)) {\n            result = [] as any as T\n            _eachArray(value, (it) => {\n                result.push(internalDeepCircularCopy(it))\n            })\n        } else {\n            result = {} as T\n            _each(value, (val, key) => {\n                if (!COPY_IN_PROGRESS_SET.has(val)) {\n                    ;(result as any)[key] = internalDeepCircularCopy(val, key)\n                }\n            })\n        }\n        return result\n    }\n    return internalDeepCircularCopy(value)\n}\n\nconst LONG_STRINGS_ALLOW_LIST = ['$performance_raw']\n\nexport function _copyAndTruncateStrings<T extends Record<string, any> = Record<string, any>>(\n    object: T,\n    maxStringLength: number | null\n): T {\n    return deepCircularCopy(object, (value: any, key) => {\n        if (key && LONG_STRINGS_ALLOW_LIST.indexOf(key as string) > -1) {\n            return value\n        }\n        if (typeof value === 'string' && maxStringLength !== null) {\n            return (value as string).slice(0, maxStringLength)\n        }\n        return value\n    }) as T\n}\n\nexport function _base64Encode(data: null): null\nexport function _base64Encode(data: undefined): undefined\nexport function _base64Encode(data: string): string\nexport function _base64Encode(data: string | null | undefined): string | null | undefined {\n    const b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='\n    let o1,\n        o2,\n        o3,\n        h1,\n        h2,\n        h3,\n        h4,\n        bits,\n        i = 0,\n        ac = 0,\n        enc = ''\n    const tmp_arr: string[] = []\n\n    if (!data) {\n        return data\n    }\n\n    data = _utf8Encode(data)\n\n    do {\n        // pack three octets into four hexets\n        o1 = data.charCodeAt(i++)\n        o2 = data.charCodeAt(i++)\n        o3 = data.charCodeAt(i++)\n\n        bits = (o1 << 16) | (o2 << 8) | o3\n\n        h1 = (bits >> 18) & 0x3f\n        h2 = (bits >> 12) & 0x3f\n        h3 = (bits >> 6) & 0x3f\n        h4 = bits & 0x3f\n\n        // use hexets to index into b64, and append result to encoded string\n        tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4)\n    } while (i < data.length)\n\n    enc = tmp_arr.join('')\n\n    switch (data.length % 3) {\n        case 1:\n            enc = enc.slice(0, -2) + '=='\n            break\n        case 2:\n            enc = enc.slice(0, -1) + '='\n            break\n    }\n\n    return enc\n}\n\nexport const _utf8Encode = function (string: string): string {\n    string = (string + '').replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n')\n\n    let utftext = '',\n        start,\n        end\n    let stringl = 0,\n        n\n\n    start = end = 0\n    stringl = string.length\n\n    for (n = 0; n < stringl; n++) {\n        const c1 = string.charCodeAt(n)\n        let enc = null\n\n        if (c1 < 128) {\n            end++\n        } else if (c1 > 127 && c1 < 2048) {\n            enc = String.fromCharCode((c1 >> 6) | 192, (c1 & 63) | 128)\n        } else {\n            enc = String.fromCharCode((c1 >> 12) | 224, ((c1 >> 6) & 63) | 128, (c1 & 63) | 128)\n        }\n        if (enc !== null) {\n            if (end > start) {\n                utftext += string.substring(start, end)\n            }\n            utftext += enc\n            start = end = n + 1\n        }\n    }\n\n    if (end > start) {\n        utftext += string.substring(start, string.length)\n    }\n\n    return utftext\n}\n\nexport const _UUID = function (defaultVersion?: UUIDVersion) {\n    // Time/ticks information\n    const T = function () {\n        const d = new Date().valueOf()\n        let ticks = 0\n        // performance.now is pretty widely supported\n        // https://developer.mozilla.org/en-US/docs/Web/API/Performance/now\n        if (win.performance && win.performance.now) {\n            // if the environment has a frozen time (e.g. in tests)\n            // then the busy loop below will never complete.\n            // where performance is supported we can use that to\n            // avoid the busy loop (saving a full millisecond)\n            // and avoiding getting stuck in a never ending loop when time is frozen\n            // it returns milliseconds as a float whereas the busy loop counts ticks\n            // there should be 10000 ticks in a millisecond, so we multiply by 10,000\n            ticks = win.performance.now() * 10_000\n        } else {\n            // this while loop figures how many browser ticks go by\n            // before 1*new Date() returns a new number, ie the amount\n            // of ticks that go by per millisecond\n            while (d == new Date().valueOf()) {\n                ticks++\n            }\n        }\n\n        return d.toString(16) + Math.floor(ticks).toString(16)\n    }\n\n    // Math.Random entropy\n    const R = function () {\n        return Math.random().toString(16).replace('.', '')\n    }\n\n    // User agent entropy\n    // This function takes the user agent string, and then xors\n    // together each sequence of 8 bytes.  This produces a final\n    // sequence of 8 bytes which it returns as hex.\n    const UA = function () {\n        const ua = userAgent\n        let i,\n            ch,\n            ret = 0,\n            buffer: number[] = []\n\n        function xor(result: number, byte_array: number[]) {\n            let j,\n                tmp = 0\n            for (j = 0; j < byte_array.length; j++) {\n                tmp |= buffer[j] << (j * 8)\n            }\n            return result ^ tmp\n        }\n\n        for (i = 0; i < ua.length; i++) {\n            ch = ua.charCodeAt(i)\n            buffer.unshift(ch & 0xff)\n            if (buffer.length >= 4) {\n                ret = xor(ret, buffer)\n                buffer = []\n            }\n        }\n\n        if (buffer.length > 0) {\n            ret = xor(ret, buffer)\n        }\n\n        return ret.toString(16)\n    }\n\n    return function (version?: UUIDVersion) {\n        if (version === 'og' || defaultVersion === 'og') {\n            const se = typeof window !== 'undefined' ? (window.screen.height * window.screen.width).toString(16) : '0'\n            return T() + '-' + R() + '-' + UA() + '-' + se + '-' + T()\n        }\n\n        return uuidv7()\n    }\n}\n\n// _.isBlockedUA()\n// This is to block various web spiders from executing our JS and\n// sending false capturing data\nexport const _isBlockedUA = function (ua: string): boolean {\n    if (\n        /(google web preview|baiduspider|yandexbot|bingbot|googlebot|yahoo! slurp|ahrefsbot|facebookexternalhit|facebookcatalog|applebot|semrushbot|duckduckbot|twitterbot|rogerbot|linkedinbot|mj12bot|sitebulb|bot.htm|bot.php|hubspot|crawler|prerender)/i.test(\n            ua\n        )\n    ) {\n        return true\n    }\n    return false\n}\n\n/**\n * @param {Object=} formdata\n * @param {string=} arg_separator\n */\nexport const _HTTPBuildQuery = function (formdata: Record<string, any>, arg_separator = '&'): string {\n    let use_val: string\n    let use_key: string\n    const tph_arr: string[] = []\n\n    _each(formdata, function (val, key) {\n        use_val = encodeURIComponent(val.toString())\n        use_key = encodeURIComponent(key)\n        tph_arr[tph_arr.length] = use_key + '=' + use_val\n    })\n\n    return tph_arr.join(arg_separator)\n}\n\nexport const _getQueryParam = function (url: string, param: string): string {\n    // Expects a raw URL\n\n    const cleanParam = param.replace(/[[]/, '\\\\[').replace(/[\\]]/, '\\\\]')\n    const regexS = '[\\\\?&]' + cleanParam + '=([^&#]*)'\n    const regex = new RegExp(regexS)\n    const results = regex.exec(url)\n    if (results === null || (results && typeof results[1] !== 'string' && (results[1] as any).length)) {\n        return ''\n    } else {\n        let result = results[1]\n        try {\n            result = decodeURIComponent(result)\n        } catch (err) {\n            logger.error('Skipping decoding for malformed query param: ' + result)\n        }\n        return result.replace(/\\+/g, ' ')\n    }\n}\n\nexport const _getHashParam = function (hash: string, param: string): string | null {\n    const matches = hash.match(new RegExp(param + '=([^&]*)'))\n    return matches ? matches[1] : null\n}\n\nexport const _register_event = (function () {\n    // written by Dean Edwards, 2005\n    // with input from Tino Zijdel - crisp@xs4all.nl\n    // with input from Carl Sverre - mail@carlsverre.com\n    // with input from PostHog\n    // http://dean.edwards.name/weblog/2005/10/add-event/\n    // https://gist.github.com/1930440\n\n    /**\n     * @param {Object} element\n     * @param {string} type\n     * @param {function(...*)} handler\n     * @param {boolean=} oldSchool\n     * @param {boolean=} useCapture\n     */\n    const register_event = function (\n        element: Element | Window | Document | Node,\n        type: string,\n        handler: EventHandler,\n        oldSchool?: boolean,\n        useCapture?: boolean\n    ) {\n        if (!element) {\n            logger.error('No valid element provided to register_event')\n            return\n        }\n\n        if (element.addEventListener && !oldSchool) {\n            element.addEventListener(type, handler, !!useCapture)\n        } else {\n            const ontype = 'on' + type\n            const old_handler = (element as any)[ontype] // can be undefined\n            ;(element as any)[ontype] = makeHandler(element, handler, old_handler)\n        }\n    }\n\n    function makeHandler(\n        element: Element | Window | Document | Node,\n        new_handler: EventHandler,\n        old_handlers: EventHandler\n    ) {\n        return function (event: Event): boolean | void {\n            event = event || fixEvent(window.event)\n\n            // this basically happens in firefox whenever another script\n            // overwrites the onload callback and doesn't pass the event\n            // object to previously defined callbacks.  All the browsers\n            // that don't define window.event implement addEventListener\n            // so the dom_loaded handler will still be fired as usual.\n            if (!event) {\n                return undefined\n            }\n\n            let ret = true\n            let old_result: any\n\n            if (_isFunction(old_handlers)) {\n                old_result = old_handlers(event)\n            }\n            const new_result = new_handler.call(element, event)\n\n            if (false === old_result || false === new_result) {\n                ret = false\n            }\n\n            return ret\n        }\n    }\n\n    function fixEvent(event: Event | undefined): Event | undefined {\n        if (event) {\n            event.preventDefault = fixEvent.preventDefault\n            event.stopPropagation = fixEvent.stopPropagation\n        }\n        return event\n    }\n    fixEvent.preventDefault = function () {\n        ;(this as any as Event).returnValue = false\n    }\n    fixEvent.stopPropagation = function () {\n        ;(this as any as Event).cancelBubble = true\n    }\n\n    return register_event\n})()\n\nexport const isLocalhost = (): boolean => {\n    return localDomains.includes(location.hostname)\n}\n\nexport function loadScript(scriptUrlToLoad: string, callback: (error?: string | Event, event?: Event) => void): void {\n    const addScript = () => {\n        const scriptTag = document.createElement('script')\n        scriptTag.type = 'text/javascript'\n        scriptTag.src = scriptUrlToLoad\n        scriptTag.onload = (event) => callback(undefined, event)\n        scriptTag.onerror = (error) => callback(error)\n\n        const scripts = document.querySelectorAll('body > script')\n        if (scripts.length > 0) {\n            scripts[0].parentNode?.insertBefore(scriptTag, scripts[0])\n        } else {\n            // In exceptional situations this call might load before the DOM is fully ready.\n            document.body.appendChild(scriptTag)\n        }\n    }\n\n    if (document.body) {\n        addScript()\n    } else {\n        document.addEventListener('DOMContentLoaded', addScript)\n    }\n}\n\nexport const _info = {\n    campaignParams: function (customParams?: string[]): Record<string, any> {\n        const campaign_keywords = [\n            'utm_source',\n            'utm_medium',\n            'utm_campaign',\n            'utm_content',\n            'utm_term',\n            'gclid',\n            'fbclid',\n            'msclkid',\n        ].concat(customParams || [])\n\n        const params: Record<string, any> = {}\n        _each(campaign_keywords, function (kwkey) {\n            const kw = _getQueryParam(document.URL, kwkey)\n            if (kw.length) {\n                params[kwkey] = kw\n            }\n        })\n\n        return params\n    },\n\n    searchEngine: function (): string | null {\n        const referrer = document.referrer\n        if (!referrer) {\n            return null\n        } else if (referrer.search('https?://(.*)google.([^/?]*)') === 0) {\n            return 'google'\n        } else if (referrer.search('https?://(.*)bing.com') === 0) {\n            return 'bing'\n        } else if (referrer.search('https?://(.*)yahoo.com') === 0) {\n            return 'yahoo'\n        } else if (referrer.search('https?://(.*)duckduckgo.com') === 0) {\n            return 'duckduckgo'\n        } else {\n            return null\n        }\n    },\n\n    searchInfo: function (): Record<string, any> {\n        const search = _info.searchEngine(),\n            param = search != 'yahoo' ? 'q' : 'p',\n            ret: Record<string, any> = {}\n\n        if (search !== null) {\n            ret['$search_engine'] = search\n\n            const keyword = _getQueryParam(document.referrer, param)\n            if (keyword.length) {\n                ret['ph_keyword'] = keyword\n            }\n        }\n\n        return ret\n    },\n\n    /**\n     * This function detects which browser is running this script.\n     * The order of the checks are important since many user agents\n     * include key words used in later checks.\n     */\n    browser: function (user_agent: string, vendor: string, opera?: any): string {\n        vendor = vendor || '' // vendor is undefined for at least IE9\n        if (opera || _includes(user_agent, ' OPR/')) {\n            if (_includes(user_agent, 'Mini')) {\n                return 'Opera Mini'\n            }\n            return 'Opera'\n        } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {\n            return 'BlackBerry'\n        } else if (_includes(user_agent, 'IEMobile') || _includes(user_agent, 'WPDesktop')) {\n            return 'Internet Explorer Mobile'\n        } else if (_includes(user_agent, 'SamsungBrowser/')) {\n            // https://developer.samsung.com/internet/user-agent-string-format\n            return 'Samsung Internet'\n        } else if (_includes(user_agent, 'Edge') || _includes(user_agent, 'Edg/')) {\n            return 'Microsoft Edge'\n        } else if (_includes(user_agent, 'FBIOS')) {\n            return 'Facebook Mobile'\n        } else if (_includes(user_agent, 'Chrome')) {\n            return 'Chrome'\n        } else if (_includes(user_agent, 'CriOS')) {\n            return 'Chrome iOS'\n        } else if (_includes(user_agent, 'UCWEB') || _includes(user_agent, 'UCBrowser')) {\n            return 'UC Browser'\n        } else if (_includes(user_agent, 'FxiOS')) {\n            return 'Firefox iOS'\n        } else if (_includes(vendor, 'Apple')) {\n            if (_includes(user_agent, 'Mobile')) {\n                return 'Mobile Safari'\n            }\n            return 'Safari'\n        } else if (_includes(user_agent, 'Android')) {\n            return 'Android Mobile'\n        } else if (_includes(user_agent, 'Konqueror')) {\n            return 'Konqueror'\n        } else if (_includes(user_agent, 'Firefox')) {\n            return 'Firefox'\n        } else if (_includes(user_agent, 'MSIE') || _includes(user_agent, 'Trident/')) {\n            return 'Internet Explorer'\n        } else if (_includes(user_agent, 'Gecko')) {\n            return 'Mozilla'\n        } else {\n            return ''\n        }\n    },\n\n    /**\n     * This function detects which browser version is running this script,\n     * parsing major and minor version (e.g., 42.1). User agent strings from:\n     * http://www.useragentstring.com/pages/useragentstring.php\n     */\n    browserVersion: function (userAgent: string, vendor: string, opera: string): number | null {\n        const browser = _info.browser(userAgent, vendor, opera)\n        const versionRegexs = {\n            'Internet Explorer Mobile': /rv:(\\d+(\\.\\d+)?)/,\n            'Microsoft Edge': /Edge?\\/(\\d+(\\.\\d+)?)/,\n            Chrome: /Chrome\\/(\\d+(\\.\\d+)?)/,\n            'Chrome iOS': /CriOS\\/(\\d+(\\.\\d+)?)/,\n            'UC Browser': /(UCBrowser|UCWEB)\\/(\\d+(\\.\\d+)?)/,\n            Safari: /Version\\/(\\d+(\\.\\d+)?)/,\n            'Mobile Safari': /Version\\/(\\d+(\\.\\d+)?)/,\n            Opera: /(Opera|OPR)\\/(\\d+(\\.\\d+)?)/,\n            Firefox: /Firefox\\/(\\d+(\\.\\d+)?)/,\n            'Firefox iOS': /FxiOS\\/(\\d+(\\.\\d+)?)/,\n            Konqueror: /Konqueror:(\\d+(\\.\\d+)?)/,\n            BlackBerry: /BlackBerry (\\d+(\\.\\d+)?)/,\n            'Android Mobile': /android\\s(\\d+(\\.\\d+)?)/,\n            'Samsung Internet': /SamsungBrowser\\/(\\d+(\\.\\d+)?)/,\n            'Internet Explorer': /(rv:|MSIE )(\\d+(\\.\\d+)?)/,\n            Mozilla: /rv:(\\d+(\\.\\d+)?)/,\n        }\n        const regex: RegExp | undefined = versionRegexs[browser as keyof typeof versionRegexs]\n        if (regex === undefined) {\n            return null\n        }\n        const matches = userAgent.match(regex)\n        if (!matches) {\n            return null\n        }\n        return parseFloat(matches[matches.length - 2])\n    },\n\n    browserLanguage: function (): string {\n        return (\n            navigator.language || // Any modern browser\n            (navigator as Record<string, any>).userLanguage // IE11\n        )\n    },\n\n    os: function (user_agent: string): { os_name: string; os_version: string } {\n        if (/Windows/i.test(user_agent)) {\n            if (/Phone/.test(user_agent) || /WPDesktop/.test(user_agent)) {\n                return { os_name: 'Windows Phone', os_version: '' }\n            }\n            const match = /Windows NT ([0-9.]+)/i.exec(user_agent)\n            if (match && match[1]) {\n                const version = match[1]\n                return { os_name: 'Windows', os_version: version }\n            }\n            return { os_name: 'Windows', os_version: '' }\n        } else if (/(iPhone|iPad|iPod)/.test(user_agent)) {\n            const match = /OS (\\d+)_(\\d+)_?(\\d+)?/i.exec(user_agent)\n            if (match && match[1]) {\n                const versionParts = [match[1], match[2], match[3] || '0']\n                return { os_name: 'iOS', os_version: versionParts.join('.') }\n            }\n            return { os_name: 'iOS', os_version: '' }\n        } else if (/Android/.test(user_agent)) {\n            const match = /Android (\\d+)\\.(\\d+)\\.?(\\d+)?/i.exec(user_agent)\n            if (match && match[1]) {\n                const versionParts = [match[1], match[2], match[3] || '0']\n                return { os_name: 'Android', os_version: versionParts.join('.') }\n            }\n            return { os_name: 'Android', os_version: '' }\n        } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {\n            return { os_name: 'BlackBerry', os_version: '' }\n        } else if (/Mac/i.test(user_agent)) {\n            const match = /Mac OS X (\\d+)[_.](\\d+)[_.]?(\\d+)?/i.exec(user_agent)\n            if (match && match[1]) {\n                const versionParts = [match[1], match[2], match[3] || '0']\n                return { os_name: 'Mac OS X', os_version: versionParts.join('.') }\n            }\n            return { os_name: 'Mac OS X', os_version: '' }\n        } else if (/Linux/.test(user_agent)) {\n            return { os_name: 'Linux', os_version: '' }\n        } else if (/CrOS/.test(user_agent)) {\n            return { os_name: 'Chrome OS', os_version: '' }\n        } else {\n            return { os_name: '', os_version: '' }\n        }\n    },\n\n    device: function (user_agent: string): string {\n        if (/Windows Phone/i.test(user_agent) || /WPDesktop/.test(user_agent)) {\n            return 'Windows Phone'\n        } else if (/iPad/.test(user_agent)) {\n            return 'iPad'\n        } else if (/iPod/.test(user_agent)) {\n            return 'iPod Touch'\n        } else if (/iPhone/.test(user_agent)) {\n            return 'iPhone'\n        } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {\n            return 'BlackBerry'\n        } else if (/Android/.test(user_agent) && !/Mobile/.test(user_agent)) {\n            return 'Android Tablet'\n        } else if (/Android/.test(user_agent)) {\n            return 'Android'\n        } else {\n            return ''\n        }\n    },\n\n    deviceType: function (user_agent: string): string {\n        const device = this.device(user_agent)\n        if (device === 'iPad' || device === 'Android Tablet') {\n            return 'Tablet'\n        } else if (device) {\n            return 'Mobile'\n        } else {\n            return 'Desktop'\n        }\n    },\n\n    referrer: function (): string {\n        return document.referrer || '$direct'\n    },\n\n    referringDomain: function (): string {\n        if (!document.referrer) {\n            return '$direct'\n        }\n        const parser = document.createElement('a') // Unfortunately we cannot use new URL due to IE11\n        parser.href = document.referrer\n        return parser.host\n    },\n\n    properties: function (): Properties {\n        const { os_name, os_version } = _info.os(userAgent)\n        return _extend(\n            _strip_empty_properties({\n                $os: os_name,\n                $os_version: os_version,\n                $browser: _info.browser(userAgent, navigator.vendor, (win as any).opera),\n                $device: _info.device(userAgent),\n                $device_type: _info.deviceType(userAgent),\n            }),\n            {\n                $current_url: win?.location.href,\n                $host: win?.location.host,\n                $pathname: win?.location.pathname,\n                $browser_version: _info.browserVersion(userAgent, navigator.vendor, (win as any).opera),\n                $browser_language: _info.browserLanguage(),\n                $screen_height: win?.screen.height,\n                $screen_width: win?.screen.width,\n                $viewport_height: win?.innerHeight,\n                $viewport_width: win?.innerWidth,\n                $lib: 'web',\n                $lib_version: Config.LIB_VERSION,\n                $insert_id: Math.random().toString(36).substring(2, 10) + Math.random().toString(36).substring(2, 10),\n                $time: _timestamp() / 1000, // epoch time in seconds\n            }\n        )\n    },\n\n    people_properties: function (): Properties {\n        const { os_name, os_version } = _info.os(userAgent)\n        return _extend(\n            _strip_empty_properties({\n                $os: os_name,\n                $os_version: os_version,\n                $browser: _info.browser(userAgent, navigator.vendor, (win as any).opera),\n            }),\n            {\n                $browser_version: _info.browserVersion(userAgent, navigator.vendor, (win as any).opera),\n            }\n        )\n    },\n}\n\nexport { win as window, userAgent, logger, document }\n","/*\n * Get the className of an element, accounting for edge cases where element.className is an object\n * @param {Element} el - element to get the className of\n * @returns {string} the element's class\n */\nimport { AutocaptureConfig } from 'types'\nimport { _each, _includes, _isUndefined, _trim } from './utils'\n\nexport function getClassName(el: Element): string {\n    switch (typeof el.className) {\n        case 'string':\n            return el.className\n        // TODO: when is this ever used?\n        case 'object': // handle cases where className might be SVGAnimatedString or some other type\n            return ('baseVal' in el.className ? (el.className as any).baseVal : null) || el.getAttribute('class') || ''\n        default:\n            // future proof\n            return ''\n    }\n}\n\n/*\n * Get the direct text content of an element, protecting against sensitive data collection.\n * Concats textContent of each of the element's text node children; this avoids potential\n * collection of sensitive data that could happen if we used element.textContent and the\n * element had sensitive child elements, since element.textContent includes child content.\n * Scrubs values that look like they could be sensitive (i.e. cc or ssn number).\n * @param {Element} el - element to get the text of\n * @returns {string} the element's direct text content\n */\nexport function getSafeText(el: Element): string {\n    let elText = ''\n\n    if (shouldCaptureElement(el) && !isSensitiveElement(el) && el.childNodes && el.childNodes.length) {\n        _each(el.childNodes, function (child) {\n            if (isTextNode(child) && child.textContent) {\n                elText += _trim(child.textContent)\n                    // scrub potentially sensitive values\n                    .split(/(\\s+)/)\n                    .filter(shouldCaptureValue)\n                    .join('')\n                    // normalize whitespace\n                    .replace(/[\\r\\n]/g, ' ')\n                    .replace(/[ ]+/g, ' ')\n                    // truncate\n                    .substring(0, 255)\n            }\n        })\n    }\n\n    return _trim(elText)\n}\n\n/*\n * Check whether an element has nodeType Node.ELEMENT_NODE\n * @param {Element} el - element to check\n * @returns {boolean} whether el is of the correct nodeType\n */\nexport function isElementNode(el: Element | undefined | null): el is HTMLElement {\n    return !!el && el.nodeType === 1 // Node.ELEMENT_NODE - use integer constant for browser portability\n}\n\n/*\n * Check whether an element is of a given tag type.\n * Due to potential reference discrepancies (such as the webcomponents.js polyfill),\n * we want to match tagNames instead of specific references because something like\n * element === document.body won't always work because element might not be a native\n * element.\n * @param {Element} el - element to check\n * @param {string} tag - tag name (e.g., \"div\")\n * @returns {boolean} whether el is of the given tag type\n */\nexport function isTag(el: Element | undefined | null, tag: string): el is HTMLElement {\n    return !!el && !!el.tagName && el.tagName.toLowerCase() === tag.toLowerCase()\n}\n\n/*\n * Check whether an element has nodeType Node.TEXT_NODE\n * @param {Element} el - element to check\n * @returns {boolean} whether el is of the correct nodeType\n */\nexport function isTextNode(el: Element | undefined | null): el is HTMLElement {\n    return !!el && el.nodeType === 3 // Node.TEXT_NODE - use integer constant for browser portability\n}\n\n/*\n * Check whether an element has nodeType Node.DOCUMENT_FRAGMENT_NODE\n * @param {Element} el - element to check\n * @returns {boolean} whether el is of the correct nodeType\n */\nexport function isDocumentFragment(el: Element | ParentNode | undefined | null): el is DocumentFragment {\n    return !!el && el.nodeType === 11 // Node.DOCUMENT_FRAGMENT_NODE - use integer constant for browser portability\n}\n\nexport const autocaptureCompatibleElements = ['a', 'button', 'form', 'input', 'select', 'textarea', 'label']\n/*\n * Check whether a DOM event should be \"captured\" or if it may contain sentitive data\n * using a variety of heuristics.\n * @param {Element} el - element to check\n * @param {Event} event - event to check\n * @param {Object} autocaptureConfig - autocapture config\n * @returns {boolean} whether the event should be captured\n */\nexport function shouldCaptureDomEvent(\n    el: Element,\n    event: Event,\n    autocaptureConfig: AutocaptureConfig | undefined = undefined\n): boolean {\n    if (!el || isTag(el, 'html') || !isElementNode(el)) {\n        return false\n    }\n\n    if (autocaptureConfig?.url_allowlist) {\n        const url = window.location.href\n        const allowlist = autocaptureConfig.url_allowlist\n        if (allowlist && !allowlist.some((regex) => url.match(regex))) {\n            return false\n        }\n    }\n\n    if (autocaptureConfig?.dom_event_allowlist) {\n        const allowlist = autocaptureConfig.dom_event_allowlist\n        if (allowlist && !allowlist.some((eventType) => event.type === eventType)) {\n            return false\n        }\n    }\n\n    if (autocaptureConfig?.element_allowlist) {\n        const allowlist = autocaptureConfig.element_allowlist\n        if (allowlist && !allowlist.some((elementType) => el.tagName.toLowerCase() === elementType)) {\n            return false\n        }\n    }\n\n    if (autocaptureConfig?.css_selector_allowlist) {\n        const allowlist = autocaptureConfig.css_selector_allowlist\n        if (allowlist && !allowlist.some((selector) => el.matches(selector))) {\n            return false\n        }\n    }\n\n    let parentIsUsefulElement = false\n    const targetElementList: Element[] = [el] // TODO: remove this var, it's never queried\n    let parentNode: Element | boolean = true\n    let curEl: Element = el\n    while (curEl.parentNode && !isTag(curEl, 'body')) {\n        // If element is a shadow root, we skip it\n        if (isDocumentFragment(curEl.parentNode)) {\n            targetElementList.push((curEl.parentNode as any).host)\n            curEl = (curEl.parentNode as any).host\n            continue\n        }\n        parentNode = (curEl.parentNode as Element) || false\n        if (!parentNode) break\n        if (autocaptureCompatibleElements.indexOf(parentNode.tagName.toLowerCase()) > -1) {\n            parentIsUsefulElement = true\n        } else {\n            const compStyles = window.getComputedStyle(parentNode)\n            if (compStyles && compStyles.getPropertyValue('cursor') === 'pointer') {\n                parentIsUsefulElement = true\n            }\n        }\n\n        targetElementList.push(parentNode)\n        curEl = parentNode\n    }\n\n    const compStyles = window.getComputedStyle(el)\n    if (compStyles && compStyles.getPropertyValue('cursor') === 'pointer' && event.type === 'click') {\n        return true\n    }\n\n    const tag = el.tagName.toLowerCase()\n    switch (tag) {\n        case 'html':\n            return false\n        case 'form':\n            return event.type === 'submit'\n        case 'input':\n            return event.type === 'change' || event.type === 'click'\n        case 'select':\n        case 'textarea':\n            return event.type === 'change' || event.type === 'click'\n        default:\n            if (parentIsUsefulElement) return event.type === 'click'\n            return (\n                event.type === 'click' &&\n                (autocaptureCompatibleElements.indexOf(tag) > -1 || el.getAttribute('contenteditable') === 'true')\n            )\n    }\n}\n\n/*\n * Check whether a DOM element should be \"captured\" or if it may contain sentitive data\n * using a variety of heuristics.\n * @param {Element} el - element to check\n * @returns {boolean} whether the element should be captured\n */\nexport function shouldCaptureElement(el: Element): boolean {\n    for (let curEl = el; curEl.parentNode && !isTag(curEl, 'body'); curEl = curEl.parentNode as Element) {\n        const classes = getClassName(curEl).split(' ')\n        if (_includes(classes, 'ph-sensitive') || _includes(classes, 'ph-no-capture')) {\n            return false\n        }\n    }\n\n    if (_includes(getClassName(el).split(' '), 'ph-include')) {\n        return true\n    }\n\n    // don't include hidden or password fields\n    const type = (el as HTMLInputElement).type || ''\n    if (typeof type === 'string') {\n        // it's possible for el.type to be a DOM element if el is a form with a child input[name=\"type\"]\n        switch (type.toLowerCase()) {\n            case 'hidden':\n                return false\n            case 'password':\n                return false\n        }\n    }\n\n    // filter out data from fields that look like sensitive fields\n    const name = (el as HTMLInputElement).name || el.id || ''\n    // See https://github.com/AblaAnalytics/ablaevent-js/issues/165\n    // Under specific circumstances a bug caused .replace to be called on a DOM element\n    // instead of a string, removing the element from the page. Ensure this issue is mitigated.\n    if (typeof name === 'string') {\n        // it's possible for el.name or el.id to be a DOM element if el is a form with a child input[name=\"name\"]\n        const sensitiveNameRegex =\n            /^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i\n        if (sensitiveNameRegex.test(name.replace(/[^a-zA-Z0-9]/g, ''))) {\n            return false\n        }\n    }\n\n    return true\n}\n\n/*\n * Check whether a DOM element is 'sensitive' and we should only capture limited data\n * @param {Element} el - element to check\n * @returns {boolean} whether the element should be captured\n */\nexport function isSensitiveElement(el: Element): boolean {\n    // don't send data from inputs or similar elements since there will always be\n    // a risk of clientside javascript placing sensitive data in attributes\n    const allowedInputTypes = ['button', 'checkbox', 'submit', 'reset']\n    if (\n        (isTag(el, 'input') && !allowedInputTypes.includes((el as HTMLInputElement).type)) ||\n        isTag(el, 'select') ||\n        isTag(el, 'textarea') ||\n        el.getAttribute('contenteditable') === 'true'\n    ) {\n        return true\n    }\n    return false\n}\n\n/*\n * Check whether a string value should be \"captured\" or if it may contain sentitive data\n * using a variety of heuristics.\n * @param {string} value - string value to check\n * @returns {boolean} whether the element should be captured\n */\nexport function shouldCaptureValue(value: string): boolean {\n    if (value === null || _isUndefined(value)) {\n        return false\n    }\n\n    if (typeof value === 'string') {\n        value = _trim(value)\n\n        // check to see if input value looks like a credit card number\n        // see: https://www.safaribooksonline.com/library/view/regular-expressions-cookbook/9781449327453/ch04s20.html\n        const ccRegex =\n            /^(?:(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11}))$/\n        if (ccRegex.test((value || '').replace(/[- ]/g, ''))) {\n            return false\n        }\n\n        // check to see if input value looks like a social security number\n        const ssnRegex = /(^\\d{3}-?\\d{2}-?\\d{4}$)/\n        if (ssnRegex.test(value)) {\n            return false\n        }\n    }\n\n    return true\n}\n\n/*\n * Check whether an attribute name is an Angular style attr (either _ngcontent or _nghost)\n * These update on each build and lead to noise in the element chain\n * More details on the attributes here: https://angular.io/guide/view-encapsulation\n * @param {string} attributeName - string value to check\n * @returns {boolean} whether the element is an angular tag\n */\nexport function isAngularStyleAttr(attributeName: string): boolean {\n    if (typeof attributeName === 'string') {\n        return attributeName.substring(0, 10) === '_ngcontent' || attributeName.substring(0, 7) === '_nghost'\n    }\n    return false\n}\n\n/*\n * Iterate through children of a target element looking for span tags\n * and return the text content of the span tags, separated by spaces,\n * along with the direct text content of the target element\n * @param {Element} target - element to check\n * @returns {string} text content of the target element and its child span tags\n */\nexport function getDirectAndNestedSpanText(target: Element): string {\n    let text = getSafeText(target)\n    text = `${text} ${getNestedSpanText(target)}`.trim()\n    return shouldCaptureValue(text) ? text : ''\n}\n\n/*\n * Iterate through children of a target element looking for span tags\n * and return the text content of the span tags, separated by spaces\n * @param {Element} target - element to check\n * @returns {string} text content of span tags\n */\nexport function getNestedSpanText(target: Element): string {\n    let text = ''\n    if (target && target.childNodes && target.childNodes.length) {\n        _each(target.childNodes, function (child) {\n            if (child && child.tagName?.toLowerCase() === 'span') {\n                try {\n                    const spanText = getSafeText(child)\n                    text = `${text} ${spanText}`.trim()\n\n                    if (child.childNodes && child.childNodes.length) {\n                        text = `${text} ${getNestedSpanText(child)}`.trim()\n                    }\n                } catch (e) {\n                    console.error(e)\n                }\n            }\n        })\n    }\n    return text\n}\n","// Naive rage click implementation: If mouse has not moved than RAGE_CLICK_THRESHOLD_PX\n// over RAGE_CLICK_CLICK_COUNT clicks with max RAGE_CLICK_TIMEOUT_MS between clicks, it's\n// counted as a rage click\n\nconst RAGE_CLICK_THRESHOLD_PX = 30\nconst RAGE_CLICK_TIMEOUT_MS = 1000\nconst RAGE_CLICK_CLICK_COUNT = 3\n\nexport default class RageClick {\n    clicks: { x: number; y: number; timestamp: number }[]\n    enabled: boolean\n\n    constructor(enabled: boolean) {\n        this.clicks = []\n        this.enabled = enabled\n    }\n\n    isRageClick(x: number, y: number, timestamp: number): boolean {\n        if (!this.enabled) {\n            return false\n        }\n\n        const lastClick = this.clicks[this.clicks.length - 1]\n        if (\n            lastClick &&\n            Math.abs(x - lastClick.x) + Math.abs(y - lastClick.y) < RAGE_CLICK_THRESHOLD_PX &&\n            timestamp - lastClick.timestamp < RAGE_CLICK_TIMEOUT_MS\n        ) {\n            this.clicks.push({ x, y, timestamp })\n\n            if (this.clicks.length === RAGE_CLICK_CLICK_COUNT) {\n                return true\n            }\n        } else {\n            this.clicks = [{ x, y, timestamp }]\n        }\n\n        return false\n    }\n}\n","import { _extend, logger } from './utils'\nimport { PersistentStore, Properties } from './types'\nimport Config from './config'\n\nconst DOMAIN_MATCH_REGEX = /[a-z0-9][a-z0-9-]+\\.[a-z.]{2,6}$/i\n\n// Methods partially borrowed from quirksmode.org/js/cookies.html\nexport const cookieStore: PersistentStore = {\n    is_supported: () => true,\n\n    error: function (msg) {\n        logger.error('cookieStore error: ' + msg)\n    },\n\n    get: function (name) {\n        try {\n            const nameEQ = name + '='\n            const ca = document.cookie.split(';')\n            for (let i = 0; i < ca.length; i++) {\n                let c = ca[i]\n                while (c.charAt(0) == ' ') {\n                    c = c.substring(1, c.length)\n                }\n                if (c.indexOf(nameEQ) === 0) {\n                    return decodeURIComponent(c.substring(nameEQ.length, c.length))\n                }\n            }\n        } catch (err) {}\n        return null\n    },\n\n    parse: function (name) {\n        let cookie\n        try {\n            cookie = JSON.parse(cookieStore.get(name)) || {}\n        } catch (err) {\n            // noop\n        }\n        return cookie\n    },\n\n    set: function (name, value, days, cross_subdomain, is_secure) {\n        try {\n            let cdomain = '',\n                expires = '',\n                secure = ''\n\n            if (cross_subdomain) {\n                const matches = document.location.hostname.match(DOMAIN_MATCH_REGEX),\n                    domain = matches ? matches[0] : ''\n\n                cdomain = domain ? '; domain=.' + domain : ''\n            }\n\n            if (days) {\n                const date = new Date()\n                date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000)\n                expires = '; expires=' + date.toUTCString()\n            }\n\n            if (is_secure) {\n                secure = '; secure'\n            }\n\n            const new_cookie_val =\n                name +\n                '=' +\n                encodeURIComponent(JSON.stringify(value)) +\n                expires +\n                '; SameSite=Lax; path=/' +\n                cdomain +\n                secure\n            document.cookie = new_cookie_val\n            return new_cookie_val\n        } catch (err) {\n            return\n        }\n    },\n\n    remove: function (name, cross_subdomain) {\n        try {\n            cookieStore.set(name, '', -1, cross_subdomain)\n        } catch (err) {\n            return\n        }\n    },\n}\n\nlet _localStorage_supported: boolean | null = null\n\nexport const localStore: PersistentStore = {\n    is_supported: function () {\n        if (_localStorage_supported !== null) {\n            return _localStorage_supported\n        }\n\n        let supported = true\n        if (typeof window !== 'undefined') {\n            try {\n                const key = '__mplssupport__',\n                    val = 'xyz'\n                localStore.set(key, val)\n                if (localStore.get(key) !== '\"xyz\"') {\n                    supported = false\n                }\n                localStore.remove(key)\n            } catch (err) {\n                supported = false\n            }\n        } else {\n            supported = false\n        }\n        if (!supported) {\n            logger.error('localStorage unsupported; falling back to cookie store')\n        }\n\n        _localStorage_supported = supported\n        return supported\n    },\n\n    error: function (msg) {\n        logger.error('localStorage error: ' + msg)\n    },\n\n    get: function (name) {\n        try {\n            return window.localStorage.getItem(name)\n        } catch (err) {\n            localStore.error(err)\n        }\n        return null\n    },\n\n    parse: function (name) {\n        try {\n            return JSON.parse(localStore.get(name)) || {}\n        } catch (err) {\n            // noop\n        }\n        return null\n    },\n\n    set: function (name, value) {\n        try {\n            window.localStorage.setItem(name, JSON.stringify(value))\n        } catch (err) {\n            localStore.error(err)\n        }\n    },\n\n    remove: function (name) {\n        try {\n            window.localStorage.removeItem(name)\n        } catch (err) {\n            localStore.error(err)\n        }\n    },\n}\n\n// Use localstorage for most data but still use cookie for distinct_id\n// This solves issues with cookies having too much data in them causing headers too large\n// Also makes sure we don't have to send a ton of data to the server\nexport const localPlusCookieStore: PersistentStore = {\n    ...localStore,\n    parse: function (name) {\n        try {\n            let extend: Properties = {}\n            try {\n                // See if there's a cookie stored with data.\n                extend = cookieStore.parse(name) || {}\n                if (extend['distinct_id']) {\n                    cookieStore.set(name, { distinct_id: extend['distinct_id'] })\n                }\n            } catch (err) {}\n            const value = _extend(extend, JSON.parse(localStore.get(name) || '{}'))\n            localStore.set(name, value)\n            return value\n        } catch (err) {\n            // noop\n        }\n        return null\n    },\n\n    set: function (name, value, days, cross_subdomain, is_secure) {\n        try {\n            localStore.set(name, value)\n            if (value.distinct_id) {\n                cookieStore.set(name, { distinct_id: value.distinct_id }, days, cross_subdomain, is_secure)\n            }\n        } catch (err) {\n            localStore.error(err)\n        }\n    },\n\n    remove: function (name, cross_subdomain) {\n        try {\n            window.localStorage.removeItem(name)\n            cookieStore.remove(name, cross_subdomain)\n        } catch (err) {\n            localStore.error(err)\n        }\n    },\n}\n\nconst memoryStorage: Properties = {}\n\n// Storage that only lasts the length of the pageview if we don't want to use cookies\nexport const memoryStore: PersistentStore = {\n    is_supported: function () {\n        return true\n    },\n\n    error: function (msg) {\n        logger.error('memoryStorage error: ' + msg)\n    },\n\n    get: function (name) {\n        return memoryStorage[name] || null\n    },\n\n    parse: function (name) {\n        return memoryStorage[name] || null\n    },\n\n    set: function (name, value) {\n        memoryStorage[name] = value\n    },\n\n    remove: function (name) {\n        delete memoryStorage[name]\n    },\n}\n\nlet sessionStorageSupported: boolean | null = null\nexport const resetSessionStorageSupported = () => {\n    sessionStorageSupported = null\n}\n// Storage that only lasts the length of a tab/window. Survives page refreshes\nexport const sessionStore: PersistentStore = {\n    is_supported: function () {\n        if (sessionStorageSupported !== null) {\n            return sessionStorageSupported\n        }\n        sessionStorageSupported = true\n        if (typeof window !== 'undefined') {\n            try {\n                const key = '__support__',\n                    val = 'xyz'\n                sessionStore.set(key, val)\n                if (sessionStore.get(key) !== '\"xyz\"') {\n                    sessionStorageSupported = false\n                }\n                sessionStore.remove(key)\n            } catch (err) {\n                sessionStorageSupported = false\n            }\n        } else {\n            sessionStorageSupported = false\n        }\n        return sessionStorageSupported\n    },\n\n    error: function (msg) {\n        if (Config.DEBUG) {\n            logger.error('sessionStorage error: ', msg)\n        }\n    },\n\n    get: function (name) {\n        try {\n            return window.sessionStorage.getItem(name)\n        } catch (err) {\n            sessionStore.error(err)\n        }\n        return null\n    },\n\n    parse: function (name) {\n        try {\n            return JSON.parse(sessionStore.get(name)) || null\n        } catch (err) {\n            // noop\n        }\n        return null\n    },\n\n    set: function (name, value) {\n        try {\n            window.sessionStorage.setItem(name, JSON.stringify(value))\n        } catch (err) {\n            sessionStore.error(err)\n        }\n    },\n\n    remove: function (name) {\n        try {\n            window.sessionStorage.removeItem(name)\n        } catch (err) {\n            sessionStore.error(err)\n        }\n    },\n}\n","/* eslint camelcase: \"off\" */\n\nimport { _each, _extend, _include, _info, _isObject, _isUndefined, _strip_empty_properties, logger } from './utils'\nimport { cookieStore, localStore, localPlusCookieStore, memoryStore, sessionStore } from './storage'\nimport { PersistentStore, PostHogConfig, Properties } from './types'\n\n/*\n * Constants\n */\n// This key is deprecated, but we want to check for it to see whether aliasing is allowed.\nexport const PEOPLE_DISTINCT_ID_KEY = '$people_distinct_id'\nexport const ALIAS_ID_KEY = '__alias'\nexport const CAMPAIGN_IDS_KEY = '__cmpns'\nexport const EVENT_TIMERS_KEY = '__timers'\nexport const AUTOCAPTURE_DISABLED_SERVER_SIDE = '$autocapture_disabled_server_side'\nexport const SESSION_RECORDING_ENABLED_SERVER_SIDE = '$session_recording_enabled_server_side'\nexport const CONSOLE_LOG_RECORDING_ENABLED_SERVER_SIDE = '$console_log_recording_enabled_server_side'\nexport const SESSION_RECORDING_RECORDER_VERSION_SERVER_SIDE = '$session_recording_recorder_version_server_side' // follows rrweb versioning\nexport const SESSION_ID = '$sesid'\nexport const ENABLED_FEATURE_FLAGS = '$enabled_feature_flags'\nexport const PERSISTENCE_EARLY_ACCESS_FEATURES = '$early_access_features'\nexport const STORED_PERSON_PROPERTIES_KEY = '$stored_person_properties'\nexport const STORED_GROUP_PROPERTIES_KEY = '$stored_group_properties'\nexport const SURVEYS = '$surveys'\nexport const FLAG_CALL_REPORTED = '$flag_call_reported'\n\nconst USER_STATE = '$user_state'\nconst POSTHOG_QUOTA_LIMITED = '$posthog_quota_limited'\n\nexport const RESERVED_PROPERTIES = [\n    PEOPLE_DISTINCT_ID_KEY,\n    ALIAS_ID_KEY,\n    CAMPAIGN_IDS_KEY,\n    EVENT_TIMERS_KEY,\n    SESSION_RECORDING_ENABLED_SERVER_SIDE,\n    SESSION_ID,\n    ENABLED_FEATURE_FLAGS,\n    USER_STATE,\n    POSTHOG_QUOTA_LIMITED,\n    PERSISTENCE_EARLY_ACCESS_FEATURES,\n    STORED_GROUP_PROPERTIES_KEY,\n    STORED_PERSON_PROPERTIES_KEY,\n    SURVEYS,\n    FLAG_CALL_REPORTED,\n]\n\nconst CASE_INSENSITIVE_PERSISTENCE_TYPES: readonly Lowercase<PostHogConfig['persistence']>[] = [\n    'cookie',\n    'localstorage',\n    'localstorage+cookie',\n    'sessionstorage',\n    'memory',\n]\n\n/**\n * PostHog Persistence Object\n * @constructor\n */\nexport class PostHogPersistence {\n    props: Properties\n    storage: PersistentStore\n    campaign_params_saved: boolean\n    custom_campaign_params: string[]\n    name: string\n    disabled: boolean | undefined\n    secure: boolean | undefined\n    expire_days: number | undefined\n    default_expiry: number | undefined\n    cross_subdomain: boolean | undefined\n    user_state: 'anonymous' | 'identified'\n\n    constructor(config: PostHogConfig) {\n        // clean chars that aren't accepted by the http spec for cookie values\n        // https://datatracker.ietf.org/doc/html/rfc2616#section-2.2\n        let token = ''\n\n        if (config['token']) {\n            token = config['token'].replace(/\\+/g, 'PL').replace(/\\//g, 'SL').replace(/=/g, 'EQ')\n        }\n\n        this.props = {}\n        this.campaign_params_saved = false\n        this.custom_campaign_params = config['custom_campaign_params'] || []\n\n        if (config['persistence_name']) {\n            this.name = 'ph_' + config['persistence_name']\n        } else {\n            this.name = 'ph_' + token + '_posthog'\n        }\n\n        if (\n            CASE_INSENSITIVE_PERSISTENCE_TYPES.indexOf(\n                config['persistence'].toLowerCase() as Lowercase<PostHogConfig['persistence']>\n            ) === -1\n        ) {\n            logger.critical('Unknown persistence type ' + config['persistence'] + '; falling back to cookie')\n            config['persistence'] = 'cookie'\n        }\n        // We handle storage type in a case-insensitive way for backwards compatibility\n        const storage_type = config['persistence'].toLowerCase() as Lowercase<PostHogConfig['persistence']>\n        if (storage_type === 'localstorage' && localStore.is_supported()) {\n            this.storage = localStore\n        } else if (storage_type === 'localstorage+cookie' && localPlusCookieStore.is_supported()) {\n            this.storage = localPlusCookieStore\n        } else if (storage_type === 'sessionstorage' && sessionStore.is_supported()) {\n            this.storage = sessionStore\n        } else if (storage_type === 'memory') {\n            this.storage = memoryStore\n        } else {\n            this.storage = cookieStore\n        }\n\n        this.user_state = 'anonymous'\n\n        this.load()\n        this.update_config(config)\n        this.save()\n    }\n\n    properties(): Properties {\n        const p: Properties = {}\n        // Filter out reserved properties\n        _each(this.props, function (v, k) {\n            if (k === ENABLED_FEATURE_FLAGS && typeof v === 'object') {\n                const keys = Object.keys(v)\n                for (let i = 0; i < keys.length; i++) {\n                    p[`$feature/${keys[i]}`] = v[keys[i]]\n                }\n            } else if (!_include(RESERVED_PROPERTIES, k)) {\n                p[k] = v\n            }\n        })\n        return p\n    }\n\n    load(): void {\n        if (this.disabled) {\n            return\n        }\n\n        const entry = this.storage.parse(this.name)\n\n        if (entry) {\n            this.props = _extend({}, entry)\n        }\n    }\n\n    /**\n     * NOTE: Saving frequently causes issues with Recordings and Consent Management Platform (CMP) tools which\n     * observe cookie changes, and modify their UI, often causing infinite loops.\n     * As such callers of this should ideally check that the data has changed beforehand\n     */\n    save(): void {\n        if (this.disabled) {\n            return\n        }\n        this.storage.set(this.name, this.props, this.expire_days, this.cross_subdomain, this.secure)\n    }\n\n    remove(): void {\n        // remove both domain and subdomain cookies\n        this.storage.remove(this.name, false)\n        this.storage.remove(this.name, true)\n    }\n\n    // removes the storage entry and deletes all loaded data\n    // forced name for tests\n\n    clear(): void {\n        this.remove()\n        this.props = {}\n    }\n\n    /**\n     * @param {Object} props\n     * @param {*=} default_value\n     * @param {number=} days\n     */\n\n    register_once(props: Properties, default_value: any, days?: number): boolean {\n        if (_isObject(props)) {\n            if (typeof default_value === 'undefined') {\n                default_value = 'None'\n            }\n            this.expire_days = typeof days === 'undefined' ? this.default_expiry : days\n\n            let hasChanges = false\n\n            _each(props, (val, prop) => {\n                if (!this.props.hasOwnProperty(prop) || this.props[prop] === default_value) {\n                    this.props[prop] = val\n                    hasChanges = true\n                }\n            })\n\n            if (hasChanges) {\n                this.save()\n                return true\n            }\n        }\n        return false\n    }\n\n    /**\n     * @param {Object} props\n     * @param {number=} days\n     */\n\n    register(props: Properties, days?: number): boolean {\n        if (_isObject(props)) {\n            this.expire_days = typeof days === 'undefined' ? this.default_expiry : days\n\n            let hasChanges = false\n\n            _each(props, (val, prop) => {\n                if (props.hasOwnProperty(prop) && this.props[prop] !== val) {\n                    this.props[prop] = val\n                    hasChanges = true\n                }\n            })\n\n            if (hasChanges) {\n                this.save()\n                return true\n            }\n        }\n        return false\n    }\n\n    unregister(prop: string): void {\n        if (prop in this.props) {\n            delete this.props[prop]\n            this.save()\n        }\n    }\n\n    update_campaign_params(): void {\n        if (!this.campaign_params_saved) {\n            this.register(_info.campaignParams(this.custom_campaign_params))\n            this.campaign_params_saved = true\n        }\n    }\n\n    update_search_keyword(): void {\n        this.register(_info.searchInfo())\n    }\n\n    update_referrer_info(): void {\n        this.register({\n            $referrer: this.props['$referrer'] || _info.referrer(),\n            $referring_domain: this.props['$referring_domain'] || _info.referringDomain(),\n        })\n    }\n\n    get_referrer_info(): Properties {\n        return _strip_empty_properties({\n            $referrer: this['props']['$referrer'],\n            $referring_domain: this['props']['$referring_domain'],\n        })\n    }\n\n    // safely fills the passed in object with stored properties,\n    // does not override any properties defined in both\n    // returns the passed in object\n\n    safe_merge(props: Properties): Properties {\n        _each(this.props, function (val, prop) {\n            if (!(prop in props)) {\n                props[prop] = val\n            }\n        })\n\n        return props\n    }\n\n    update_config(config: PostHogConfig): void {\n        this.default_expiry = this.expire_days = config['cookie_expiration']\n        this.set_disabled(config['disable_persistence'])\n        this.set_cross_subdomain(config['cross_subdomain_cookie'])\n        this.set_secure(config['secure_cookie'])\n    }\n\n    set_disabled(disabled: boolean): void {\n        this.disabled = disabled\n        if (this.disabled) {\n            this.remove()\n        } else {\n            this.save()\n        }\n    }\n\n    set_cross_subdomain(cross_subdomain: boolean): void {\n        if (cross_subdomain !== this.cross_subdomain) {\n            this.cross_subdomain = cross_subdomain\n            this.remove()\n            this.save()\n        }\n    }\n\n    get_cross_subdomain(): boolean {\n        return !!this.cross_subdomain\n    }\n\n    set_secure(secure: boolean): void {\n        if (secure !== this.secure) {\n            this.secure = secure\n            this.remove()\n            this.save()\n        }\n    }\n\n    set_event_timer(event_name: string, timestamp: number): void {\n        const timers = this.props[EVENT_TIMERS_KEY] || {}\n        timers[event_name] = timestamp\n        this.props[EVENT_TIMERS_KEY] = timers\n        this.save()\n    }\n\n    remove_event_timer(event_name: string): number {\n        const timers = this.props[EVENT_TIMERS_KEY] || {}\n        const timestamp = timers[event_name]\n        if (!_isUndefined(timestamp)) {\n            delete this.props[EVENT_TIMERS_KEY][event_name]\n            this.save()\n        }\n        return timestamp\n    }\n\n    get_user_state(): 'anonymous' | 'identified' {\n        return this.props[USER_STATE] || 'anonymous'\n    }\n\n    set_user_state(state: 'anonymous' | 'identified'): void {\n        this.props[USER_STATE] = state\n        this.save()\n    }\n\n    get_quota_limits(): Record<string, number> {\n        return this.props[POSTHOG_QUOTA_LIMITED] || {}\n    }\n\n    set_quota_limits(state: Record<string, number>): void {\n        this.props[POSTHOG_QUOTA_LIMITED] = state\n        this.save()\n    }\n}\n","import {\n    _bind_instance_methods,\n    _each,\n    _extend,\n    _includes,\n    _isFunction,\n    _isUndefined,\n    _register_event,\n    _safewrap_instance_methods,\n    logger,\n} from './utils'\nimport {\n    getClassName,\n    getSafeText,\n    isElementNode,\n    isSensitiveElement,\n    isTag,\n    isTextNode,\n    shouldCaptureDomEvent,\n    shouldCaptureElement,\n    shouldCaptureValue,\n    autocaptureCompatibleElements,\n    isAngularStyleAttr,\n    isDocumentFragment,\n    getDirectAndNestedSpanText,\n} from './autocapture-utils'\nimport RageClick from './extensions/rageclick'\nimport { AutocaptureConfig, AutoCaptureCustomProperty, DecideResponse, Properties } from './types'\nimport { PostHog } from './posthog-core'\nimport { AUTOCAPTURE_DISABLED_SERVER_SIDE } from './posthog-persistence'\n\nconst autocapture = {\n    _initializedTokens: [] as string[],\n    _isDisabledServerSide: null as boolean | null,\n    _isAutocaptureEnabled: false as boolean,\n\n    _setIsAutocaptureEnabled: function (instance: PostHog): void {\n        const disabled_server_side =\n            this._isDisabledServerSide === null\n                ? !!instance.persistence?.props[AUTOCAPTURE_DISABLED_SERVER_SIDE]\n                : this._isDisabledServerSide\n        const enabled_client_side = !!instance.get_config('autocapture')\n        this._isAutocaptureEnabled = enabled_client_side && !disabled_server_side\n    },\n\n    _previousElementSibling: function (el: Element): Element | null {\n        if (el.previousElementSibling) {\n            return el.previousElementSibling\n        } else {\n            let _el: Element | null = el\n            do {\n                _el = _el.previousSibling as Element | null // resolves to ChildNode->Node, which is Element's parent class\n            } while (_el && !isElementNode(_el))\n            return _el\n        }\n    },\n\n    _getAugmentPropertiesFromElement: function (elem: Element): Properties {\n        const shouldCaptureEl = shouldCaptureElement(elem)\n        if (!shouldCaptureEl) {\n            return {}\n        }\n\n        const props: Properties = {}\n\n        _each(elem.attributes, function (attr: Attr) {\n            if (attr.name.indexOf('data-ph-capture-attribute') === 0) {\n                const propertyKey = attr.name.replace('data-ph-capture-attribute-', '')\n                const propertyValue = attr.value\n                if (propertyKey && propertyValue && shouldCaptureValue(propertyValue)) {\n                    props[propertyKey] = propertyValue\n                }\n            }\n        })\n        return props\n    },\n\n    _getPropertiesFromElement: function (elem: Element, maskInputs: boolean, maskText: boolean): Properties {\n        const tag_name = elem.tagName.toLowerCase()\n        const props: Properties = {\n            tag_name: tag_name,\n        }\n        if (autocaptureCompatibleElements.indexOf(tag_name) > -1 && !maskText) {\n            if (tag_name.toLowerCase() === 'a' || tag_name.toLowerCase() === 'button') {\n                props['$el_text'] = getDirectAndNestedSpanText(elem)\n            } else {\n                props['$el_text'] = getSafeText(elem)\n            }\n        }\n\n        const classes = getClassName(elem)\n        if (classes.length > 0)\n            props['classes'] = classes.split(' ').filter(function (c) {\n                return c !== ''\n            })\n\n        _each(elem.attributes, function (attr: Attr) {\n            // Only capture attributes we know are safe\n            if (isSensitiveElement(elem) && ['name', 'id', 'class'].indexOf(attr.name) === -1) return\n\n            if (!maskInputs && shouldCaptureValue(attr.value) && !isAngularStyleAttr(attr.name)) {\n                props['attr__' + attr.name] = attr.value\n            }\n        })\n\n        let nthChild = 1\n        let nthOfType = 1\n        let currentElem: Element | null = elem\n        while ((currentElem = this._previousElementSibling(currentElem))) {\n            // eslint-disable-line no-cond-assign\n            nthChild++\n            if (currentElem.tagName === elem.tagName) {\n                nthOfType++\n            }\n        }\n        props['nth_child'] = nthChild\n        props['nth_of_type'] = nthOfType\n\n        return props\n    },\n\n    _getDefaultProperties: function (eventType: string): Properties {\n        return {\n            $event_type: eventType,\n            $ce_version: 1,\n        }\n    },\n\n    _extractCustomPropertyValue: function (customProperty: AutoCaptureCustomProperty): string {\n        const propValues: string[] = []\n        _each(document.querySelectorAll(customProperty['css_selector']), function (matchedElem) {\n            let value\n\n            if (['input', 'select'].indexOf(matchedElem.tagName.toLowerCase()) > -1) {\n                value = matchedElem['value']\n            } else if (matchedElem['textContent']) {\n                value = matchedElem['textContent']\n            }\n\n            if (shouldCaptureValue(value)) {\n                propValues.push(value)\n            }\n        })\n        return propValues.join(', ')\n    },\n\n    // TODO: delete custom_properties after changeless typescript refactor\n    _getCustomProperties: function (targetElementList: Element[]): Properties {\n        const props: Properties = {} // will be deleted\n        _each(this._customProperties, (customProperty) => {\n            _each(customProperty['event_selectors'], (eventSelector) => {\n                const eventElements = document.querySelectorAll(eventSelector)\n                _each(eventElements, (eventElement) => {\n                    if (_includes(targetElementList, eventElement) && shouldCaptureElement(eventElement)) {\n                        props[customProperty['name']] = this._extractCustomPropertyValue(customProperty)\n                    }\n                })\n            })\n        })\n        return props\n    },\n\n    _getEventTarget: function (e: Event): Element | null {\n        // https://developer.mozilla.org/en-US/docs/Web/API/Event/target#Compatibility_notes\n        if (typeof e.target === 'undefined') {\n            return (e.srcElement as Element) || null\n        } else {\n            if ((e.target as HTMLElement)?.shadowRoot) {\n                return (e.composedPath()[0] as Element) || null\n            }\n            return (e.target as Element) || null\n        }\n    },\n\n    _captureEvent: function (e: Event, instance: PostHog, eventName = '$autocapture'): boolean | void {\n        /*** Don't mess with this code without running IE8 tests on it ***/\n        let target = this._getEventTarget(e)\n        if (isTextNode(target)) {\n            // defeat Safari bug (see: http://www.quirksmode.org/js/events_properties.html)\n            target = (target.parentNode || null) as Element | null\n        }\n\n        if (eventName === '$autocapture' && e.type === 'click' && e instanceof MouseEvent) {\n            if (this.rageclicks?.isRageClick(e.clientX, e.clientY, new Date().getTime())) {\n                this._captureEvent(e, instance, '$rageclick')\n            }\n        }\n\n        if (target && shouldCaptureDomEvent(target, e, this.config)) {\n            const targetElementList = [target]\n            let curEl = target\n            while (curEl.parentNode && !isTag(curEl, 'body')) {\n                if (isDocumentFragment(curEl.parentNode)) {\n                    targetElementList.push((curEl.parentNode as any).host)\n                    curEl = (curEl.parentNode as any).host\n                    continue\n                }\n                targetElementList.push(curEl.parentNode as Element)\n                curEl = curEl.parentNode as Element\n            }\n\n            const elementsJson: Properties[] = []\n            const autocaptureAugmentProperties: Properties = {}\n            let href,\n                explicitNoCapture = false\n            _each(targetElementList, (el) => {\n                const shouldCaptureEl = shouldCaptureElement(el)\n\n                // if the element or a parent element is an anchor tag\n                // include the href as a property\n                if (el.tagName.toLowerCase() === 'a') {\n                    href = el.getAttribute('href')\n                    href = shouldCaptureEl && shouldCaptureValue(href) && href\n                }\n\n                // allow users to programmatically prevent capturing of elements by adding class 'ph-no-capture'\n                const classes = getClassName(el).split(' ')\n                if (_includes(classes, 'ph-no-capture')) {\n                    explicitNoCapture = true\n                }\n\n                elementsJson.push(\n                    this._getPropertiesFromElement(\n                        el,\n                        instance.get_config('mask_all_element_attributes'),\n                        instance.get_config('mask_all_text')\n                    )\n                )\n\n                const augmentProperties = this._getAugmentPropertiesFromElement(el)\n                _extend(autocaptureAugmentProperties, augmentProperties)\n            })\n\n            if (!instance.get_config('mask_all_text')) {\n                // if the element is a button or anchor tag get the span text from any\n                // children and include it as/with the text property on the parent element\n                if (target.tagName.toLowerCase() === 'a' || target.tagName.toLowerCase() === 'button') {\n                    elementsJson[0]['$el_text'] = getDirectAndNestedSpanText(target)\n                } else {\n                    elementsJson[0]['$el_text'] = getSafeText(target)\n                }\n            }\n\n            if (href) {\n                elementsJson[0]['attr__href'] = href\n            }\n\n            if (explicitNoCapture) {\n                return false\n            }\n\n            const props = _extend(\n                this._getDefaultProperties(e.type),\n                {\n                    $elements: elementsJson,\n                },\n                this._getCustomProperties(targetElementList),\n                autocaptureAugmentProperties\n            )\n\n            instance.capture(eventName, props)\n            return true\n        }\n    },\n\n    // only reason is to stub for unit tests\n    // since you can't override window.location props\n    _navigate: function (href: string): void {\n        window.location.href = href\n    },\n\n    _addDomEventHandlers: function (instance: PostHog): void {\n        const handler = (e: Event) => {\n            e = e || window.event\n            this._captureEvent(e, instance)\n        }\n        _register_event(document, 'submit', handler, false, true)\n        _register_event(document, 'change', handler, false, true)\n        _register_event(document, 'click', handler, false, true)\n    },\n\n    _customProperties: [] as AutoCaptureCustomProperty[],\n    rageclicks: null as RageClick | null,\n    config: undefined as AutocaptureConfig | undefined,\n\n    init: function (instance: PostHog): void {\n        if (typeof instance.__autocapture !== 'boolean') {\n            this.config = instance.__autocapture\n        }\n\n        // precompile the regex\n        if (this.config?.url_allowlist) {\n            this.config.url_allowlist = this.config.url_allowlist.map((url) => new RegExp(url))\n        }\n\n        this.rageclicks = new RageClick(instance.get_config('rageclick'))\n    },\n\n    afterDecideResponse: function (response: DecideResponse, instance: PostHog): void {\n        const token = instance.get_config('token')\n        if (this._initializedTokens.indexOf(token) > -1) {\n            logger.log('autocapture already initialized for token \"' + token + '\"')\n            return\n        }\n\n        if (instance.persistence) {\n            instance.persistence.register({\n                [AUTOCAPTURE_DISABLED_SERVER_SIDE]: !!response['autocapture_opt_out'],\n            })\n        }\n        // store this in-memory incase persistence is disabled\n        this._isDisabledServerSide = !!response['autocapture_opt_out']\n\n        this._setIsAutocaptureEnabled(instance)\n\n        this._initializedTokens.push(token)\n\n        if (\n            response &&\n            response['config'] &&\n            response['config']['enable_collect_everything'] &&\n            this._isAutocaptureEnabled\n        ) {\n            // TODO: delete custom_properties after changeless typescript refactor\n            if (response['custom_properties']) {\n                this._customProperties = response['custom_properties']\n            }\n            this._addDomEventHandlers(instance)\n        } else {\n            instance['__autocapture'] = false\n        }\n    },\n\n    // this is a mechanism to ramp up CE with no server-side interaction.\n    // when CE is active, every page load results in a decide request. we\n    // need to gently ramp this up so we don't overload decide. this decides\n    // deterministically if CE is enabled for this project by modding the char\n    // value of the project token.\n    enabledForProject: function (\n        token: string | null | undefined,\n        numBuckets: number,\n        numEnabledBuckets: number\n    ): boolean {\n        if (!token) {\n            return true\n        }\n        numBuckets = !_isUndefined(numBuckets) ? numBuckets : 10\n        numEnabledBuckets = !_isUndefined(numEnabledBuckets) ? numEnabledBuckets : 10\n        let charCodeSum = 0\n        for (let i = 0; i < token.length; i++) {\n            charCodeSum += token.charCodeAt(i)\n        }\n        return charCodeSum % numBuckets < numEnabledBuckets\n    },\n\n    isBrowserSupported: function (): boolean {\n        return _isFunction(document.querySelectorAll)\n    },\n}\n\n_bind_instance_methods(autocapture)\n_safewrap_instance_methods(autocapture)\n\nexport { autocapture }\n","import { _base64Encode, _entries, _extend } from './utils'\nimport { PostHog } from './posthog-core'\nimport {\n    DecideResponse,\n    FeatureFlagsCallback,\n    EarlyAccessFeatureCallback,\n    EarlyAccessFeatureResponse,\n    Properties,\n    JsonType,\n    RequestCallback,\n} from './types'\nimport {\n    PERSISTENCE_EARLY_ACCESS_FEATURES,\n    PostHogPersistence,\n    ENABLED_FEATURE_FLAGS,\n    STORED_GROUP_PROPERTIES_KEY,\n    STORED_PERSON_PROPERTIES_KEY,\n    FLAG_CALL_REPORTED,\n} from './posthog-persistence'\n\nconst PERSISTENCE_ACTIVE_FEATURE_FLAGS = '$active_feature_flags'\nconst PERSISTENCE_OVERRIDE_FEATURE_FLAGS = '$override_feature_flags'\nconst PERSISTENCE_FEATURE_FLAG_PAYLOADS = '$feature_flag_payloads'\n\nexport const filterActiveFeatureFlags = (featureFlags?: Record<string, string | boolean>) => {\n    const activeFeatureFlags: Record<string, string | boolean> = {}\n    for (const [key, value] of _entries(featureFlags || {})) {\n        if (value) {\n            activeFeatureFlags[key] = value\n        }\n    }\n    return activeFeatureFlags\n}\n\nexport const parseFeatureFlagDecideResponse = (\n    response: Partial<DecideResponse>,\n    persistence: PostHogPersistence,\n    currentFlags: Record<string, string | boolean> = {},\n    currentFlagPayloads: Record<string, JsonType> = {}\n) => {\n    const flags = response['featureFlags']\n    const flagPayloads = response['featureFlagPayloads']\n    if (flags) {\n        // using the v1 api\n        if (Array.isArray(flags)) {\n            const $enabled_feature_flags: Record<string, boolean> = {}\n            if (flags) {\n                for (let i = 0; i < flags.length; i++) {\n                    $enabled_feature_flags[flags[i]] = true\n                }\n            }\n            persistence &&\n                persistence.register({\n                    [PERSISTENCE_ACTIVE_FEATURE_FLAGS]: flags,\n                    [ENABLED_FEATURE_FLAGS]: $enabled_feature_flags,\n                })\n        } else {\n            // using the v2+ api\n            let newFeatureFlags = flags\n            let newFeatureFlagPayloads = flagPayloads\n            if (response.errorsWhileComputingFlags) {\n                // if not all flags were computed, we upsert flags instead of replacing them\n                newFeatureFlags = { ...currentFlags, ...newFeatureFlags }\n                newFeatureFlagPayloads = { ...currentFlagPayloads, ...newFeatureFlagPayloads }\n            }\n            persistence &&\n                persistence.register({\n                    [PERSISTENCE_ACTIVE_FEATURE_FLAGS]: Object.keys(filterActiveFeatureFlags(newFeatureFlags)),\n                    [ENABLED_FEATURE_FLAGS]: newFeatureFlags || {},\n                    [PERSISTENCE_FEATURE_FLAG_PAYLOADS]: newFeatureFlagPayloads || {},\n                })\n        }\n    }\n}\n\nexport class PostHogFeatureFlags {\n    instance: PostHog\n    _override_warning: boolean\n    featureFlagEventHandlers: FeatureFlagsCallback[]\n    reloadFeatureFlagsQueued: boolean\n    reloadFeatureFlagsInAction: boolean\n    $anon_distinct_id: string | undefined\n\n    constructor(instance: PostHog) {\n        this.instance = instance\n        this._override_warning = false\n        this.featureFlagEventHandlers = []\n\n        this.reloadFeatureFlagsQueued = false\n        this.reloadFeatureFlagsInAction = false\n    }\n\n    getFlags(): string[] {\n        return Object.keys(this.getFlagVariants())\n    }\n\n    getFlagVariants(): Record<string, string | boolean> {\n        const enabledFlags = this.instance.get_property(ENABLED_FEATURE_FLAGS)\n        const overriddenFlags = this.instance.get_property(PERSISTENCE_OVERRIDE_FEATURE_FLAGS)\n        if (!overriddenFlags) {\n            return enabledFlags || {}\n        }\n\n        const finalFlags = _extend({}, enabledFlags)\n        const overriddenKeys = Object.keys(overriddenFlags)\n        for (let i = 0; i < overriddenKeys.length; i++) {\n            if (overriddenFlags[overriddenKeys[i]] === false) {\n                delete finalFlags[overriddenKeys[i]]\n            } else {\n                finalFlags[overriddenKeys[i]] = overriddenFlags[overriddenKeys[i]]\n            }\n        }\n        if (!this._override_warning) {\n            console.warn('[PostHog] Overriding feature flags!', {\n                enabledFlags,\n                overriddenFlags,\n                finalFlags,\n            })\n            this._override_warning = true\n        }\n        return finalFlags\n    }\n\n    getFlagPayloads(): Record<string, JsonType> {\n        const flagPayloads = this.instance.get_property(PERSISTENCE_FEATURE_FLAG_PAYLOADS)\n        return flagPayloads || {}\n    }\n\n    /**\n     * Reloads feature flags asynchronously.\n     *\n     * Constraints:\n     *\n     * 1. Avoid parallel requests\n     * 2. Delay a few milliseconds after each reloadFeatureFlags call to batch subsequent changes together\n     * 3. Don't call this during initial load (as /decide will be called instead), see posthog-core.js\n     */\n    reloadFeatureFlags(): void {\n        if (!this.reloadFeatureFlagsQueued) {\n            this.reloadFeatureFlagsQueued = true\n            this._startReloadTimer()\n        }\n    }\n\n    setAnonymousDistinctId(anon_distinct_id: string): void {\n        this.$anon_distinct_id = anon_distinct_id\n    }\n\n    setReloadingPaused(isPaused: boolean): void {\n        this.reloadFeatureFlagsInAction = isPaused\n    }\n\n    resetRequestQueue(): void {\n        this.reloadFeatureFlagsQueued = false\n    }\n\n    _startReloadTimer(): void {\n        if (this.reloadFeatureFlagsQueued && !this.reloadFeatureFlagsInAction) {\n            setTimeout(() => {\n                if (!this.reloadFeatureFlagsInAction && this.reloadFeatureFlagsQueued) {\n                    this.reloadFeatureFlagsQueued = false\n                    this._reloadFeatureFlagsRequest()\n                }\n            }, 5)\n        }\n    }\n\n    _reloadFeatureFlagsRequest(): void {\n        this.setReloadingPaused(true)\n        const token = this.instance.get_config('token')\n        const personProperties = this.instance.get_property(STORED_PERSON_PROPERTIES_KEY)\n        const groupProperties = this.instance.get_property(STORED_GROUP_PROPERTIES_KEY)\n        const json_data = JSON.stringify({\n            token: token,\n            distinct_id: this.instance.get_distinct_id(),\n            groups: this.instance.getGroups(),\n            $anon_distinct_id: this.$anon_distinct_id,\n            person_properties: personProperties,\n            group_properties: groupProperties,\n            disable_flags: this.instance.get_config('advanced_disable_feature_flags') || undefined,\n        })\n\n        const encoded_data = _base64Encode(json_data)\n        this.instance._send_request(\n            this.instance.get_config('api_host') + '/decide/?v=3',\n            { data: encoded_data },\n            { method: 'POST' },\n            this.instance._prepare_callback((response) => {\n                // reset anon_distinct_id after at least a single request with it\n                // makes it through\n                this.$anon_distinct_id = undefined\n                this.receivedFeatureFlags(response as DecideResponse)\n\n                // :TRICKY: Reload - start another request if queued!\n                this.setReloadingPaused(false)\n                this._startReloadTimer()\n            }) as RequestCallback\n        )\n    }\n\n    /*\n     * Get feature flag's value for user.\n     *\n     * ### Usage:\n     *\n     *     if(posthog.getFeatureFlag('my-flag') === 'some-variant') { // do something }\n     *\n     * @param {Object|String} key Key of the feature flag.\n     * @param {Object|String} options (optional) If {send_event: false}, we won't send an $feature_flag_call event to PostHog.\n     */\n    getFeatureFlag(key: string, options: { send_event?: boolean } = {}): boolean | string | undefined {\n        if (!this.instance.decideEndpointWasHit && !(this.getFlags() && this.getFlags().length > 0)) {\n            console.warn('getFeatureFlag for key \"' + key + '\" failed. Feature flags didn\\'t load in time.')\n            return undefined\n        }\n        const flagValue = this.getFlagVariants()[key]\n        const flagReportValue = `${flagValue}`\n        const flagCallReported: Record<string, string[]> = this.instance.get_property(FLAG_CALL_REPORTED) || {}\n\n        if (options.send_event || !('send_event' in options)) {\n            if (!(key in flagCallReported) || !flagCallReported[key].includes(flagReportValue)) {\n                if (Array.isArray(flagCallReported[key])) {\n                    flagCallReported[key].push(flagReportValue)\n                } else {\n                    flagCallReported[key] = [flagReportValue]\n                }\n                this.instance.persistence.register({ [FLAG_CALL_REPORTED]: flagCallReported })\n\n                this.instance.capture('$feature_flag_called', { $feature_flag: key, $feature_flag_response: flagValue })\n            }\n        }\n        return flagValue\n    }\n\n    getFeatureFlagPayload(key: string): JsonType {\n        const payloads = this.getFlagPayloads()\n        return payloads[key]\n    }\n\n    /*\n     * See if feature flag is enabled for user.\n     *\n     * ### Usage:\n     *\n     *     if(posthog.isFeatureEnabled('beta-feature')) { // do something }\n     *\n     * @param {Object|String} key Key of the feature flag.\n     * @param {Object|String} options (optional) If {send_event: false}, we won't send an $feature_flag_call event to PostHog.\n     */\n    isFeatureEnabled(key: string, options: { send_event?: boolean } = {}): boolean | undefined {\n        if (!this.instance.decideEndpointWasHit && !(this.getFlags() && this.getFlags().length > 0)) {\n            console.warn('isFeatureEnabled for key \"' + key + '\" failed. Feature flags didn\\'t load in time.')\n            return undefined\n        }\n        return !!this.getFeatureFlag(key, options)\n    }\n\n    addFeatureFlagsHandler(handler: FeatureFlagsCallback): void {\n        this.featureFlagEventHandlers.push(handler)\n    }\n\n    removeFeatureFlagsHandler(handler: FeatureFlagsCallback): void {\n        this.featureFlagEventHandlers = this.featureFlagEventHandlers.filter((h) => h !== handler)\n    }\n\n    receivedFeatureFlags(response: Partial<DecideResponse>): void {\n        this.instance.decideEndpointWasHit = true\n        const currentFlags = this.getFlagVariants()\n        const currentFlagPayloads = this.getFlagPayloads()\n        parseFeatureFlagDecideResponse(response, this.instance.persistence, currentFlags, currentFlagPayloads)\n        this._fireFeatureFlagsCallbacks()\n    }\n\n    /*\n     * Override feature flags for debugging.\n     *\n     * ### Usage:\n     *\n     *     - posthog.feature_flags.override(false)\n     *     - posthog.feature_flags.override(['beta-feature'])\n     *     - posthog.feature_flags.override({'beta-feature': 'variant', 'other-feature': True})\n     *\n     * @param {Object|Array|String} flags Flags to override with.\n     */\n    override(flags: boolean | string[] | Record<string, string | boolean>): void {\n        this._override_warning = false\n\n        if (flags === false) {\n            this.instance.persistence.unregister(PERSISTENCE_OVERRIDE_FEATURE_FLAGS)\n        } else if (Array.isArray(flags)) {\n            const flagsObj: Record<string, string | boolean> = {}\n            for (let i = 0; i < flags.length; i++) {\n                flagsObj[flags[i]] = true\n            }\n            this.instance.persistence.register({ [PERSISTENCE_OVERRIDE_FEATURE_FLAGS]: flagsObj })\n        } else {\n            this.instance.persistence.register({ [PERSISTENCE_OVERRIDE_FEATURE_FLAGS]: flags })\n        }\n    }\n    /*\n     * Register an event listener that runs when feature flags become available or when they change.\n     * If there are flags, the listener is called immediately in addition to being called on future changes.\n     *\n     * ### Usage:\n     *\n     *     posthog.onFeatureFlags(function(featureFlags) { // do something })\n     *\n     * @param {Function} [callback] The callback function will be called once the feature flags are ready or when they are updated.\n     *                              It'll return a list of feature flags enabled for the user.\n     * @returns {Function} A function that can be called to unsubscribe the listener. Used by useEffect when the component unmounts.\n     */\n    onFeatureFlags(callback: FeatureFlagsCallback): () => void {\n        this.addFeatureFlagsHandler(callback)\n        if (this.instance.decideEndpointWasHit) {\n            const { flags, flagVariants } = this._prepareFeatureFlagsForCallbacks()\n            callback(flags, flagVariants)\n        }\n        return () => this.removeFeatureFlagsHandler(callback)\n    }\n\n    updateEarlyAccessFeatureEnrollment(key: string, isEnrolled: boolean): void {\n        const enrollmentPersonProp = {\n            [`$feature_enrollment/${key}`]: isEnrolled,\n        }\n        this.instance.capture('$feature_enrollment_update', {\n            $feature_flag: key,\n            $feature_enrollment: isEnrolled,\n            $set: enrollmentPersonProp,\n        })\n        this.setPersonPropertiesForFlags(enrollmentPersonProp, false)\n\n        const newFlags = { ...this.getFlagVariants(), [key]: isEnrolled }\n        this.instance.persistence.register({\n            [PERSISTENCE_ACTIVE_FEATURE_FLAGS]: Object.keys(filterActiveFeatureFlags(newFlags)),\n            [ENABLED_FEATURE_FLAGS]: newFlags,\n        })\n        this._fireFeatureFlagsCallbacks()\n    }\n\n    getEarlyAccessFeatures(callback: EarlyAccessFeatureCallback, force_reload = false): void {\n        const existing_early_access_features = this.instance.get_property(PERSISTENCE_EARLY_ACCESS_FEATURES)\n\n        if (!existing_early_access_features || force_reload) {\n            this.instance._send_request(\n                `${this.instance.get_config('api_host')}/api/early_access_features/?token=${this.instance.get_config(\n                    'token'\n                )}`,\n                {},\n                { method: 'GET' },\n                (response) => {\n                    const earlyAccessFeatures = (response as EarlyAccessFeatureResponse).earlyAccessFeatures\n                    this.instance.persistence.register({ [PERSISTENCE_EARLY_ACCESS_FEATURES]: earlyAccessFeatures })\n                    return callback(earlyAccessFeatures)\n                }\n            )\n        } else {\n            return callback(existing_early_access_features)\n        }\n    }\n\n    _prepareFeatureFlagsForCallbacks(): { flags: string[]; flagVariants: Record<string, string | boolean> } {\n        const flags = this.getFlags()\n        const flagVariants = this.getFlagVariants()\n\n        // Return truthy\n        const truthyFlags = flags.filter((flag) => flagVariants[flag])\n        const truthyFlagVariants = Object.keys(flagVariants)\n            .filter((variantKey) => flagVariants[variantKey])\n            .reduce((res: Record<string, string | boolean>, key) => {\n                res[key] = flagVariants[key]\n                return res\n            }, {})\n\n        return {\n            flags: truthyFlags,\n            flagVariants: truthyFlagVariants,\n        }\n    }\n\n    _fireFeatureFlagsCallbacks(): void {\n        const { flags, flagVariants } = this._prepareFeatureFlagsForCallbacks()\n        this.featureFlagEventHandlers.forEach((handler) => handler(flags, flagVariants))\n    }\n\n    /**\n     * Set override person properties for feature flags.\n     * This is used when dealing with new persons / where you don't want to wait for ingestion\n     * to update user properties.\n     */\n    setPersonPropertiesForFlags(properties: Properties, reloadFeatureFlags = true): void {\n        // Get persisted person properties\n        const existingProperties = this.instance.get_property(STORED_PERSON_PROPERTIES_KEY) || {}\n\n        this.instance.register({\n            [STORED_PERSON_PROPERTIES_KEY]: {\n                ...existingProperties,\n                ...properties,\n            },\n        })\n\n        if (reloadFeatureFlags) {\n            this.instance.reloadFeatureFlags()\n        }\n    }\n\n    resetPersonPropertiesForFlags(): void {\n        this.instance.unregister(STORED_PERSON_PROPERTIES_KEY)\n    }\n\n    /**\n     * Set override group properties for feature flags.\n     * This is used when dealing with new groups / where you don't want to wait for ingestion\n     * to update properties.\n     * Takes in an object, the key of which is the group type.\n     * For example:\n     *     setGroupPropertiesForFlags({'organization': { name: 'CYZ', employees: '11' } })\n     */\n    setGroupPropertiesForFlags(properties: { [type: string]: Properties }, reloadFeatureFlags = true): void {\n        // Get persisted group properties\n        const existingProperties = this.instance.get_property(STORED_GROUP_PROPERTIES_KEY) || {}\n\n        if (Object.keys(existingProperties).length !== 0) {\n            Object.keys(existingProperties).forEach((groupType) => {\n                existingProperties[groupType] = {\n                    ...existingProperties[groupType],\n                    ...properties[groupType],\n                }\n                delete properties[groupType]\n            })\n        }\n\n        this.instance.register({\n            [STORED_GROUP_PROPERTIES_KEY]: {\n                ...existingProperties,\n                ...properties,\n            },\n        })\n\n        if (reloadFeatureFlags) {\n            this.instance.reloadFeatureFlags()\n        }\n    }\n\n    resetGroupPropertiesForFlags(group_type?: string): void {\n        if (group_type) {\n            const existingProperties = this.instance.get_property(STORED_GROUP_PROPERTIES_KEY) || {}\n            this.instance.register({\n                [STORED_GROUP_PROPERTIES_KEY]: { ...existingProperties, [group_type]: {} },\n            })\n        } else {\n            this.instance.unregister(STORED_GROUP_PROPERTIES_KEY)\n        }\n    }\n}\n","import type {\n    KeepIframeSrcFn,\n    RecordPlugin,\n    SamplingStrategy,\n    blockClass,\n    eventWithTime,\n    hooksParam,\n    listenerHandler,\n    maskTextClass,\n    pluginEvent,\n    mutationCallbackParam,\n} from '@rrweb/types'\nimport type { Mirror, MaskInputOptions, MaskInputFn, MaskTextFn, SlimDOMOptions, DataURLOptions } from 'rrweb-snapshot'\n\nexport const replacementImageURI =\n    'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNOCAwSDE2TDAgMTZWOEw4IDBaIiBmaWxsPSIjMkQyRDJEIi8+CjxwYXRoIGQ9Ik0xNiA4VjE2SDhMMTYgOFoiIGZpbGw9IiMyRDJEMkQiLz4KPC9zdmc+Cg=='\n\nexport const FULL_SNAPSHOT_EVENT_TYPE = 2\nexport const META_EVENT_TYPE = 4\nexport const INCREMENTAL_SNAPSHOT_EVENT_TYPE = 3\nexport const PLUGIN_EVENT_TYPE = 6\nexport const MUTATION_SOURCE_TYPE = 0\n\nexport const MAX_MESSAGE_SIZE = 5000000 // ~5mb\n\nexport type rrwebRecord = {\n    (options: recordOptions<eventWithTime>): listenerHandler\n    addCustomEvent: (tag: string, payload: any) => void\n    takeFullSnapshot: () => void\n    mirror: Mirror\n}\n\nexport declare type recordOptions<T> = {\n    emit?: (e: T, isCheckout?: boolean) => void\n    checkoutEveryNth?: number\n    checkoutEveryNms?: number\n    blockClass?: blockClass\n    blockSelector?: string\n    ignoreClass?: string\n    maskTextClass?: maskTextClass\n    maskTextSelector?: string\n    maskAllInputs?: boolean\n    maskInputOptions?: MaskInputOptions\n    maskInputFn?: MaskInputFn\n    maskTextFn?: MaskTextFn\n    slimDOMOptions?: SlimDOMOptions | 'all' | true\n    ignoreCSSAttributes?: Set<string>\n    inlineStylesheet?: boolean\n    hooks?: hooksParam\n    // packFn?: PackFn\n    sampling?: SamplingStrategy\n    dataURLOptions?: DataURLOptions\n    recordCanvas?: boolean\n    recordCrossOriginIframes?: boolean\n    recordAfter?: 'DOMContentLoaded' | 'load'\n    userTriggeredOnInput?: boolean\n    collectFonts?: boolean\n    inlineImages?: boolean\n    plugins?: RecordPlugin[]\n    mousemoveWait?: number\n    keepIframeSrcFn?: KeepIframeSrcFn\n    // errorHandler?: ErrorHandler\n}\n\n/*\n * Check whether a data payload is nearing 5mb. If it is, it checks the data for\n * data URIs (the likely culprit for large payloads). If it finds data URIs, it either replaces\n * it with a generic image (if it's an image) or removes it.\n * @data {object} the rr-web data object\n * @returns {object} the rr-web data object with data uris filtered out\n */\nexport function ensureMaxMessageSize(data: eventWithTime): { event: eventWithTime; size: number } {\n    let stringifiedData = JSON.stringify(data)\n    // Note: with compression, this limit may be able to be increased\n    // but we're assuming most of the size is from a data uri which\n    // is unlikely to be compressed further\n    if (stringifiedData.length > MAX_MESSAGE_SIZE) {\n        // Regex that matches the pattern for a dataURI with the shape 'data:{mime type};{encoding},{data}'. It:\n        // 1) Checks if the pattern starts with 'data:' (potentially, not at the start of the string)\n        // 2) Extracts the mime type of the data uri in the first group\n        // 3) Determines when the data URI ends.Depending on if it's used in the src tag or css, it can end with a ) or \"\n        const dataURIRegex = /data:([\\w\\/\\-\\.]+);(\\w+),([^)\"]*)/gim\n        const matches = stringifiedData.matchAll(dataURIRegex)\n        for (const match of matches) {\n            if (match[1].toLocaleLowerCase().slice(0, 6) === 'image/') {\n                stringifiedData = stringifiedData.replace(match[0], replacementImageURI)\n            } else {\n                stringifiedData = stringifiedData.replace(match[0], '')\n            }\n        }\n    }\n    return { event: JSON.parse(stringifiedData), size: stringifiedData.length }\n}\n\nexport const CONSOLE_LOG_PLUGIN_NAME = 'rrweb/console@1' // The name of the rr-web plugin that emits console logs\n\n// Console logs can be really large. This function truncates large logs\n// It's a simple function that just truncates long strings.\n// TODO: Ideally this function would have better handling of objects + lists,\n// so they could still be rendered in a pretty way after truncation.\nexport function truncateLargeConsoleLogs(_event: eventWithTime) {\n    const event = _event as pluginEvent<{ payload: string[] }>\n\n    const MAX_STRING_SIZE = 2000 // Maximum number of characters allowed in a string\n    const MAX_STRINGS_PER_LOG = 10 // A log can consist of multiple strings (e.g. consol.log('string1', 'string2'))\n\n    if (\n        event &&\n        typeof event === 'object' &&\n        event.type === PLUGIN_EVENT_TYPE &&\n        typeof event.data === 'object' &&\n        event.data.plugin === CONSOLE_LOG_PLUGIN_NAME\n    ) {\n        // Note: event.data.payload.payload comes from rr-web, and is an array of strings\n        if (event.data.payload.payload.length > MAX_STRINGS_PER_LOG) {\n            event.data.payload.payload = event.data.payload.payload.slice(0, MAX_STRINGS_PER_LOG)\n            event.data.payload.payload.push('...[truncated]')\n        }\n        const updatedPayload = []\n        for (let i = 0; i < event.data.payload.payload.length; i++) {\n            if (\n                event.data.payload.payload[i] && // Value can be null\n                event.data.payload.payload[i].length > MAX_STRING_SIZE\n            ) {\n                updatedPayload.push(event.data.payload.payload[i].slice(0, MAX_STRING_SIZE) + '...[truncated]')\n            } else {\n                updatedPayload.push(event.data.payload.payload[i])\n            }\n        }\n        event.data.payload.payload = updatedPayload\n        // Return original type\n        return _event\n    }\n    return _event\n}\n\nexport class MutationRateLimiter {\n    private bucketSize = 100\n    private refillRate = 10\n    private mutationBuckets: Record<string, number> = {}\n    private loggedTracker: Record<string, boolean> = {}\n\n    constructor(\n        private readonly rrweb: rrwebRecord,\n        private readonly options: {\n            bucketSize?: number\n            refillRate?: number\n            onBlockedNode?: (id: number, node: Node | null) => void\n        } = {}\n    ) {\n        this.refillRate = this.options.refillRate ?? this.refillRate\n        this.bucketSize = this.options.bucketSize ?? this.bucketSize\n        setInterval(() => {\n            this.refillBuckets()\n        }, 1000)\n    }\n\n    private refillBuckets = () => {\n        Object.keys(this.mutationBuckets).forEach((key) => {\n            this.mutationBuckets[key] = this.mutationBuckets[key] + this.refillRate\n\n            if (this.mutationBuckets[key] >= this.bucketSize) {\n                delete this.mutationBuckets[key]\n            }\n        })\n    }\n\n    private getNodeOrRelevantParent = (id: number): [number, Node | null] => {\n        // For some nodes we know they are part of a larger tree such as an SVG.\n        // For those we want to block the entire node, not just the specific attribute\n\n        const node = this.rrweb.mirror.getNode(id)\n\n        // Check if the node is an Element and then find the closest parent that is an SVG\n        if (node?.nodeName !== 'svg' && node instanceof Element) {\n            const closestSVG = node.closest('svg')\n\n            if (closestSVG) {\n                return [this.rrweb.mirror.getId(closestSVG), closestSVG]\n            }\n        }\n\n        return [id, node]\n    }\n\n    private numberOfChanges = (data: Partial<mutationCallbackParam>) => {\n        return (\n            (data.removes?.length ?? 0) +\n            (data.attributes?.length ?? 0) +\n            (data.texts?.length ?? 0) +\n            (data.adds?.length ?? 0)\n        )\n    }\n\n    public throttleMutations = (event: eventWithTime) => {\n        if (event.type !== INCREMENTAL_SNAPSHOT_EVENT_TYPE || event.data.source !== MUTATION_SOURCE_TYPE) {\n            return event\n        }\n\n        const data = event.data as Partial<mutationCallbackParam>\n        const initialMutationCount = this.numberOfChanges(data)\n\n        if (data.attributes) {\n            // Most problematic mutations come from attrs where the style or minor properties are changed rapidly\n            data.attributes = data.attributes.filter((attr) => {\n                const [nodeId, node] = this.getNodeOrRelevantParent(attr.id)\n\n                if (this.mutationBuckets[nodeId] === 0) {\n                    return false\n                }\n\n                this.mutationBuckets[nodeId] = this.mutationBuckets[nodeId] ?? this.bucketSize\n                this.mutationBuckets[nodeId] = Math.max(this.mutationBuckets[nodeId] - 1, 0)\n\n                if (this.mutationBuckets[nodeId] === 0) {\n                    if (!this.loggedTracker[nodeId]) {\n                        this.loggedTracker[nodeId] = true\n                        this.options.onBlockedNode?.(nodeId, node)\n                    }\n                }\n\n                return attr\n            })\n        }\n\n        // Check if every part of the mutation is empty in which case there is nothing to do\n        const mutationCount = this.numberOfChanges(data)\n\n        if (mutationCount === 0 && initialMutationCount !== mutationCount) {\n            // If we have modified the mutation count and the remaining count is 0, then we don't need the event.\n            return\n        }\n        return event\n    }\n}\n","import {\n    CONSOLE_LOG_RECORDING_ENABLED_SERVER_SIDE,\n    SESSION_RECORDING_ENABLED_SERVER_SIDE,\n    SESSION_RECORDING_RECORDER_VERSION_SERVER_SIDE,\n} from '../posthog-persistence'\nimport {\n    ensureMaxMessageSize,\n    FULL_SNAPSHOT_EVENT_TYPE,\n    INCREMENTAL_SNAPSHOT_EVENT_TYPE,\n    META_EVENT_TYPE,\n    MutationRateLimiter,\n    recordOptions,\n    rrwebRecord,\n    truncateLargeConsoleLogs,\n} from './sessionrecording-utils'\nimport { PostHog } from '../posthog-core'\nimport { DecideResponse, Properties } from '../types'\nimport type { eventWithTime, listenerHandler } from '@rrweb/types'\nimport Config from '../config'\nimport { logger, loadScript, _timestamp } from '../utils'\n\nconst BASE_ENDPOINT = '/s/'\n\nexport const RECORDING_IDLE_ACTIVITY_TIMEOUT_MS = 5 * 60 * 1000 // 5 minutes\nexport const RECORDING_MAX_EVENT_SIZE = 1024 * 1024 * 0.9 // ~1mb (with some wiggle room)\nexport const RECORDING_BUFFER_TIMEOUT = 2000 // 2 seconds\nexport const SESSION_RECORDING_BATCH_KEY = 'sessionRecording'\n\n// NOTE: Importing this type is problematic as we can't safely bundle it to a TS definition so, instead we redefine.\n// import type { record } from 'rrweb2/typings'\n// import type { recordOptions } from 'rrweb/typings/types'\n\n// Copied from rrweb typings to avoid import\nenum IncrementalSource {\n    Mutation = 0,\n    MouseMove = 1,\n    MouseInteraction = 2,\n    Scroll = 3,\n    ViewportResize = 4,\n    Input = 5,\n    TouchMove = 6,\n    MediaInteraction = 7,\n    StyleSheetRule = 8,\n    CanvasMutation = 9,\n    Font = 10,\n    Log = 11,\n    Drag = 12,\n    StyleDeclaration = 13,\n    Selection = 14,\n    AdoptedStyleSheet = 15,\n}\n\nconst ACTIVE_SOURCES = [\n    IncrementalSource.MouseMove,\n    IncrementalSource.MouseInteraction,\n    IncrementalSource.Scroll,\n    IncrementalSource.ViewportResize,\n    IncrementalSource.Input,\n    IncrementalSource.TouchMove,\n    IncrementalSource.MediaInteraction,\n    IncrementalSource.Drag,\n]\n\nexport class SessionRecording {\n    private instance: PostHog\n    private emit: boolean\n    private endpoint: string\n    private windowId: string | null\n    private sessionId: string | null\n    private lastActivityTimestamp: number = Date.now()\n    private flushBufferTimer?: any\n    private buffer?: {\n        size: number\n        data: any[]\n        sessionId: string | null\n        windowId: string | null\n    }\n    private mutationRateLimiter?: MutationRateLimiter\n\n    captureStarted: boolean\n    snapshots: any[]\n    stopRrweb: listenerHandler | undefined\n    receivedDecide: boolean\n    rrwebRecord: rrwebRecord | undefined\n    recorderVersion?: string\n    isIdle = false\n\n    constructor(instance: PostHog) {\n        this.instance = instance\n        this.captureStarted = false\n        this.snapshots = []\n        this.emit = false // Controls whether data is sent to the server or not\n        this.endpoint = BASE_ENDPOINT\n        this.stopRrweb = undefined\n        this.windowId = null\n        this.sessionId = null\n        this.receivedDecide = false\n\n        window.addEventListener('beforeunload', () => {\n            this._flushBuffer()\n        })\n    }\n\n    startRecordingIfEnabled() {\n        if (this.isRecordingEnabled()) {\n            this.startCaptureAndTrySendingQueuedSnapshots()\n        } else {\n            this.stopRecording()\n        }\n    }\n\n    started() {\n        return this.captureStarted\n    }\n\n    stopRecording() {\n        if (this.captureStarted && this.stopRrweb) {\n            this.stopRrweb()\n            this.stopRrweb = undefined\n            this.captureStarted = false\n        }\n    }\n\n    isRecordingEnabled() {\n        const enabled_server_side = !!this.instance.get_property(SESSION_RECORDING_ENABLED_SERVER_SIDE)\n        const enabled_client_side = !this.instance.get_config('disable_session_recording')\n        return enabled_server_side && enabled_client_side\n    }\n\n    isConsoleLogCaptureEnabled() {\n        const enabled_server_side = !!this.instance.get_property(CONSOLE_LOG_RECORDING_ENABLED_SERVER_SIDE)\n        const enabled_client_side = this.instance.get_config('enable_recording_console_log')\n        return enabled_client_side ?? enabled_server_side\n    }\n\n    getRecordingVersion() {\n        const recordingVersion_server_side = this.instance.get_property(SESSION_RECORDING_RECORDER_VERSION_SERVER_SIDE)\n        const recordingVersion_client_side = this.instance.get_config('session_recording')?.recorderVersion\n        return recordingVersion_client_side || recordingVersion_server_side || 'v1'\n    }\n\n    afterDecideResponse(response: DecideResponse) {\n        this.receivedDecide = true\n        if (this.instance.persistence) {\n            this.instance.persistence.register({\n                [SESSION_RECORDING_ENABLED_SERVER_SIDE]: !!response['sessionRecording'],\n                [CONSOLE_LOG_RECORDING_ENABLED_SERVER_SIDE]: response.sessionRecording?.consoleLogRecordingEnabled,\n                [SESSION_RECORDING_RECORDER_VERSION_SERVER_SIDE]: response.sessionRecording?.recorderVersion,\n            })\n        }\n        if (response.sessionRecording?.endpoint) {\n            this.endpoint = response.sessionRecording?.endpoint\n        }\n\n        if (response.sessionRecording?.recorderVersion) {\n            this.recorderVersion = response.sessionRecording.recorderVersion\n        }\n        this.startRecordingIfEnabled()\n    }\n\n    log(message: string, level: 'log' | 'warn' | 'error' = 'log') {\n        this.instance.sessionRecording?.onRRwebEmit({\n            type: 6,\n            data: {\n                plugin: 'rrweb/console@1',\n                payload: {\n                    level,\n                    trace: [],\n                    // Even though it is a string we stringify it as thats what rrweb expects\n                    payload: [JSON.stringify(message)],\n                },\n            },\n            timestamp: _timestamp(),\n        })\n    }\n\n    private startCaptureAndTrySendingQueuedSnapshots() {\n        // Only submit data after we've received a decide response to account for\n        // changing endpoints and the feature being disabled on the server side.\n        if (this.receivedDecide) {\n            this.emit = true\n            this.snapshots.forEach((properties) => this._captureSnapshotBuffered(properties))\n        }\n        this._startCapture()\n    }\n\n    private _startCapture() {\n        // According to the rrweb docs, rrweb is not supported on IE11 and below:\n        // \"rrweb does not support IE11 and below because it uses the MutationObserver API which was supported by these browsers.\"\n        // https://github.com/rrweb-io/rrweb/blob/master/guide.md#compatibility-note\n        //\n        // However, MutationObserver does exist on IE11, it just doesn't work well and does not detect all changes.\n        // Instead, when we load \"recorder.js\", the first JS error is about \"Object.assign\" being undefined.\n        // Thus instead of MutationObserver, we look for this function and block recording if it's undefined.\n        if (typeof Object.assign === 'undefined') {\n            return\n        }\n\n        // We do not switch recorder versions midway through a recording.\n        if (this.captureStarted || this.instance.get_config('disable_session_recording')) {\n            return\n        }\n\n        this.captureStarted = true\n        // We want to ensure the sessionManager is reset if necessary on load of the recorder\n        this.instance.sessionManager.checkAndGetSessionAndWindowId()\n\n        const recorderJS = this.getRecordingVersion() === 'v2' ? 'recorder-v2.js' : 'recorder.js'\n\n        // If recorder.js is already loaded (if array.full.js snippet is used or ablaevent-js/dist/recorder is\n        // imported) or matches the requested recorder version, don't load script. Otherwise, remotely import\n        // recorder.js from cdn since it hasn't been loaded.\n        if (this.instance.__loaded_recorder_version !== this.getRecordingVersion()) {\n            loadScript(\n                this.instance.get_config('api_host') + `/static/${recorderJS}?v=${Config.LIB_VERSION}`,\n                (err) => {\n                    if (err) {\n                        return logger.error(`Could not load ${recorderJS}`, err)\n                    }\n\n                    this._onScriptLoaded()\n                }\n            )\n        } else {\n            this._onScriptLoaded()\n        }\n    }\n\n    private _isInteractiveEvent(event: eventWithTime) {\n        return event.type === INCREMENTAL_SNAPSHOT_EVENT_TYPE && ACTIVE_SOURCES.indexOf(event.data?.source) !== -1\n    }\n\n    private _updateWindowAndSessionIds(event: eventWithTime) {\n        // Some recording events are triggered by non-user events (e.g. \"X minutes ago\" text updating on the screen).\n        // We don't want to extend the session or trigger a new session in these cases. These events are designated by event\n        // type -> incremental update, and source -> mutation.\n\n        const isUserInteraction = this._isInteractiveEvent(event)\n\n        if (!isUserInteraction && !this.isIdle) {\n            // We check if the lastActivityTimestamp is old enough to go idle\n            if (event.timestamp - this.lastActivityTimestamp > RECORDING_IDLE_ACTIVITY_TIMEOUT_MS) {\n                this.isIdle = true\n            }\n        }\n\n        if (isUserInteraction) {\n            this.lastActivityTimestamp = event.timestamp\n            if (this.isIdle) {\n                // Remove the idle state if set and trigger a full snapshot as we will have ingored previous mutations\n                this.isIdle = false\n                this._tryTakeFullSnapshot()\n            }\n        }\n\n        if (this.isIdle) {\n            return\n        }\n\n        // We only want to extend the session if it is an interactive event.\n        const { windowId, sessionId } = this.instance.sessionManager.checkAndGetSessionAndWindowId(\n            !isUserInteraction,\n            event.timestamp\n        )\n\n        if (\n            [FULL_SNAPSHOT_EVENT_TYPE, META_EVENT_TYPE].indexOf(event.type) === -1 &&\n            (this.windowId !== windowId || this.sessionId !== sessionId)\n        ) {\n            this._tryTakeFullSnapshot()\n        }\n        this.windowId = windowId\n        this.sessionId = sessionId\n    }\n\n    private _tryTakeFullSnapshot(): boolean {\n        if (!this.captureStarted) {\n            return false\n        }\n        try {\n            this.rrwebRecord?.takeFullSnapshot()\n            return true\n        } catch (e) {\n            // Sometimes a race can occur where the recorder is not fully started yet, so we can't take a full snapshot.\n            logger.error('Error taking full snapshot.', e)\n            return false\n        }\n    }\n\n    private _onScriptLoaded() {\n        // rrweb config info: https://github.com/rrweb-io/rrweb/blob/7d5d0033258d6c29599fb08412202d9a2c7b9413/src/record/index.ts#L28\n        const sessionRecordingOptions: recordOptions<eventWithTime> = {\n            // select set of rrweb config options we expose to our users\n            // see https://github.com/rrweb-io/rrweb/blob/master/guide.md\n            blockClass: 'ph-no-capture',\n            blockSelector: undefined,\n            ignoreClass: 'ph-ignore-input',\n            maskTextClass: 'ph-mask',\n            maskTextSelector: undefined,\n            maskTextFn: undefined,\n            maskAllInputs: true,\n            maskInputOptions: {},\n            maskInputFn: undefined,\n            slimDOMOptions: {},\n            collectFonts: false,\n            inlineStylesheet: true,\n            recordCrossOriginIframes: false,\n        }\n        // We switched from loading all of rrweb to just the record part, but\n        // keep backwards compatibility if someone hasn't upgraded PostHog\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        this.rrwebRecord = window.rrweb ? window.rrweb.record : window.rrwebRecord\n\n        // only allows user to set our 'allowlisted' options\n        const userSessionRecordingOptions = this.instance.get_config('session_recording')\n        for (const [key, value] of Object.entries(userSessionRecordingOptions || {})) {\n            if (key in sessionRecordingOptions) {\n                // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                // @ts-ignore\n                sessionRecordingOptions[key] = value\n            }\n        }\n\n        if (!this.rrwebRecord) {\n            logger.error(\n                'onScriptLoaded was called but rrwebRecord is not available. This indicates something has gone wrong.'\n            )\n            return\n        }\n\n        this.mutationRateLimiter =\n            this.mutationRateLimiter ??\n            new MutationRateLimiter(this.rrwebRecord!, {\n                onBlockedNode: (id, node) => {\n                    const message = `Too many mutations on node '${id}'. Rate limiting. This could be due to SVG animations or something similar`\n                    logger.log(message, {\n                        node: node,\n                    })\n\n                    this.log('[PostHog Recorder] ' + message, 'warn')\n                },\n            })\n\n        this.stopRrweb = this.rrwebRecord({\n            emit: (event) => {\n                this.onRRwebEmit(event)\n            },\n            plugins:\n                (window as any).rrwebConsoleRecord && this.isConsoleLogCaptureEnabled()\n                    ? [(window as any).rrwebConsoleRecord.getRecordConsolePlugin()]\n                    : [],\n            ...sessionRecordingOptions,\n        })\n\n        // :TRICKY: rrweb does not capture navigation within SPA-s, so hook into our $pageview events to get access to all events.\n        //   Dropping the initial event is fine (it's always captured by rrweb).\n        this.instance._addCaptureHook((eventName) => {\n            // If anything could go wrong here it has the potential to block the main loop so we catch all errors.\n            try {\n                if (eventName === '$pageview') {\n                    this.rrwebRecord?.addCustomEvent('$pageview', { href: window.location.href })\n                }\n            } catch (e) {\n                logger.error('Could not add $pageview to rrweb session', e)\n            }\n        })\n\n        // We reset the last activity timestamp, resetting the idle timer\n        this.lastActivityTimestamp = Date.now()\n        this.isIdle = false\n    }\n\n    onRRwebEmit(rawEvent: eventWithTime) {\n        if (!rawEvent || typeof rawEvent !== 'object') {\n            return\n        }\n\n        const throttledEvent = this.mutationRateLimiter\n            ? this.mutationRateLimiter.throttleMutations(rawEvent)\n            : rawEvent\n\n        if (!throttledEvent) {\n            return\n        }\n\n        const { event, size } = ensureMaxMessageSize(truncateLargeConsoleLogs(throttledEvent))\n\n        this._updateWindowAndSessionIds(event)\n\n        if (this.isIdle) {\n            // When in an idle state we keep recording, but don't capture the events\n            return\n        }\n\n        const properties = {\n            $snapshot_bytes: size,\n            $snapshot_data: event,\n            $session_id: this.sessionId,\n            $window_id: this.windowId,\n        }\n\n        this.instance._captureMetrics.incr('rrweb-record')\n        this.instance._captureMetrics.incr(`rrweb-record-${event.type}`)\n\n        if (this.emit) {\n            this._captureSnapshotBuffered(properties)\n        } else {\n            this.snapshots.push(properties)\n        }\n    }\n\n    private _flushBuffer() {\n        if (this.flushBufferTimer) {\n            clearTimeout(this.flushBufferTimer)\n            this.flushBufferTimer = undefined\n        }\n\n        if (this.buffer && this.buffer.data.length !== 0) {\n            this._captureSnapshot({\n                $snapshot_bytes: this.buffer.size,\n                $snapshot_data: this.buffer.data,\n                $session_id: this.buffer.sessionId,\n                $window_id: this.buffer.windowId,\n            })\n        }\n\n        this.buffer = undefined\n\n        return {\n            size: 0,\n            data: [],\n            sessionId: this.sessionId,\n            windowId: this.windowId,\n        }\n    }\n\n    private _captureSnapshotBuffered(properties: Properties) {\n        const additionalBytes = 2 + (this.buffer?.data.length || 0) // 2 bytes for the array brackets and 1 byte for each comma\n        if (\n            !this.buffer ||\n            this.buffer.size + properties.$snapshot_bytes + additionalBytes > RECORDING_MAX_EVENT_SIZE ||\n            this.buffer.sessionId !== this.sessionId\n        ) {\n            this.buffer = this._flushBuffer()\n        }\n\n        this.buffer.size += properties.$snapshot_bytes\n        this.buffer.data.push(properties.$snapshot_data)\n\n        if (!this.flushBufferTimer) {\n            this.flushBufferTimer = setTimeout(() => {\n                this._flushBuffer()\n            }, RECORDING_BUFFER_TIMEOUT)\n        }\n    }\n\n    private _captureSnapshot(properties: Properties) {\n        // :TRICKY: Make sure we batch these requests, use a custom endpoint and don't truncate the strings.\n        this.instance.capture('$snapshot', properties, {\n            transport: 'XHR',\n            method: 'POST',\n            endpoint: this.endpoint,\n            _noTruncate: true,\n            _batchKey: SESSION_RECORDING_BATCH_KEY,\n            _metrics: {\n                rrweb_full_snapshot: properties.$snapshot_data.type === FULL_SNAPSHOT_EVENT_TYPE,\n            },\n        })\n    }\n}\n","import { isLocalhost, logger } from '../utils'\nimport { PostHog } from '../posthog-core'\nimport { DecideResponse, NetworkRequest } from '../types'\n\nconst PERFORMANCE_EVENTS_MAPPING: { [key: string]: number } = {\n    // BASE_PERFORMANCE_EVENT_COLUMNS\n    entryType: 0,\n    timeOrigin: 1,\n    name: 2,\n\n    // RESOURCE_EVENT_COLUMNS\n    startTime: 3,\n    redirectStart: 4,\n    redirectEnd: 5,\n    workerStart: 6,\n    fetchStart: 7,\n    domainLookupStart: 8,\n    domainLookupEnd: 9,\n    connectStart: 10,\n    secureConnectionStart: 11,\n    connectEnd: 12,\n    requestStart: 13,\n    responseStart: 14,\n    responseEnd: 15,\n    decodedBodySize: 16,\n    encodedBodySize: 17,\n    initiatorType: 18,\n    nextHopProtocol: 19,\n    renderBlockingStatus: 20,\n    responseStatus: 21,\n    transferSize: 22,\n\n    // LARGEST_CONTENTFUL_PAINT_EVENT_COLUMNS\n    element: 23,\n    renderTime: 24,\n    loadTime: 25,\n    size: 26,\n    id: 27,\n    url: 28,\n\n    // NAVIGATION_EVENT_COLUMNS\n    domComplete: 29,\n    domContentLoadedEvent: 30,\n    domInteractive: 31,\n    loadEventEnd: 32,\n    loadEventStart: 33,\n    redirectCount: 34,\n    navigationType: 35,\n    unloadEventEnd: 36,\n    unloadEventStart: 37,\n\n    // Added after v1\n    duration: 39,\n    timestamp: 40,\n\n    // NOTE: CURRENTLY UNSUPPORTED\n    // EVENT_TIMING_EVENT_COLUMNS\n    // processingStart: null,\n    // processingEnd: null,\n\n    // MARK_AND_MEASURE_EVENT_COLUMNS\n    // detail: null,\n}\n\nconst ENTRY_TYPES_TO_OBSERVE = [\n    // 'event', // This is too noisy as it covers all browser events\n    'first-input',\n    // 'mark', // Mark is used too liberally. We would need to filter for specific marks\n    // 'measure', // Measure is used too liberally. We would need to filter for specific measures\n    'navigation',\n    'paint',\n    'resource',\n]\n\nconst PERFORMANCE_INGESTION_ENDPOINT = '/e/'\n// Don't monitor posthog paths because then events cause performance events which are events and the snake eats its tail 😱\nconst POSTHOG_PATHS_TO_IGNORE = ['/s/', PERFORMANCE_INGESTION_ENDPOINT]\n\nexport class WebPerformanceObserver {\n    instance: PostHog\n    remoteEnabled: boolean | undefined\n    observer: PerformanceObserver | undefined\n\n    // Util to help developers working on this feature manually override\n    _forceAllowLocalhost = false\n\n    constructor(instance: PostHog) {\n        this.instance = instance\n    }\n\n    startObservingIfEnabled() {\n        if (this.isEnabled()) {\n            this.startObserving()\n        } else {\n            this.stopObserving()\n        }\n    }\n\n    startObserving() {\n        if (this.observer) {\n            return\n        }\n\n        if (window?.PerformanceObserver?.supportedEntryTypes === undefined) {\n            logger.log(\n                'PostHog Performance observer not started because PerformanceObserver is not supported by this browser.'\n            )\n            return\n        }\n\n        if (isLocalhost() && !this._forceAllowLocalhost) {\n            logger.log('PostHog Peformance observer not started because we are on localhost.')\n            return\n        }\n\n        try {\n            // compat checked above with early return\n            // eslint-disable-next-line compat/compat\n            this.observer = new PerformanceObserver((list) => {\n                list.getEntries().forEach((entry) => {\n                    this._capturePerformanceEvent(entry)\n                })\n            })\n\n            // compat checked above with early return\n            // eslint-disable-next-line compat/compat\n            const entryTypes = PerformanceObserver.supportedEntryTypes.filter((x) => ENTRY_TYPES_TO_OBSERVE.includes(x))\n\n            entryTypes.forEach((entryType) => {\n                this.observer?.observe({ type: entryType, buffered: true })\n            })\n        } catch (e) {\n            console.error('PostHog failed to start performance observer', e)\n            this.stopObserving()\n        }\n    }\n\n    stopObserving() {\n        if (this.observer) {\n            this.observer.disconnect()\n            this.observer = undefined\n        }\n    }\n\n    isObserving() {\n        return !!this.observer\n    }\n\n    isEnabled() {\n        return this.instance.get_config('capture_performance') ?? this.remoteEnabled ?? false\n    }\n\n    afterDecideResponse(response: DecideResponse) {\n        this.remoteEnabled = response.capturePerformance || false\n        if (this.isEnabled()) {\n            this.startObserving()\n        }\n    }\n\n    _capturePerformanceEvent(event: PerformanceEntry) {\n        // NOTE: We don't want to capture our own request events.\n\n        if (event.name.indexOf(this.instance.get_config('api_host')) === 0) {\n            const path = event.name.replace(this.instance.get_config('api_host'), '')\n\n            if (POSTHOG_PATHS_TO_IGNORE.find((x) => path.indexOf(x) === 0)) {\n                return\n            }\n        }\n\n        // NOTE: This is minimal atm but will include more options when we move to the\n        // built-in rrweb network recorder\n        let networkRequest: NetworkRequest | null | undefined = {\n            url: event.name,\n        }\n\n        const userSessionRecordingOptions = this.instance.get_config('session_recording')\n\n        if (userSessionRecordingOptions.maskNetworkRequestFn) {\n            networkRequest = userSessionRecordingOptions.maskNetworkRequestFn(networkRequest)\n        }\n\n        if (!networkRequest) {\n            return\n        }\n\n        const eventJson = event.toJSON()\n        eventJson.name = networkRequest.url\n        const properties: { [key: number]: any } = {}\n        // kudos to sentry javascript sdk for excellent background on why to use Date.now() here\n        // https://github.com/getsentry/sentry-javascript/blob/e856e40b6e71a73252e788cd42b5260f81c9c88e/packages/utils/src/time.ts#L70\n        // can't start observer if performance.now() is not available\n        // eslint-disable-next-line compat/compat\n        const timeOrigin = Math.floor(Date.now() - performance.now())\n        properties[PERFORMANCE_EVENTS_MAPPING['timeOrigin']] = timeOrigin\n        // clickhouse can't ingest timestamps that are floats\n        // (in this case representing fractions of a millisecond we don't care about anyway)\n        properties[PERFORMANCE_EVENTS_MAPPING['timestamp']] = Math.floor(timeOrigin + event.startTime)\n        for (const key in PERFORMANCE_EVENTS_MAPPING) {\n            if (eventJson[key] !== undefined) {\n                properties[PERFORMANCE_EVENTS_MAPPING[key]] = eventJson[key]\n            }\n        }\n\n        this.capturePerformanceEvent(properties)\n\n        if (exposesServerTiming(event)) {\n            for (const timing of event.serverTiming || []) {\n                this.capturePerformanceEvent({\n                    [PERFORMANCE_EVENTS_MAPPING['timeOrigin']]: timeOrigin,\n                    [PERFORMANCE_EVENTS_MAPPING['timestamp']]: Math.floor(timeOrigin + event.startTime),\n                    [PERFORMANCE_EVENTS_MAPPING['name']]: timing.name,\n                    [PERFORMANCE_EVENTS_MAPPING['duration']]: timing.duration,\n                    // the spec has a closed list of possible types\n                    // https://developer.mozilla.org/en-US/docs/Web/API/PerformanceEntry/entryType\n                    // but, we need to know this was a server timing so that we know to\n                    // match it to the appropriate navigation or resource timing\n                    // that matching will have to be on timestamp and $current_url\n                    [PERFORMANCE_EVENTS_MAPPING['entryType']]: 'serverTiming',\n                })\n            }\n        }\n    }\n\n    /**\n     * :TRICKY: Make sure we batch these requests, and don't truncate the strings.\n     */\n    private capturePerformanceEvent(properties: { [key: number]: any }) {\n        const timestamp = properties[PERFORMANCE_EVENTS_MAPPING['timestamp']]\n\n        this.instance.sessionRecording?.onRRwebEmit({\n            type: 6, // EventType.Plugin,\n            data: {\n                plugin: 'posthog/network@1',\n                payload: properties,\n            },\n            timestamp,\n        })\n\n        // this.instance.capture('$performance_event', properties, {\n        //     transport: 'XHR',\n        //     method: 'POST',\n        //     endpoint: PERFORMANCE_INGESTION_ENDPOINT,\n        //     _noTruncate: true,\n        //     _batchKey: 'performanceEvent',\n        // })\n    }\n}\n\n/**\n *  Check if this PerformanceEntry is either a PerformanceResourceTiming or a PerformanceNavigationTiming\n *  NB PerformanceNavigationTiming extends PerformanceResourceTiming\n *  Here we don't care which interface it implements as both expose `serverTimings`\n */\nconst exposesServerTiming = (event: PerformanceEntry): event is PerformanceResourceTiming =>\n    event.entryType === 'navigation' || event.entryType === 'resource'\n","import { autocapture } from './autocapture'\nimport { _base64Encode, loadScript } from './utils'\nimport { PostHog } from './posthog-core'\nimport { Compression, DecideResponse } from './types'\nimport { STORED_GROUP_PROPERTIES_KEY, STORED_PERSON_PROPERTIES_KEY } from './posthog-persistence'\n\nexport class Decide {\n    instance: PostHog\n\n    constructor(instance: PostHog) {\n        this.instance = instance\n        // don't need to wait for `decide` to return if flags were provided on initialisation\n        this.instance.decideEndpointWasHit = this.instance._hasBootstrappedFeatureFlags()\n    }\n\n    call(): void {\n        /*\n        Calls /decide endpoint to fetch options for autocapture, session recording, feature flags & compression.\n        */\n        const json_data = JSON.stringify({\n            token: this.instance.get_config('token'),\n            distinct_id: this.instance.get_distinct_id(),\n            groups: this.instance.getGroups(),\n            person_properties: this.instance.get_property(STORED_PERSON_PROPERTIES_KEY),\n            group_properties: this.instance.get_property(STORED_GROUP_PROPERTIES_KEY),\n            disable_flags:\n                this.instance.get_config('advanced_disable_feature_flags') ||\n                this.instance.get_config('advanced_disable_feature_flags_on_first_load') ||\n                undefined,\n        })\n\n        const encoded_data = _base64Encode(json_data)\n        this.instance._send_request(\n            `${this.instance.get_config('api_host')}/decide/?v=3`,\n            { data: encoded_data, verbose: true },\n            { method: 'POST' },\n            (response) => this.parseDecideResponse(response as DecideResponse)\n        )\n    }\n\n    parseDecideResponse(response: DecideResponse): void {\n        if (response?.status === 0) {\n            console.error('Failed to fetch feature flags from PostHog.')\n            return\n        }\n        if (!(document && document.body)) {\n            console.log('document not ready yet, trying again in 500 milliseconds...')\n            setTimeout(() => {\n                this.parseDecideResponse(response)\n            }, 500)\n            return\n        }\n\n        this.instance.toolbar.afterDecideResponse(response)\n        this.instance.sessionRecording?.afterDecideResponse(response)\n        autocapture.afterDecideResponse(response, this.instance)\n        this.instance.webPerformance?.afterDecideResponse(response)\n        this.instance.exceptionAutocapture?.afterDecideResponse(response)\n\n        if (!this.instance.get_config('advanced_disable_feature_flags_on_first_load')) {\n            this.instance.featureFlags.receivedFeatureFlags(response)\n        }\n\n        this.instance['compression'] = {}\n        if (response['supportedCompression'] && !this.instance.get_config('disable_compression')) {\n            const compression: Partial<Record<Compression, boolean>> = {}\n            for (const method of response['supportedCompression']) {\n                compression[method] = true\n            }\n            this.instance['compression'] = compression\n        }\n\n        if (response['siteApps']) {\n            if (this.instance.get_config('opt_in_site_apps')) {\n                const apiHost = this.instance.get_config('api_host')\n                for (const { id, url } of response['siteApps']) {\n                    const scriptUrl = [\n                        apiHost,\n                        apiHost[apiHost.length - 1] === '/' && url[0] === '/' ? url.substring(1) : url,\n                    ].join('')\n\n                    ;(window as any)[`__$$ph_site_app_${id}`] = this.instance\n\n                    loadScript(scriptUrl, (err) => {\n                        if (err) {\n                            console.error(`Error while initializing PostHog app with config id ${id}`, err)\n                        }\n                    })\n                }\n            } else if (response['siteApps'].length > 0) {\n                console.error('PostHog site apps are disabled. Enable the \"opt_in_site_apps\" config to proceed.')\n            }\n        }\n    }\n}\n","export const POSTHOG_MANAGED_HOSTS = ['https://e.abla.io']\n","import { _getHashParam, _register_event, loadScript, logger } from '../utils'\nimport { PostHog } from '../posthog-core'\nimport { DecideResponse, ToolbarParams } from '../types'\nimport { POSTHOG_MANAGED_HOSTS } from './cloud'\n\nexport class Toolbar {\n    instance: PostHog\n    constructor(instance: PostHog) {\n        this.instance = instance\n    }\n\n    afterDecideResponse(response: DecideResponse) {\n        const toolbarParams: ToolbarParams =\n            response['toolbarParams'] ||\n            response['editorParams'] ||\n            (response['toolbarVersion'] ? { toolbarVersion: response['toolbarVersion'] } : {})\n        if (\n            response['isAuthenticated'] &&\n            toolbarParams['toolbarVersion'] &&\n            toolbarParams['toolbarVersion'].indexOf('toolbar') === 0\n        ) {\n            this.loadToolbar({\n                ...toolbarParams,\n            })\n        }\n    }\n\n    /**\n     * To load the toolbar, we need an access token and other state. That state comes from one of three places:\n     * 1. In the URL hash params\n     * 2. From session storage under the key `toolbarParams` if the toolbar was initialized on a previous page\n     */\n    maybeLoadToolbar(\n        location = window.location,\n        localStorage: Storage | undefined = undefined,\n        history = window.history\n    ): boolean {\n        try {\n            // Before running the code we check if we can access localStorage, if not we opt-out\n            if (!localStorage) {\n                try {\n                    window.localStorage.setItem('test', 'test')\n                    window.localStorage.removeItem('test')\n                } catch (error) {\n                    return false\n                }\n\n                // If localStorage was undefined, and localStorage is supported we set the default value\n                localStorage = window.localStorage\n            }\n\n            const stateHash = _getHashParam(location.hash, '__posthog') || _getHashParam(location.hash, 'state')\n            const state = stateHash ? JSON.parse(decodeURIComponent(stateHash)) : null\n            const parseFromUrl = state && state['action'] === 'ph_authorize'\n            let toolbarParams: ToolbarParams\n\n            if (parseFromUrl) {\n                // happens if they are initializing the toolbar using an old snippet\n                toolbarParams = state\n                toolbarParams.source = 'url'\n\n                if (toolbarParams && Object.keys(toolbarParams).length > 0) {\n                    if (state['desiredHash']) {\n                        // hash that was in the url before the redirect\n                        location.hash = state['desiredHash']\n                    } else if (history) {\n                        history.replaceState('', document.title, location.pathname + location.search) // completely remove hash\n                    } else {\n                        location.hash = '' // clear hash (but leaves # unfortunately)\n                    }\n                }\n            } else {\n                // get credentials from localStorage from a previous initialzation\n                toolbarParams = JSON.parse(localStorage.getItem('_postHogToolbarParams') || '{}')\n                toolbarParams.source = 'localstorage'\n\n                // delete \"add-action\" or other intent from toolbarParams, otherwise we'll have the same intent\n                // every time we open the page (e.g. you just visiting your own site an hour later)\n                delete toolbarParams.userIntent\n            }\n\n            if (toolbarParams['token'] && this.instance.get_config('token') === toolbarParams['token']) {\n                this.loadToolbar(toolbarParams)\n                return true\n            } else {\n                return false\n            }\n        } catch (e) {\n            return false\n        }\n    }\n\n    loadToolbar(params?: ToolbarParams): boolean {\n        if ((window as any)['_postHogToolbarLoaded']) {\n            return false\n        }\n        // only load the toolbar once, even if there are multiple instances of PostHogLib\n        ;(window as any)['_postHogToolbarLoaded'] = true\n\n        // By design array.js, recorder.js, and toolbar.js are served from Django with no or limited caching, not from our CDN\n        // Django respects the query params for caching, returning a 304 if appropriate\n        const host = this.instance.get_config('api_host')\n        const timestampToNearestThirtySeconds = Math.floor(Date.now() / 30000) * 30000\n        const toolbarUrl = `${host}${\n            host.endsWith('/') ? '' : '/'\n        }static/toolbar.js?_ts=${timestampToNearestThirtySeconds}`\n        const disableToolbarMetrics =\n            !POSTHOG_MANAGED_HOSTS.includes(this.instance.get_config('api_host')) &&\n            this.instance.get_config('advanced_disable_toolbar_metrics')\n\n        const toolbarParams = {\n            token: this.instance.get_config('token'),\n            ...params,\n            apiURL: host, // defaults to api_host from the instance config if nothing else set\n            ...(disableToolbarMetrics ? { instrument: false } : {}),\n        }\n\n        const { source: _discard, ...paramsToPersist } = toolbarParams // eslint-disable-line\n        window.localStorage.setItem('_postHogToolbarParams', JSON.stringify(paramsToPersist))\n\n        loadScript(toolbarUrl, (err) => {\n            if (err) {\n                logger.error('Failed to load toolbar', err)\n                return\n            }\n            ;((window as any)['ph_load_toolbar'] || (window as any)['ph_load_editor'])(toolbarParams, this.instance)\n        })\n        // Turbolinks doesn't fire an onload event but does replace the entire body, including the toolbar.\n        // Thus, we ensure the toolbar is only loaded inside the body, and then reloaded on turbolinks:load.\n        _register_event(window, 'turbolinks:load', () => {\n            ;(window as any)['_postHogToolbarLoaded'] = false\n            this.loadToolbar(toolbarParams)\n        })\n        return true\n    }\n\n    /** @deprecated Use \"loadToolbar\" instead. */\n    _loadEditor(params: ToolbarParams): boolean {\n        return this.loadToolbar(params)\n    }\n\n    /** @deprecated Use \"maybeLoadToolbar\" instead. */\n    maybeLoadEditor(\n        location = window.location,\n        localStorage: Storage | undefined = undefined,\n        history = window.history\n    ): boolean {\n        return this.maybeLoadToolbar(location, localStorage, history)\n    }\n}\n","/**\n * GDPR utils\n *\n * The General Data Protection Regulation (GDPR) is a regulation in EU law on data protection\n * and privacy for all individuals within the European Union. It addresses the export of personal\n * data outside the EU. The GDPR aims primarily to give control back to citizens and residents\n * over their personal data and to simplify the regulatory environment for international business\n * by unifying the regulation within the EU.\n *\n * This set of utilities is intended to enable opt in/out functionality in the PostHog JS SDK.\n * These functions are used internally by the SDK and are not intended to be publicly exposed.\n */\n\nimport { _each, _includes, _isNumber, _isString, window } from './utils'\nimport { cookieStore, localStore, localPlusCookieStore } from './storage'\nimport { GDPROptions, PersistentStore } from './types'\nimport { PostHog } from './posthog-core'\n\n/**\n * A function used to capture a PostHog event (e.g. PostHogLib.capture)\n * @callback captureFunction\n * @param {String} event_name The name of the event. This can be anything the user does - 'Button Click', 'Sign Up', 'Item Purchased', etc.\n * @param {Object} [properties] A set of properties to include with the event you're sending. These describe the user who did the event or details about the event itself.\n * @param {Function} [callback] If provided, the callback function will be called after capturing the event.\n */\n\n/** Public **/\n\nconst GDPR_DEFAULT_PERSISTENCE_PREFIX = '__ph_opt_in_out_'\n\n/**\n * Opt the user in to data capturing and cookies/localstorage for the given token\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {captureFunction} [options.capture] - function used for capturing a PostHog event to record the opt-in action\n * @param {string} [options.captureEventName] - event name to be used for capturing the opt-in action\n * @param {Object} [options.captureProperties] - set of properties to be captured along with the opt-in action\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-in cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-in cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-in cookie is set as secure or not\n */\nexport function optIn(token: string, options: GDPROptions): void {\n    _optInOut(true, token, options)\n}\n\n/**\n * Opt the user out of data capturing and cookies/localstorage for the given token\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-out cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-out cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-out cookie is set as secure or not\n */\nexport function optOut(token: string, options: GDPROptions): void {\n    _optInOut(false, token, options)\n}\n\n/**\n * Check whether the user has opted in to data capturing and cookies/localstorage for the given token\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @returns {boolean} whether the user has opted in to the given opt type\n */\nexport function hasOptedIn(token: string, options: GDPROptions): boolean {\n    return _getStorageValue(token, options) === '1'\n}\n\n/**\n * Check whether the user has opted out of data capturing and cookies/localstorage for the given token\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {boolean} [options.respectDnt] - flag to take browser DNT setting into account\n * @returns {boolean} whether the user has opted out of the given opt type\n */\nexport function hasOptedOut(token: string, options: Partial<GDPROptions>): boolean {\n    if (_hasDoNotTrackFlagOn(options)) {\n        return true\n    }\n    return _getStorageValue(token, options) === '0'\n}\n\n/**\n * Clear the user's opt in/out status of data capturing and cookies/localstorage for the given token\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-in cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-in cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-in cookie is set as secure or not\n */\nexport function clearOptInOut(token: string, options: GDPROptions) {\n    options = options || {}\n    _getStorage(options).remove(_getStorageKey(token, options), !!options.crossSubdomainCookie)\n}\n\n/** Private **/\n\n/**\n * Get storage util\n * @param {Object} [options]\n * @param {string} [options.persistenceType]\n * @returns {object} either cookieStore or localStore\n */\nfunction _getStorage(options: GDPROptions): PersistentStore {\n    options = options || {}\n    if (options.persistenceType === 'localStorage') {\n        return localStore\n    }\n    if (options.persistenceType === 'localStorage+cookie') {\n        return localPlusCookieStore\n    }\n    return cookieStore\n}\n\n/**\n * Get the name of the cookie that is used for the given opt type (capturing, cookie, etc.)\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @returns {string} the name of the cookie for the given opt type\n */\nfunction _getStorageKey(token: string, options: GDPROptions) {\n    options = options || {}\n    return (options.persistencePrefix || GDPR_DEFAULT_PERSISTENCE_PREFIX) + token\n}\n\n/**\n * Get the value of the cookie that is used for the given opt type (capturing, cookie, etc.)\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @returns {string} the value of the cookie for the given opt type\n */\nfunction _getStorageValue(token: string, options: GDPROptions) {\n    return _getStorage(options).get(_getStorageKey(token, options))\n}\n\n/**\n * Check whether the user has set the DNT/doNotTrack setting to true in their browser\n * @param {Object} [options]\n * @param {string} [options.window] - alternate window object to check; used to force various DNT settings in browser tests\n * @param {boolean} [options.respectDnt] - flag to take browser DNT setting into account\n * @returns {boolean} whether the DNT setting is true\n */\nfunction _hasDoNotTrackFlagOn(options: GDPROptions) {\n    if (options && options.respectDnt) {\n        const win = (options && options.window) || window\n        const nav = win['navigator'] || {}\n        let hasDntOn = false\n        _each(\n            [\n                nav['doNotTrack'], // standard\n                (nav as any)['msDoNotTrack'],\n                (win as any)['doNotTrack'],\n            ],\n            function (dntValue) {\n                if (_includes([true, 1, '1', 'yes'], dntValue)) {\n                    hasDntOn = true\n                }\n            }\n        )\n        return hasDntOn\n    }\n    return false\n}\n\n/**\n * Set cookie/localstorage for the user indicating that they are opted in or out for the given opt type\n * @param {boolean} optValue - whether to opt the user in or out for the given opt type\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {captureFunction} [options.capture] - function used for capturing a PostHog event to record the opt-in action\n * @param {string} [options.captureEventName] - event name to be used for capturing the opt-in action\n * @param {Object} [options.captureProperties] - set of properties to be captured along with the opt-in action\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-in cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-in cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-in cookie is set as secure or not\n */\nfunction _optInOut(optValue: boolean, token: string, options: GDPROptions) {\n    if (!_isString(token) || !token.length) {\n        console.error('gdpr.' + (optValue ? 'optIn' : 'optOut') + ' called with an invalid token')\n        return\n    }\n\n    options = options || {}\n\n    _getStorage(options).set(\n        _getStorageKey(token, options),\n        optValue ? 1 : 0,\n        _isNumber(options.cookieExpiration) ? options.cookieExpiration : null,\n        options.crossSubdomainCookie,\n        options.secureCookie\n    )\n\n    if (options.capture && optValue) {\n        // only capture event if opting in (optValue=true)\n        options.capture(options.captureEventName || '$opt_in', options.captureProperties || {}, {\n            send_instantly: true,\n        })\n    }\n}\n\nexport function userOptedOut(posthog: PostHog, silenceErrors: boolean | undefined) {\n    let optedOut = false\n\n    try {\n        const token = posthog.get_config('token')\n        const respectDnt = posthog.get_config('respect_dnt')\n        const persistenceType = posthog.get_config('opt_out_capturing_persistence_type')\n        const persistencePrefix = posthog.get_config('opt_out_capturing_cookie_prefix') || undefined\n        const win = posthog.get_config('window' as any) as Window | undefined // used to override window during browser tests\n\n        if (token) {\n            // if there was an issue getting the token, continue method execution as normal\n            optedOut = hasOptedOut(token, {\n                respectDnt,\n                persistenceType,\n                persistencePrefix,\n                window: win,\n            })\n        }\n    } catch (err) {\n        if (!silenceErrors) {\n            console.error('Unexpected error when checking capturing opt-out status: ' + err)\n        }\n    }\n    return optedOut\n}\n\n/**\n * Wrap a method with a check for whether the user is opted out of data capturing and cookies/localstorage for the given token\n * If the user has opted out, return early instead of executing the method.\n * If a callback argument was provided, execute it passing the 0 error code.\n * @param {PostHog} posthog - the posthog instance\n * @param {function} method - wrapped method to be executed if the user has not opted out\n * @param silenceErrors\n * @returns {*} the result of executing method OR undefined if the user has opted out\n */\nexport function addOptOutCheck<M extends (...args: any[]) => any = (...args: any[]) => any>(\n    posthog: PostHog,\n    method: M,\n    silenceErrors?: boolean\n): M {\n    return function (...args) {\n        const optedOut = userOptedOut(posthog, silenceErrors)\n\n        if (!optedOut) {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            return method.apply(this, args)\n        }\n\n        const callback = args[args.length - 1]\n        if (typeof callback === 'function') {\n            callback(0)\n        }\n\n        return\n    } as M\n}\n","export class RequestQueueScaffold {\n    isPolling: boolean // flag to continue to recursively poll or not\n    _event_queue: any[]\n    _empty_queue_count: number // to track empty polls\n    _poller: number | undefined // to become interval for reference to clear later\n    _pollInterval: number\n\n    constructor(pollInterval = 3000) {\n        this.isPolling = true // flag to continue to recursively poll or not\n        this._event_queue = []\n        this._empty_queue_count = 0 // to track empty polls\n        this._poller = undefined // to become interval for reference to clear later\n        this._pollInterval = pollInterval\n    }\n\n    setPollInterval(interval: number): void {\n        this._pollInterval = interval\n        // Reset interval if running already\n        if (this.isPolling) {\n            this.poll()\n        }\n    }\n\n    // // eslint-disable-next-line no-unused-vars\n    // enqueue(_requestData: Record<string, any>): void {\n    //     return\n    // }\n\n    poll(): void {\n        return\n    }\n\n    unload(): void {\n        return\n    }\n\n    getTime(): number {\n        return new Date().getTime()\n    }\n}\n","import { RequestQueueScaffold } from './base-request-queue'\nimport { _each } from './utils'\nimport { CaptureMetrics } from './capture-metrics'\nimport { Properties, QueuedRequestData, XHROptions } from './types'\n\nexport class RequestQueue extends RequestQueueScaffold {\n    captureMetrics: CaptureMetrics\n    handlePollRequest: (url: string, data: Properties, options?: XHROptions) => void\n\n    constructor(\n        captureMetrics: CaptureMetrics,\n        handlePollRequest: (url: string, data: Properties, options?: XHROptions) => void,\n        pollInterval = 3000\n    ) {\n        super(pollInterval)\n        this.handlePollRequest = handlePollRequest\n        this.captureMetrics = captureMetrics\n    }\n\n    enqueue(url: string, data: Properties, options: XHROptions): void {\n        this.captureMetrics.incr('batch-enqueue')\n\n        this._event_queue.push({ url, data, options })\n\n        if (!this.isPolling) {\n            this.isPolling = true\n            this.poll()\n        }\n    }\n\n    poll(): void {\n        clearTimeout(this._poller)\n        this._poller = setTimeout(() => {\n            if (this._event_queue.length > 0) {\n                const requests = this.formatQueue()\n                for (const key in requests) {\n                    const { url, data, options } = requests[key]\n                    _each(data, (_, dataKey) => {\n                        data[dataKey]['offset'] = Math.abs(data[dataKey]['timestamp'] - this.getTime())\n                        delete data[dataKey]['timestamp']\n                    })\n                    this.handlePollRequest(url, data, options)\n\n                    this.captureMetrics.incr('batch-requests')\n                    this.captureMetrics.incr(`batch-requests-${url.slice(url.length - 2)}`)\n                    this.captureMetrics.incr('batch-handle', data.length)\n                    this.captureMetrics.incr(`batch-handle-${url.slice(url.length - 2)}`, data.length)\n                }\n                this._event_queue.length = 0 // flush the _event_queue\n                this._empty_queue_count = 0\n            } else {\n                this._empty_queue_count++\n            }\n\n            /**\n             * _empty_queue_count will increment each time the queue is polled\n             *  and it is empty. To avoid empty polling (user went idle, stepped away from comp)\n             *  we can turn it off with the isPolling flag.\n             *\n             * Polling will be re enabled when the next time PostHogLib.capture is called with\n             *  an event that should be added to the event queue.\n             */\n            if (this._empty_queue_count > 4) {\n                this.isPolling = false\n                this._empty_queue_count = 0\n            }\n            if (this.isPolling) {\n                this.poll()\n            }\n        }, this._pollInterval) as any as number\n    }\n\n    updateUnloadMetrics(): void {\n        const requests = this.formatQueue()\n        for (const key in requests) {\n            const { url, data } = requests[key]\n\n            this.captureMetrics.incr('batch-unload-requests')\n            this.captureMetrics.incr(`batch-unload-requests-${url.slice(url.length - 2)}`)\n            this.captureMetrics.incr('batch-unload', data.length)\n            this.captureMetrics.incr(`batch-unload-${url.slice(url.length - 2)}`, data.length)\n        }\n    }\n\n    unload(): void {\n        clearTimeout(this._poller)\n        const requests = this._event_queue.length > 0 ? this.formatQueue() : {}\n        this._event_queue.length = 0\n        const requestValues = Object.values(requests)\n\n        // Always force events to be sent before recordings, as events are more important, and recordings are bigger and thus less likely to arrive\n        const sortedRequests = [\n            ...requestValues.filter((r) => r.url.indexOf('/e') === 0),\n            ...requestValues.filter((r) => r.url.indexOf('/e') !== 0),\n        ]\n        sortedRequests.map(({ url, data, options }) => {\n            this.handlePollRequest(url, data, { ...options, transport: 'sendBeacon' })\n        })\n    }\n\n    formatQueue(): Record<string, QueuedRequestData> {\n        const requests: Record<string, QueuedRequestData> = {}\n        _each(this._event_queue, (request) => {\n            const { url, data, options } = request\n            const key = (options ? options._batchKey : null) || url\n            if (requests[key] === undefined) {\n                requests[key] = { data: [], url, options }\n            }\n\n            // :TRICKY: Metrics-only code\n            if (\n                options &&\n                requests[key].options &&\n                requests[key].options._metrics &&\n                !(requests[key].options._metrics as any)['rrweb_full_snapshot']\n            ) {\n                ;(requests[key].options._metrics as any)['rrweb_full_snapshot'] =\n                    options._metrics['rrweb_full_snapshot']\n            }\n            requests[key].data.push(data)\n        })\n        return requests\n    }\n}\n","export class CaptureMetrics {\n    enabled: boolean\n    metrics: Record<string, number>\n\n    constructor(enabled: boolean) {\n        this.enabled = enabled\n        this.metrics = {}\n    }\n\n    incr(key: string, by = 1): void {\n        if (this.enabled) {\n            key = `phjs-${key}`\n            this.metrics[key] = (this.metrics[key] || 0) + by\n        }\n    }\n\n    decr(key: string): void {\n        if (this.enabled) {\n            key = `phjs-${key}`\n            this.metrics[key] = (this.metrics[key] || 0) - 1\n        }\n    }\n}\n","// DEFLATE is a complex format; to read this code, you should probably check the RFC first:\n// https://tools.ietf.org/html/rfc1951\n// You may also wish to take a look at the guide I made about this program:\n// https://gist.github.com/101arrowz/253f31eb5abc3d9275ab943003ffecad\n// Much of the following code is similar to that of UZIP.js:\n// https://github.com/photopea/UZIP.js\n// Many optimizations have been made, so the bundle size is ultimately smaller but performance is similar.\n// Sometimes 0 will appear where -1 would be more appropriate. This is because using a uint\n// is better for memory in most engines (I *think*).\nvar ch2 = {};\nvar wk = (function (c, id, msg, transfer, cb) {\n    var u = ch2[id] || (ch2[id] = URL.createObjectURL(new Blob([c], { type: 'text/javascript' })));\n    var w = new Worker(u);\n    w.onerror = function (e) { return cb(e.error, null); };\n    w.onmessage = function (e) { return cb(null, e.data); };\n    w.postMessage(msg, transfer);\n    return w;\n});\n\n// aliases for shorter compressed code (most minifers don't do this)\nvar u8 = Uint8Array, u16 = Uint16Array, u32 = Uint32Array;\n// fixed length extra bits\nvar fleb = new u8([0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, /* unused */ 0, 0, /* impossible */ 0]);\n// fixed distance extra bits\n// see fleb note\nvar fdeb = new u8([0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, /* unused */ 0, 0]);\n// code length index map\nvar clim = new u8([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]);\n// get base, reverse index map from extra bits\nvar freb = function (eb, start) {\n    var b = new u16(31);\n    for (var i = 0; i < 31; ++i) {\n        b[i] = start += 1 << eb[i - 1];\n    }\n    // numbers here are at max 18 bits\n    var r = new u32(b[30]);\n    for (var i = 1; i < 30; ++i) {\n        for (var j = b[i]; j < b[i + 1]; ++j) {\n            r[j] = ((j - b[i]) << 5) | i;\n        }\n    }\n    return [b, r];\n};\nvar _a = freb(fleb, 2), fl = _a[0], revfl = _a[1];\n// we can ignore the fact that the other numbers are wrong; they never happen anyway\nfl[28] = 258, revfl[258] = 28;\nvar _b = freb(fdeb, 0), fd = _b[0], revfd = _b[1];\n// map of value to reverse (assuming 16 bits)\nvar rev = new u16(32768);\nfor (var i = 0; i < 32768; ++i) {\n    // reverse table algorithm from SO\n    var x = ((i & 0xAAAA) >>> 1) | ((i & 0x5555) << 1);\n    x = ((x & 0xCCCC) >>> 2) | ((x & 0x3333) << 2);\n    x = ((x & 0xF0F0) >>> 4) | ((x & 0x0F0F) << 4);\n    rev[i] = (((x & 0xFF00) >>> 8) | ((x & 0x00FF) << 8)) >>> 1;\n}\n// create huffman tree from u8 \"map\": index -> code length for code index\n// mb (max bits) must be at most 15\n// TODO: optimize/split up?\nvar hMap = (function (cd, mb, r) {\n    var s = cd.length;\n    // index\n    var i = 0;\n    // u16 \"map\": index -> # of codes with bit length = index\n    var l = new u16(mb);\n    // length of cd must be 288 (total # of codes)\n    for (; i < s; ++i)\n        ++l[cd[i] - 1];\n    // u16 \"map\": index -> minimum code for bit length = index\n    var le = new u16(mb);\n    for (i = 0; i < mb; ++i) {\n        le[i] = (le[i - 1] + l[i - 1]) << 1;\n    }\n    var co;\n    if (r) {\n        // u16 \"map\": index -> number of actual bits, symbol for code\n        co = new u16(1 << mb);\n        // bits to remove for reverser\n        var rvb = 15 - mb;\n        for (i = 0; i < s; ++i) {\n            // ignore 0 lengths\n            if (cd[i]) {\n                // num encoding both symbol and bits read\n                var sv = (i << 4) | cd[i];\n                // free bits\n                var r_1 = mb - cd[i];\n                // start value\n                var v = le[cd[i] - 1]++ << r_1;\n                // m is end value\n                for (var m = v | ((1 << r_1) - 1); v <= m; ++v) {\n                    // every 16 bit value starting with the code yields the same result\n                    co[rev[v] >>> rvb] = sv;\n                }\n            }\n        }\n    }\n    else {\n        co = new u16(s);\n        for (i = 0; i < s; ++i)\n            co[i] = rev[le[cd[i] - 1]++] >>> (15 - cd[i]);\n    }\n    return co;\n});\n// fixed length tree\nvar flt = new u8(288);\nfor (var i = 0; i < 144; ++i)\n    flt[i] = 8;\nfor (var i = 144; i < 256; ++i)\n    flt[i] = 9;\nfor (var i = 256; i < 280; ++i)\n    flt[i] = 7;\nfor (var i = 280; i < 288; ++i)\n    flt[i] = 8;\n// fixed distance tree\nvar fdt = new u8(32);\nfor (var i = 0; i < 32; ++i)\n    fdt[i] = 5;\n// fixed length map\nvar flm = /*#__PURE__*/ hMap(flt, 9, 0), flrm = /*#__PURE__*/ hMap(flt, 9, 1);\n// fixed distance map\nvar fdm = /*#__PURE__*/ hMap(fdt, 5, 0), fdrm = /*#__PURE__*/ hMap(fdt, 5, 1);\n// find max of array\nvar max = function (a) {\n    var m = a[0];\n    for (var i = 1; i < a.length; ++i) {\n        if (a[i] > m)\n            m = a[i];\n    }\n    return m;\n};\n// read d, starting at bit p and mask with m\nvar bits = function (d, p, m) {\n    var o = (p / 8) >> 0;\n    return ((d[o] | (d[o + 1] << 8)) >>> (p & 7)) & m;\n};\n// read d, starting at bit p continuing for at least 16 bits\nvar bits16 = function (d, p) {\n    var o = (p / 8) >> 0;\n    return ((d[o] | (d[o + 1] << 8) | (d[o + 2] << 16)) >>> (p & 7));\n};\n// get end of byte\nvar shft = function (p) { return ((p / 8) >> 0) + (p & 7 && 1); };\n// typed array slice - allows garbage collector to free original reference,\n// while being more compatible than .slice\nvar slc = function (v, s, e) {\n    if (s == null || s < 0)\n        s = 0;\n    if (e == null || e > v.length)\n        e = v.length;\n    // can't use .constructor in case user-supplied\n    var n = new (v instanceof u16 ? u16 : v instanceof u32 ? u32 : u8)(e - s);\n    n.set(v.subarray(s, e));\n    return n;\n};\n// expands raw DEFLATE data\nvar inflt = function (dat, buf, st) {\n    // source length\n    var sl = dat.length;\n    // have to estimate size\n    var noBuf = !buf || st;\n    // no state\n    var noSt = !st || st.i;\n    if (!st)\n        st = {};\n    // Assumes roughly 33% compression ratio average\n    if (!buf)\n        buf = new u8(sl * 3);\n    // ensure buffer can fit at least l elements\n    var cbuf = function (l) {\n        var bl = buf.length;\n        // need to increase size to fit\n        if (l > bl) {\n            // Double or set to necessary, whichever is greater\n            var nbuf = new u8(Math.max(bl * 2, l));\n            nbuf.set(buf);\n            buf = nbuf;\n        }\n    };\n    //  last chunk         bitpos           bytes\n    var final = st.f || 0, pos = st.p || 0, bt = st.b || 0, lm = st.l, dm = st.d, lbt = st.m, dbt = st.n;\n    // total bits\n    var tbts = sl * 8;\n    do {\n        if (!lm) {\n            // BFINAL - this is only 1 when last chunk is next\n            st.f = final = bits(dat, pos, 1);\n            // type: 0 = no compression, 1 = fixed huffman, 2 = dynamic huffman\n            var type = bits(dat, pos + 1, 3);\n            pos += 3;\n            if (!type) {\n                // go to end of byte boundary\n                var s = shft(pos) + 4, l = dat[s - 4] | (dat[s - 3] << 8), t = s + l;\n                if (t > sl) {\n                    if (noSt)\n                        throw 'unexpected EOF';\n                    break;\n                }\n                // ensure size\n                if (noBuf)\n                    cbuf(bt + l);\n                // Copy over uncompressed data\n                buf.set(dat.subarray(s, t), bt);\n                // Get new bitpos, update byte count\n                st.b = bt += l, st.p = pos = t * 8;\n                continue;\n            }\n            else if (type == 1)\n                lm = flrm, dm = fdrm, lbt = 9, dbt = 5;\n            else if (type == 2) {\n                //  literal                            lengths\n                var hLit = bits(dat, pos, 31) + 257, hcLen = bits(dat, pos + 10, 15) + 4;\n                var tl = hLit + bits(dat, pos + 5, 31) + 1;\n                pos += 14;\n                // length+distance tree\n                var ldt = new u8(tl);\n                // code length tree\n                var clt = new u8(19);\n                for (var i = 0; i < hcLen; ++i) {\n                    // use index map to get real code\n                    clt[clim[i]] = bits(dat, pos + i * 3, 7);\n                }\n                pos += hcLen * 3;\n                // code lengths bits\n                var clb = max(clt), clbmsk = (1 << clb) - 1;\n                if (!noSt && pos + tl * (clb + 7) > tbts)\n                    break;\n                // code lengths map\n                var clm = hMap(clt, clb, 1);\n                for (var i = 0; i < tl;) {\n                    var r = clm[bits(dat, pos, clbmsk)];\n                    // bits read\n                    pos += r & 15;\n                    // symbol\n                    var s = r >>> 4;\n                    // code length to copy\n                    if (s < 16) {\n                        ldt[i++] = s;\n                    }\n                    else {\n                        //  copy   count\n                        var c = 0, n = 0;\n                        if (s == 16)\n                            n = 3 + bits(dat, pos, 3), pos += 2, c = ldt[i - 1];\n                        else if (s == 17)\n                            n = 3 + bits(dat, pos, 7), pos += 3;\n                        else if (s == 18)\n                            n = 11 + bits(dat, pos, 127), pos += 7;\n                        while (n--)\n                            ldt[i++] = c;\n                    }\n                }\n                //    length tree                 distance tree\n                var lt = ldt.subarray(0, hLit), dt = ldt.subarray(hLit);\n                // max length bits\n                lbt = max(lt);\n                // max dist bits\n                dbt = max(dt);\n                lm = hMap(lt, lbt, 1);\n                dm = hMap(dt, dbt, 1);\n            }\n            else\n                throw 'invalid block type';\n            if (pos > tbts)\n                throw 'unexpected EOF';\n        }\n        // Make sure the buffer can hold this + the largest possible addition\n        // Maximum chunk size (practically, theoretically infinite) is 2^17;\n        if (noBuf)\n            cbuf(bt + 131072);\n        var lms = (1 << lbt) - 1, dms = (1 << dbt) - 1;\n        var mxa = lbt + dbt + 18;\n        while (noSt || pos + mxa < tbts) {\n            // bits read, code\n            var c = lm[bits16(dat, pos) & lms], sym = c >>> 4;\n            pos += c & 15;\n            if (pos > tbts)\n                throw 'unexpected EOF';\n            if (!c)\n                throw 'invalid length/literal';\n            if (sym < 256)\n                buf[bt++] = sym;\n            else if (sym == 256) {\n                lm = null;\n                break;\n            }\n            else {\n                var add = sym - 254;\n                // no extra bits needed if less\n                if (sym > 264) {\n                    // index\n                    var i = sym - 257, b = fleb[i];\n                    add = bits(dat, pos, (1 << b) - 1) + fl[i];\n                    pos += b;\n                }\n                // dist\n                var d = dm[bits16(dat, pos) & dms], dsym = d >>> 4;\n                if (!d)\n                    throw 'invalid distance';\n                pos += d & 15;\n                var dt = fd[dsym];\n                if (dsym > 3) {\n                    var b = fdeb[dsym];\n                    dt += bits16(dat, pos) & ((1 << b) - 1), pos += b;\n                }\n                if (pos > tbts)\n                    throw 'unexpected EOF';\n                if (noBuf)\n                    cbuf(bt + 131072);\n                var end = bt + add;\n                for (; bt < end; bt += 4) {\n                    buf[bt] = buf[bt - dt];\n                    buf[bt + 1] = buf[bt + 1 - dt];\n                    buf[bt + 2] = buf[bt + 2 - dt];\n                    buf[bt + 3] = buf[bt + 3 - dt];\n                }\n                bt = end;\n            }\n        }\n        st.l = lm, st.p = pos, st.b = bt;\n        if (lm)\n            final = 1, st.m = lbt, st.d = dm, st.n = dbt;\n    } while (!final);\n    return bt == buf.length ? buf : slc(buf, 0, bt);\n};\n// starting at p, write the minimum number of bits that can hold v to d\nvar wbits = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) >> 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n};\n// starting at p, write the minimum number of bits (>8) that can hold v to d\nvar wbits16 = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) >> 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n    d[o + 2] |= v >>> 16;\n};\n// creates code lengths from a frequency table\nvar hTree = function (d, mb) {\n    // Need extra info to make a tree\n    var t = [];\n    for (var i = 0; i < d.length; ++i) {\n        if (d[i])\n            t.push({ s: i, f: d[i] });\n    }\n    var s = t.length;\n    var t2 = t.slice();\n    if (!s)\n        return [new u8(0), 0];\n    if (s == 1) {\n        var v = new u8(t[0].s + 1);\n        v[t[0].s] = 1;\n        return [v, 1];\n    }\n    t.sort(function (a, b) { return a.f - b.f; });\n    // after i2 reaches last ind, will be stopped\n    // freq must be greater than largest possible number of symbols\n    t.push({ s: -1, f: 25001 });\n    var l = t[0], r = t[1], i0 = 0, i1 = 1, i2 = 2;\n    t[0] = { s: -1, f: l.f + r.f, l: l, r: r };\n    // efficient algorithm from UZIP.js\n    // i0 is lookbehind, i2 is lookahead - after processing two low-freq\n    // symbols that combined have high freq, will start processing i2 (high-freq,\n    // non-composite) symbols instead\n    // see https://reddit.com/r/photopea/comments/ikekht/uzipjs_questions/\n    while (i1 != s - 1) {\n        l = t[t[i0].f < t[i2].f ? i0++ : i2++];\n        r = t[i0 != i1 && t[i0].f < t[i2].f ? i0++ : i2++];\n        t[i1++] = { s: -1, f: l.f + r.f, l: l, r: r };\n    }\n    var maxSym = t2[0].s;\n    for (var i = 1; i < s; ++i) {\n        if (t2[i].s > maxSym)\n            maxSym = t2[i].s;\n    }\n    // code lengths\n    var tr = new u16(maxSym + 1);\n    // max bits in tree\n    var mbt = ln(t[i1 - 1], tr, 0);\n    if (mbt > mb) {\n        // more algorithms from UZIP.js\n        // TODO: find out how this code works (debt)\n        //  ind    debt\n        var i = 0, dt = 0;\n        //    left            cost\n        var lft = mbt - mb, cst = 1 << lft;\n        t2.sort(function (a, b) { return tr[b.s] - tr[a.s] || a.f - b.f; });\n        for (; i < s; ++i) {\n            var i2_1 = t2[i].s;\n            if (tr[i2_1] > mb) {\n                dt += cst - (1 << (mbt - tr[i2_1]));\n                tr[i2_1] = mb;\n            }\n            else\n                break;\n        }\n        dt >>>= lft;\n        while (dt > 0) {\n            var i2_2 = t2[i].s;\n            if (tr[i2_2] < mb)\n                dt -= 1 << (mb - tr[i2_2]++ - 1);\n            else\n                ++i;\n        }\n        for (; i >= 0 && dt; --i) {\n            var i2_3 = t2[i].s;\n            if (tr[i2_3] == mb) {\n                --tr[i2_3];\n                ++dt;\n            }\n        }\n        mbt = mb;\n    }\n    return [new u8(tr), mbt];\n};\n// get the max length and assign length codes\nvar ln = function (n, l, d) {\n    return n.s == -1\n        ? Math.max(ln(n.l, l, d + 1), ln(n.r, l, d + 1))\n        : (l[n.s] = d);\n};\n// length codes generation\nvar lc = function (c) {\n    var s = c.length;\n    // Note that the semicolon was intentional\n    while (s && !c[--s])\n        ;\n    var cl = new u16(++s);\n    //  ind      num         streak\n    var cli = 0, cln = c[0], cls = 1;\n    var w = function (v) { cl[cli++] = v; };\n    for (var i = 1; i <= s; ++i) {\n        if (c[i] == cln && i != s)\n            ++cls;\n        else {\n            if (!cln && cls > 2) {\n                for (; cls > 138; cls -= 138)\n                    w(32754);\n                if (cls > 2) {\n                    w(cls > 10 ? ((cls - 11) << 5) | 28690 : ((cls - 3) << 5) | 12305);\n                    cls = 0;\n                }\n            }\n            else if (cls > 3) {\n                w(cln), --cls;\n                for (; cls > 6; cls -= 6)\n                    w(8304);\n                if (cls > 2)\n                    w(((cls - 3) << 5) | 8208), cls = 0;\n            }\n            while (cls--)\n                w(cln);\n            cls = 1;\n            cln = c[i];\n        }\n    }\n    return [cl.subarray(0, cli), s];\n};\n// calculate the length of output from tree, code lengths\nvar clen = function (cf, cl) {\n    var l = 0;\n    for (var i = 0; i < cl.length; ++i)\n        l += cf[i] * cl[i];\n    return l;\n};\n// writes a fixed block\n// returns the new bit pos\nvar wfblk = function (out, pos, dat) {\n    // no need to write 00 as type: TypedArray defaults to 0\n    var s = dat.length;\n    var o = shft(pos + 2);\n    out[o] = s & 255;\n    out[o + 1] = s >>> 8;\n    out[o + 2] = out[o] ^ 255;\n    out[o + 3] = out[o + 1] ^ 255;\n    for (var i = 0; i < s; ++i)\n        out[o + i + 4] = dat[i];\n    return (o + 4 + s) * 8;\n};\n// writes a block\nvar wblk = function (dat, out, final, syms, lf, df, eb, li, bs, bl, p) {\n    wbits(out, p++, final);\n    ++lf[256];\n    var _a = hTree(lf, 15), dlt = _a[0], mlb = _a[1];\n    var _b = hTree(df, 15), ddt = _b[0], mdb = _b[1];\n    var _c = lc(dlt), lclt = _c[0], nlc = _c[1];\n    var _d = lc(ddt), lcdt = _d[0], ndc = _d[1];\n    var lcfreq = new u16(19);\n    for (var i = 0; i < lclt.length; ++i)\n        lcfreq[lclt[i] & 31]++;\n    for (var i = 0; i < lcdt.length; ++i)\n        lcfreq[lcdt[i] & 31]++;\n    var _e = hTree(lcfreq, 7), lct = _e[0], mlcb = _e[1];\n    var nlcc = 19;\n    for (; nlcc > 4 && !lct[clim[nlcc - 1]]; --nlcc)\n        ;\n    var flen = (bl + 5) << 3;\n    var ftlen = clen(lf, flt) + clen(df, fdt) + eb;\n    var dtlen = clen(lf, dlt) + clen(df, ddt) + eb + 14 + 3 * nlcc + clen(lcfreq, lct) + (2 * lcfreq[16] + 3 * lcfreq[17] + 7 * lcfreq[18]);\n    if (flen <= ftlen && flen <= dtlen)\n        return wfblk(out, p, dat.subarray(bs, bs + bl));\n    var lm, ll, dm, dl;\n    wbits(out, p, 1 + (dtlen < ftlen)), p += 2;\n    if (dtlen < ftlen) {\n        lm = hMap(dlt, mlb, 0), ll = dlt, dm = hMap(ddt, mdb, 0), dl = ddt;\n        var llm = hMap(lct, mlcb, 0);\n        wbits(out, p, nlc - 257);\n        wbits(out, p + 5, ndc - 1);\n        wbits(out, p + 10, nlcc - 4);\n        p += 14;\n        for (var i = 0; i < nlcc; ++i)\n            wbits(out, p + 3 * i, lct[clim[i]]);\n        p += 3 * nlcc;\n        var lcts = [lclt, lcdt];\n        for (var it = 0; it < 2; ++it) {\n            var clct = lcts[it];\n            for (var i = 0; i < clct.length; ++i) {\n                var len = clct[i] & 31;\n                wbits(out, p, llm[len]), p += lct[len];\n                if (len > 15)\n                    wbits(out, p, (clct[i] >>> 5) & 127), p += clct[i] >>> 12;\n            }\n        }\n    }\n    else {\n        lm = flm, ll = flt, dm = fdm, dl = fdt;\n    }\n    for (var i = 0; i < li; ++i) {\n        if (syms[i] > 255) {\n            var len = (syms[i] >>> 18) & 31;\n            wbits16(out, p, lm[len + 257]), p += ll[len + 257];\n            if (len > 7)\n                wbits(out, p, (syms[i] >>> 23) & 31), p += fleb[len];\n            var dst = syms[i] & 31;\n            wbits16(out, p, dm[dst]), p += dl[dst];\n            if (dst > 3)\n                wbits16(out, p, (syms[i] >>> 5) & 8191), p += fdeb[dst];\n        }\n        else {\n            wbits16(out, p, lm[syms[i]]), p += ll[syms[i]];\n        }\n    }\n    wbits16(out, p, lm[256]);\n    return p + ll[256];\n};\n// deflate options (nice << 13) | chain\nvar deo = /*#__PURE__*/ new u32([65540, 131080, 131088, 131104, 262176, 1048704, 1048832, 2114560, 2117632]);\n// empty\nvar et = /*#__PURE__*/ new u8(0);\n// compresses data into a raw DEFLATE buffer\nvar dflt = function (dat, lvl, plvl, pre, post, lst) {\n    var s = dat.length;\n    var o = new u8(pre + s + 5 * (1 + Math.floor(s / 7000)) + post);\n    // writing to this writes to the output buffer\n    var w = o.subarray(pre, o.length - post);\n    var pos = 0;\n    if (!lvl || s < 8) {\n        for (var i = 0; i <= s; i += 65535) {\n            // end\n            var e = i + 65535;\n            if (e < s) {\n                // write full block\n                pos = wfblk(w, pos, dat.subarray(i, e));\n            }\n            else {\n                // write final block\n                w[i] = lst;\n                pos = wfblk(w, pos, dat.subarray(i, s));\n            }\n        }\n    }\n    else {\n        var opt = deo[lvl - 1];\n        var n = opt >>> 13, c = opt & 8191;\n        var msk_1 = (1 << plvl) - 1;\n        //    prev 2-byte val map    curr 2-byte val map\n        var prev = new u16(32768), head = new u16(msk_1 + 1);\n        var bs1_1 = Math.ceil(plvl / 3), bs2_1 = 2 * bs1_1;\n        var hsh = function (i) { return (dat[i] ^ (dat[i + 1] << bs1_1) ^ (dat[i + 2] << bs2_1)) & msk_1; };\n        // 24576 is an arbitrary number of maximum symbols per block\n        // 424 buffer for last block\n        var syms = new u32(25000);\n        // length/literal freq   distance freq\n        var lf = new u16(288), df = new u16(32);\n        //  l/lcnt  exbits  index  l/lind  waitdx  bitpos\n        var lc_1 = 0, eb = 0, i = 0, li = 0, wi = 0, bs = 0;\n        for (; i < s; ++i) {\n            // hash value\n            var hv = hsh(i);\n            // index mod 32768\n            var imod = i & 32767;\n            // previous index with this value\n            var pimod = head[hv];\n            prev[imod] = pimod;\n            head[hv] = imod;\n            // We always should modify head and prev, but only add symbols if\n            // this data is not yet processed (\"wait\" for wait index)\n            if (wi <= i) {\n                // bytes remaining\n                var rem = s - i;\n                if ((lc_1 > 7000 || li > 24576) && rem > 423) {\n                    pos = wblk(dat, w, 0, syms, lf, df, eb, li, bs, i - bs, pos);\n                    li = lc_1 = eb = 0, bs = i;\n                    for (var j = 0; j < 286; ++j)\n                        lf[j] = 0;\n                    for (var j = 0; j < 30; ++j)\n                        df[j] = 0;\n                }\n                //  len    dist   chain\n                var l = 2, d = 0, ch_1 = c, dif = (imod - pimod) & 32767;\n                if (rem > 2 && hv == hsh(i - dif)) {\n                    var maxn = Math.min(n, rem) - 1;\n                    var maxd = Math.min(32767, i);\n                    // max possible length\n                    // not capped at dif because decompressors implement \"rolling\" index population\n                    var ml = Math.min(258, rem);\n                    while (dif <= maxd && --ch_1 && imod != pimod) {\n                        if (dat[i + l] == dat[i + l - dif]) {\n                            var nl = 0;\n                            for (; nl < ml && dat[i + nl] == dat[i + nl - dif]; ++nl)\n                                ;\n                            if (nl > l) {\n                                l = nl, d = dif;\n                                // break out early when we reach \"nice\" (we are satisfied enough)\n                                if (nl > maxn)\n                                    break;\n                                // now, find the rarest 2-byte sequence within this\n                                // length of literals and search for that instead.\n                                // Much faster than just using the start\n                                var mmd = Math.min(dif, nl - 2);\n                                var md = 0;\n                                for (var j = 0; j < mmd; ++j) {\n                                    var ti = (i - dif + j + 32768) & 32767;\n                                    var pti = prev[ti];\n                                    var cd = (ti - pti + 32768) & 32767;\n                                    if (cd > md)\n                                        md = cd, pimod = ti;\n                                }\n                            }\n                        }\n                        // check the previous match\n                        imod = pimod, pimod = prev[imod];\n                        dif += (imod - pimod + 32768) & 32767;\n                    }\n                }\n                // d will be nonzero only when a match was found\n                if (d) {\n                    // store both dist and len data in one Uint32\n                    // Make sure this is recognized as a len/dist with 28th bit (2^28)\n                    syms[li++] = 268435456 | (revfl[l] << 18) | revfd[d];\n                    var lin = revfl[l] & 31, din = revfd[d] & 31;\n                    eb += fleb[lin] + fdeb[din];\n                    ++lf[257 + lin];\n                    ++df[din];\n                    wi = i + l;\n                    ++lc_1;\n                }\n                else {\n                    syms[li++] = dat[i];\n                    ++lf[dat[i]];\n                }\n            }\n        }\n        pos = wblk(dat, w, lst, syms, lf, df, eb, li, bs, i - bs, pos);\n        // this is the easiest way to avoid needing to maintain state\n        if (!lst)\n            pos = wfblk(w, pos, et);\n    }\n    return slc(o, 0, pre + shft(pos) + post);\n};\n// CRC32 table\nvar crct = /*#__PURE__*/ (function () {\n    var t = new u32(256);\n    for (var i = 0; i < 256; ++i) {\n        var c = i, k = 9;\n        while (--k)\n            c = ((c & 1) && 0xEDB88320) ^ (c >>> 1);\n        t[i] = c;\n    }\n    return t;\n})();\n// CRC32\nvar crc = function () {\n    var c = 0xFFFFFFFF;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var cr = c;\n            for (var i = 0; i < d.length; ++i)\n                cr = crct[(cr & 255) ^ d[i]] ^ (cr >>> 8);\n            c = cr;\n        },\n        d: function () { return c ^ 0xFFFFFFFF; }\n    };\n};\n// Alder32\nvar adler = function () {\n    var a = 1, b = 0;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var n = a, m = b;\n            var l = d.length;\n            for (var i = 0; i != l;) {\n                var e = Math.min(i + 5552, l);\n                for (; i < e; ++i)\n                    n += d[i], m += n;\n                n %= 65521, m %= 65521;\n            }\n            a = n, b = m;\n        },\n        d: function () { return ((a >>> 8) << 16 | (b & 255) << 8 | (b >>> 8)) + ((a & 255) << 23) * 2; }\n    };\n};\n;\n// deflate with opts\nvar dopt = function (dat, opt, pre, post, st) {\n    return dflt(dat, opt.level == null ? 6 : opt.level, opt.mem == null ? Math.ceil(Math.max(8, Math.min(13, Math.log(dat.length))) * 1.5) : (12 + opt.mem), pre, post, !st);\n};\n// Walmart object spread\nvar mrg = function (a, b) {\n    var o = {};\n    for (var k in a)\n        o[k] = a[k];\n    for (var k in b)\n        o[k] = b[k];\n    return o;\n};\n// worker clone\n// This is possibly the craziest part of the entire codebase, despite how simple it may seem.\n// The only parameter to this function is a closure that returns an array of variables outside of the function scope.\n// We're going to try to figure out the variable names used in the closure as strings because that is crucial for workerization.\n// We will return an object mapping of true variable name to value (basically, the current scope as a JS object).\n// The reason we can't just use the original variable names is minifiers mangling the toplevel scope.\n// This took me three weeks to figure out how to do.\nvar wcln = function (fn, fnStr, td) {\n    var dt = fn();\n    var st = fn.toString();\n    var ks = st.slice(st.indexOf('[') + 1, st.lastIndexOf(']')).replace(/ /g, '').split(',');\n    for (var i = 0; i < dt.length; ++i) {\n        var v = dt[i], k = ks[i];\n        if (typeof v == 'function') {\n            fnStr += ';' + k + '=';\n            var st_1 = v.toString();\n            if (v.prototype) {\n                // for global objects\n                if (st_1.indexOf('[native code]') != -1) {\n                    var spInd = st_1.indexOf(' ', 8) + 1;\n                    fnStr += st_1.slice(spInd, st_1.indexOf('(', spInd));\n                }\n                else {\n                    fnStr += st_1;\n                    for (var t in v.prototype)\n                        fnStr += ';' + k + '.prototype.' + t + '=' + v.prototype[t].toString();\n                }\n            }\n            else\n                fnStr += st_1;\n        }\n        else\n            td[k] = v;\n    }\n    return [fnStr, td];\n};\nvar ch = [];\n// clone bufs\nvar cbfs = function (v) {\n    var tl = [];\n    for (var k in v) {\n        if (v[k] instanceof u8 || v[k] instanceof u16 || v[k] instanceof u32)\n            tl.push((v[k] = new v[k].constructor(v[k])).buffer);\n    }\n    return tl;\n};\n// use a worker to execute code\nvar wrkr = function (fns, init, id, cb) {\n    var _a;\n    if (!ch[id]) {\n        var fnStr = '', td_1 = {}, m = fns.length - 1;\n        for (var i = 0; i < m; ++i)\n            _a = wcln(fns[i], fnStr, td_1), fnStr = _a[0], td_1 = _a[1];\n        ch[id] = wcln(fns[m], fnStr, td_1);\n    }\n    var td = mrg({}, ch[id][1]);\n    return wk(ch[id][0] + ';onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage=' + init.toString() + '}', id, td, cbfs(td), cb);\n};\n// base async inflate fn\nvar bInflt = function () { return [u8, u16, u32, fleb, fdeb, clim, fl, fd, flrm, fdrm, rev, hMap, max, bits, bits16, shft, slc, inflt, inflateSync, pbf, gu8]; };\nvar bDflt = function () { return [u8, u16, u32, fleb, fdeb, clim, revfl, revfd, flm, flt, fdm, fdt, rev, deo, et, hMap, wbits, wbits16, hTree, ln, lc, clen, wfblk, wblk, shft, slc, dflt, dopt, deflateSync, pbf]; };\n// gzip extra\nvar gze = function () { return [gzh, gzhl, wbytes, crc, crct]; };\n// gunzip extra\nvar guze = function () { return [gzs, gzl]; };\n// zlib extra\nvar zle = function () { return [zlh, wbytes, adler]; };\n// unzlib extra\nvar zule = function () { return [zlv]; };\n// post buf\nvar pbf = function (msg) { return postMessage(msg, [msg.buffer]); };\n// get u8\nvar gu8 = function (o) { return o && o.size && new u8(o.size); };\n// async helper\nvar cbify = function (dat, opts, fns, init, id, cb) {\n    var w = wrkr(fns, init, id, function (err, dat) {\n        w.terminate();\n        cb(err, dat);\n    });\n    if (!opts.consume)\n        dat = new u8(dat);\n    w.postMessage([dat, opts], [dat.buffer]);\n    return function () { w.terminate(); };\n};\n// auto stream\nvar astrm = function (strm) {\n    strm.ondata = function (dat, final) { return postMessage([dat, final], [dat.buffer]); };\n    return function (ev) { return strm.push(ev.data[0], ev.data[1]); };\n};\n// async stream attach\nvar astrmify = function (fns, strm, opts, init, id) {\n    var t;\n    var w = wrkr(fns, init, id, function (err, dat) {\n        if (err)\n            w.terminate(), strm.ondata.call(strm, err);\n        else {\n            if (dat[1])\n                w.terminate();\n            strm.ondata.call(strm, err, dat[0], dat[1]);\n        }\n    });\n    w.postMessage(opts);\n    strm.push = function (d, f) {\n        if (t)\n            throw 'stream finished';\n        if (!strm.ondata)\n            throw 'no stream handler';\n        w.postMessage([d, t = f], [d.buffer]);\n    };\n    strm.terminate = function () { w.terminate(); };\n};\n// read 2 bytes\nvar b2 = function (d, b) { return d[b] | (d[b + 1] << 8); };\n// read 4 bytes\nvar b4 = function (d, b) { return (d[b] | (d[b + 1] << 8) | (d[b + 2] << 16)) + (d[b + 3] << 23) * 2; };\n// write bytes\nvar wbytes = function (d, b, v) {\n    for (; v; ++b)\n        d[b] = v, v >>>= 8;\n};\n// gzip header\nvar gzh = function (c, o) {\n    var fn = o.filename;\n    c[0] = 31, c[1] = 139, c[2] = 8, c[8] = o.level < 2 ? 4 : o.level == 9 ? 2 : 0, c[9] = 3; // assume Unix\n    if (o.mtime != 0)\n        wbytes(c, 4, Math.floor(new Date(o.mtime || Date.now()) / 1000));\n    if (fn) {\n        c[3] = 8;\n        for (var i = 0; i <= fn.length; ++i)\n            c[i + 10] = fn.charCodeAt(i);\n    }\n};\n// gzip footer: -8 to -4 = CRC, -4 to -0 is length\n// gzip start\nvar gzs = function (d) {\n    if (d[0] != 31 || d[1] != 139 || d[2] != 8)\n        throw 'invalid gzip data';\n    var flg = d[3];\n    var st = 10;\n    if (flg & 4)\n        st += d[10] | (d[11] << 8) + 2;\n    for (var zs = (flg >> 3 & 1) + (flg >> 4 & 1); zs > 0; zs -= !d[st++])\n        ;\n    return st + (flg & 2);\n};\n// gzip length\nvar gzl = function (d) {\n    var l = d.length;\n    return (d[l - 4] | d[l - 3] << 8 | d[l - 2] << 16) + (2 * (d[l - 1] << 23));\n};\n// gzip header length\nvar gzhl = function (o) { return 10 + ((o.filename && (o.filename.length + 1)) || 0); };\n// zlib header\nvar zlh = function (c, o) {\n    var lv = o.level, fl = lv == 0 ? 0 : lv < 6 ? 1 : lv == 9 ? 3 : 2;\n    c[0] = 120, c[1] = (fl << 6) | (fl ? (32 - 2 * fl) : 1);\n};\n// zlib valid\nvar zlv = function (d) {\n    if ((d[0] & 15) != 8 || (d[0] >>> 4) > 7 || ((d[0] << 8 | d[1]) % 31))\n        throw 'invalid zlib data';\n    if (d[1] & 32)\n        throw 'invalid zlib data: preset dictionaries not supported';\n};\nfunction AsyncCmpStrm(opts, cb) {\n    if (!cb && typeof opts == 'function')\n        cb = opts, opts = {};\n    this.ondata = cb;\n    return opts;\n}\n// zlib footer: -4 to -0 is Adler32\n/**\n * Streaming DEFLATE compression\n */\nvar Deflate = /*#__PURE__*/ (function () {\n    function Deflate(opts, cb) {\n        if (!cb && typeof opts == 'function')\n            cb = opts, opts = {};\n        this.ondata = cb;\n        this.o = opts || {};\n    }\n    Deflate.prototype.p = function (c, f) {\n        this.ondata(dopt(c, this.o, 0, 0, !f), f);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Deflate.prototype.push = function (chunk, final) {\n        if (this.d)\n            throw 'stream finished';\n        if (!this.ondata)\n            throw 'no stream handler';\n        this.d = final;\n        this.p(chunk, final || false);\n    };\n    return Deflate;\n}());\nexport { Deflate };\n/**\n * Asynchronous streaming DEFLATE compression\n */\nvar AsyncDeflate = /*#__PURE__*/ (function () {\n    function AsyncDeflate(opts, cb) {\n        astrmify([\n            bDflt,\n            function () { return [astrm, Deflate]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Deflate(ev.data);\n            onmessage = astrm(strm);\n        }, 6);\n    }\n    return AsyncDeflate;\n}());\nexport { AsyncDeflate };\nexport function deflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bDflt,\n    ], function (ev) { return pbf(deflateSync(ev.data[0], ev.data[1])); }, 0, cb);\n}\n/**\n * Compresses data with DEFLATE without any wrapper\n * @param data The data to compress\n * @param opts The compression options\n * @returns The deflated version of the data\n */\nexport function deflateSync(data, opts) {\n    if (opts === void 0) { opts = {}; }\n    return dopt(data, opts, 0, 0);\n}\n/**\n * Streaming DEFLATE decompression\n */\nvar Inflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an inflation stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Inflate(cb) {\n        this.s = {};\n        this.p = new u8(0);\n        this.ondata = cb;\n    }\n    Inflate.prototype.e = function (c) {\n        if (this.d)\n            throw 'stream finished';\n        if (!this.ondata)\n            throw 'no stream handler';\n        var l = this.p.length;\n        var n = new u8(l + c.length);\n        n.set(this.p), n.set(c, l), this.p = n;\n    };\n    Inflate.prototype.c = function (final) {\n        this.d = this.s.i = final || false;\n        var bts = this.s.b;\n        var dt = inflt(this.p, this.o, this.s);\n        this.ondata(slc(dt, bts, this.s.b), this.d);\n        this.o = slc(dt, this.s.b - 32768), this.s.b = this.o.length;\n        this.p = slc(this.p, (this.s.p / 8) >> 0), this.s.p &= 7;\n    };\n    /**\n     * Pushes a chunk to be inflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the final chunk\n     */\n    Inflate.prototype.push = function (chunk, final) {\n        this.e(chunk), this.c(final);\n    };\n    return Inflate;\n}());\nexport { Inflate };\n/**\n * Asynchronous streaming DEFLATE decompression\n */\nvar AsyncInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous inflation stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncInflate(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            function () { return [astrm, Inflate]; }\n        ], this, 0, function () {\n            var strm = new Inflate();\n            onmessage = astrm(strm);\n        }, 7);\n    }\n    return AsyncInflate;\n}());\nexport { AsyncInflate };\nexport function inflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bInflt\n    ], function (ev) { return pbf(inflateSync(ev.data[0], gu8(ev.data[1]))); }, 1, cb);\n}\n/**\n * Expands DEFLATE data with no wrapper\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function inflateSync(data, out) {\n    return inflt(data, out);\n}\n// before you yell at me for not just using extends, my reason is that TS inheritance is hard to workerize.\n/**\n * Streaming GZIP compression\n */\nvar Gzip = /*#__PURE__*/ (function () {\n    function Gzip(opts, cb) {\n        this.c = crc();\n        this.l = 0;\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be GZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gzip.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Gzip.prototype.p = function (c, f) {\n        this.c.p(c);\n        this.l += c.length;\n        var raw = dopt(c, this.o, this.v && gzhl(this.o), f && 8, !f);\n        if (this.v)\n            gzh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 8, this.c.d()), wbytes(raw, raw.length - 4, this.l);\n        this.ondata(raw, f);\n    };\n    return Gzip;\n}());\nexport { Gzip };\n/**\n * Asynchronous streaming GZIP compression\n */\nvar AsyncGzip = /*#__PURE__*/ (function () {\n    function AsyncGzip(opts, cb) {\n        astrmify([\n            bDflt,\n            gze,\n            function () { return [astrm, Deflate, Gzip]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Gzip(ev.data);\n            onmessage = astrm(strm);\n        }, 8);\n    }\n    return AsyncGzip;\n}());\nexport { AsyncGzip };\nexport function gzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bDflt,\n        gze,\n        function () { return [gzipSync]; }\n    ], function (ev) { return pbf(gzipSync(ev.data[0], ev.data[1])); }, 2, cb);\n}\n/**\n * Compresses data with GZIP\n * @param data The data to compress\n * @param opts The compression options\n * @returns The gzipped version of the data\n */\nexport function gzipSync(data, opts) {\n    if (opts === void 0) { opts = {}; }\n    var c = crc(), l = data.length;\n    c.p(data);\n    var d = dopt(data, opts, gzhl(opts), 8), s = d.length;\n    return gzh(d, opts), wbytes(d, s - 8, c.d()), wbytes(d, s - 4, l), d;\n}\n/**\n * Streaming GZIP decompression\n */\nvar Gunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates a GUNZIP stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Gunzip(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be GUNZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gunzip.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            var s = gzs(this.p);\n            if (s >= this.p.length && !final)\n                return;\n            this.p = this.p.subarray(s), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 8)\n                throw 'invalid gzip stream';\n            this.p = this.p.subarray(0, -8);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Gunzip;\n}());\nexport { Gunzip };\n/**\n * Asynchronous streaming GZIP decompression\n */\nvar AsyncGunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous GUNZIP stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncGunzip(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            guze,\n            function () { return [astrm, Inflate, Gunzip]; }\n        ], this, 0, function () {\n            var strm = new Gunzip();\n            onmessage = astrm(strm);\n        }, 9);\n    }\n    return AsyncGunzip;\n}());\nexport { AsyncGunzip };\nexport function gunzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bInflt,\n        guze,\n        function () { return [gunzipSync]; }\n    ], function (ev) { return pbf(gunzipSync(ev.data[0])); }, 3, cb);\n}\n/**\n * Expands GZIP data\n * @param data The data to decompress\n * @param out Where to write the data. GZIP already encodes the output size, so providing this doesn't save memory.\n * @returns The decompressed version of the data\n */\nexport function gunzipSync(data, out) {\n    return inflt(data.subarray(gzs(data), -8), out || new u8(gzl(data)));\n}\n/**\n * Streaming Zlib compression\n */\nvar Zlib = /*#__PURE__*/ (function () {\n    function Zlib(opts, cb) {\n        this.c = adler();\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be zlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Zlib.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Zlib.prototype.p = function (c, f) {\n        this.c.p(c);\n        var raw = dopt(c, this.o, this.v && 2, f && 4, !f);\n        if (this.v)\n            zlh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 4, this.c.d());\n        this.ondata(raw, f);\n    };\n    return Zlib;\n}());\nexport { Zlib };\n/**\n * Asynchronous streaming Zlib compression\n */\nvar AsyncZlib = /*#__PURE__*/ (function () {\n    function AsyncZlib(opts, cb) {\n        astrmify([\n            bDflt,\n            zle,\n            function () { return [astrm, Deflate, Zlib]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Zlib(ev.data);\n            onmessage = astrm(strm);\n        }, 10);\n    }\n    return AsyncZlib;\n}());\nexport { AsyncZlib };\nexport function zlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bDflt,\n        zle,\n        function () { return [zlibSync]; }\n    ], function (ev) { return pbf(zlibSync(ev.data[0], ev.data[1])); }, 4, cb);\n}\n/**\n * Compress data with Zlib\n * @param data The data to compress\n * @param opts The compression options\n * @returns The zlib-compressed version of the data\n */\nexport function zlibSync(data, opts) {\n    if (opts === void 0) { opts = {}; }\n    var a = adler();\n    a.p(data);\n    var d = dopt(data, opts, 2, 4);\n    return zlh(d, opts), wbytes(d, d.length - 4, a.d()), d;\n}\n/**\n * Streaming Zlib decompression\n */\nvar Unzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates a Zlib decompression stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Unzlib(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be unzlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzlib.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            if (this.p.length < 2 && !final)\n                return;\n            this.p = this.p.subarray(2), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 4)\n                throw 'invalid zlib stream';\n            this.p = this.p.subarray(0, -4);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Unzlib;\n}());\nexport { Unzlib };\n/**\n * Asynchronous streaming Zlib decompression\n */\nvar AsyncUnzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous Zlib decompression stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncUnzlib(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            zule,\n            function () { return [astrm, Inflate, Unzlib]; }\n        ], this, 0, function () {\n            var strm = new Unzlib();\n            onmessage = astrm(strm);\n        }, 11);\n    }\n    return AsyncUnzlib;\n}());\nexport { AsyncUnzlib };\nexport function unzlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bInflt,\n        zule,\n        function () { return [unzlibSync]; }\n    ], function (ev) { return pbf(unzlibSync(ev.data[0], gu8(ev.data[1]))); }, 5, cb);\n}\n/**\n * Expands Zlib data\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function unzlibSync(data, out) {\n    return inflt((zlv(data), data.subarray(2, -4)), out);\n}\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzip as compress, AsyncGzip as AsyncCompress };\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzipSync as compressSync, Gzip as Compress };\n/**\n * Streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar Decompress = /*#__PURE__*/ (function () {\n    /**\n     * Creates a decompression stream\n     * @param cb The callback to call whenever data is decompressed\n     */\n    function Decompress(cb) {\n        this.G = Gunzip;\n        this.I = Inflate;\n        this.Z = Unzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Decompress.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            throw 'no stream handler';\n        if (!this.s) {\n            if (this.p && this.p.length) {\n                var n = new u8(this.p.length + chunk.length);\n                n.set(this.p), n.set(chunk, this.p.length);\n            }\n            else\n                this.p = chunk;\n            if (this.p.length > 2) {\n                var _this_1 = this;\n                var cb = function () { _this_1.ondata.apply(_this_1, arguments); };\n                this.s = (this.p[0] == 31 && this.p[1] == 139 && this.p[2] == 8)\n                    ? new this.G(cb)\n                    : ((this.p[0] & 15) != 8 || (this.p[0] >> 4) > 7 || ((this.p[0] << 8 | this.p[1]) % 31))\n                        ? new this.I(cb)\n                        : new this.Z(cb);\n                this.s.push(this.p, final);\n                this.p = null;\n            }\n        }\n        else\n            this.s.push(chunk, final);\n    };\n    return Decompress;\n}());\nexport { Decompress };\n/**\n * Asynchronous streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar AsyncDecompress = /*#__PURE__*/ (function () {\n    /**\n   * Creates an asynchronous decompression stream\n   * @param cb The callback to call whenever data is decompressed\n   */\n    function AsyncDecompress(cb) {\n        this.G = AsyncGunzip;\n        this.I = AsyncInflate;\n        this.Z = AsyncUnzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncDecompress.prototype.push = function (chunk, final) {\n        Decompress.prototype.push.call(this, chunk, final);\n    };\n    return AsyncDecompress;\n}());\nexport { AsyncDecompress };\nexport function decompress(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzip(data, opts, cb)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflate(data, opts, cb)\n            : unzlib(data, opts, cb);\n}\n/**\n * Expands compressed GZIP, Zlib, or raw DEFLATE data, automatically detecting the format\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function decompressSync(data, out) {\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzipSync(data, out)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflateSync(data, out)\n            : unzlibSync(data, out);\n}\n// flatten a directory structure\nvar fltn = function (d, p, t, o) {\n    for (var k in d) {\n        var val = d[k], n = p + k;\n        if (val instanceof u8)\n            t[n] = [val, o];\n        else if (Array.isArray(val))\n            t[n] = [val[0], mrg(o, val[1])];\n        else\n            fltn(val, n + '/', t, o);\n    }\n};\n/**\n * Converts a string into a Uint8Array for use with compression/decompression methods\n * @param str The string to encode\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless decoding a binary string.\n * @returns The string encoded in UTF-8/Latin-1 binary\n */\nexport function strToU8(str, latin1) {\n    var l = str.length;\n    if (!latin1 && typeof TextEncoder != 'undefined')\n        return new TextEncoder().encode(str);\n    var ar = new u8(str.length + (str.length >>> 1));\n    var ai = 0;\n    var w = function (v) { ar[ai++] = v; };\n    for (var i = 0; i < l; ++i) {\n        if (ai + 5 > ar.length) {\n            var n = new u8(ai + 8 + ((l - i) << 1));\n            n.set(ar);\n            ar = n;\n        }\n        var c = str.charCodeAt(i);\n        if (c < 128 || latin1)\n            w(c);\n        else if (c < 2048)\n            w(192 | (c >>> 6)), w(128 | (c & 63));\n        else if (c > 55295 && c < 57344)\n            c = 65536 + (c & 1023 << 10) | (str.charCodeAt(++i) & 1023),\n                w(240 | (c >>> 18)), w(128 | ((c >>> 12) & 63)), w(128 | ((c >>> 6) & 63)), w(128 | (c & 63));\n        else\n            w(224 | (c >>> 12)), w(128 | ((c >>> 6) & 63)), w(128 | (c & 63));\n    }\n    return slc(ar, 0, ai);\n}\n/**\n * Converts a Uint8Array to a string\n * @param dat The data to decode to string\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless encoding to binary string.\n * @returns The original UTF-8/Latin-1 string\n */\nexport function strFromU8(dat, latin1) {\n    var r = '';\n    if (!latin1 && typeof TextDecoder != 'undefined')\n        return new TextDecoder().decode(dat);\n    for (var i = 0; i < dat.length;) {\n        var c = dat[i++];\n        if (c < 128 || latin1)\n            r += String.fromCharCode(c);\n        else if (c < 224)\n            r += String.fromCharCode((c & 31) << 6 | (dat[i++] & 63));\n        else if (c < 240)\n            r += String.fromCharCode((c & 15) << 12 | (dat[i++] & 63) << 6 | (dat[i++] & 63));\n        else\n            c = ((c & 15) << 18 | (dat[i++] & 63) << 12 | (dat[i++] & 63) << 6 | (dat[i++] & 63)) - 65536,\n                r += String.fromCharCode(55296 | (c >> 10), 56320 | (c & 1023));\n    }\n    return r;\n}\n;\n// skip local zip header\nvar slzh = function (d, b) { return b + 30 + b2(d, b + 26) + b2(d, b + 28); };\n// read zip header\nvar zh = function (d, b, z) {\n    var fnl = b2(d, b + 28), fn = strFromU8(d.subarray(b + 46, b + 46 + fnl), !(b2(d, b + 8) & 2048)), es = b + 46 + fnl;\n    var _a = z ? z64e(d, es) : [b4(d, b + 20), b4(d, b + 24), b4(d, b + 42)], sc = _a[0], su = _a[1], off = _a[2];\n    return [b2(d, b + 10), sc, su, fn, es + b2(d, b + 30) + b2(d, b + 32), off];\n};\n// read zip64 extra field\nvar z64e = function (d, b) {\n    for (; b2(d, b) != 1; b += 4 + b2(d, b + 2))\n        ;\n    return [b4(d, b + 12), b4(d, b + 4), b4(d, b + 20)];\n};\n// write zip header\nvar wzh = function (d, b, c, cmp, su, fn, u, o, ce, t) {\n    var fl = fn.length, l = cmp.length;\n    wbytes(d, b, ce != null ? 0x2014B50 : 0x4034B50), b += 4;\n    if (ce != null)\n        d[b] = 20, b += 2;\n    d[b] = 20, b += 2; // spec compliance? what's that?\n    d[b++] = (t == 8 && (o.level == 1 ? 6 : o.level < 6 ? 4 : o.level == 9 ? 2 : 0)), d[b++] = u && 8;\n    d[b] = t, b += 2;\n    var dt = new Date(o.mtime || Date.now()), y = dt.getFullYear() - 1980;\n    if (y < 0 || y > 119)\n        throw 'date not in range 1980-2099';\n    wbytes(d, b, ((y << 24) * 2) | ((dt.getMonth() + 1) << 21) | (dt.getDate() << 16) | (dt.getHours() << 11) | (dt.getMinutes() << 5) | (dt.getSeconds() >>> 1));\n    b += 4;\n    wbytes(d, b, c);\n    wbytes(d, b + 4, l);\n    wbytes(d, b + 8, su);\n    wbytes(d, b + 12, fl), b += 16; // skip extra field, comment\n    if (ce != null)\n        wbytes(d, b += 10, ce), b += 4;\n    d.set(fn, b);\n    b += fl;\n    if (ce == null)\n        d.set(cmp, b);\n};\n// write zip footer (end of central directory)\nvar wzf = function (o, b, c, d, e) {\n    wbytes(o, b, 0x6054B50); // skip disk\n    wbytes(o, b + 8, c);\n    wbytes(o, b + 10, c);\n    wbytes(o, b + 12, d);\n    wbytes(o, b + 16, e);\n};\nexport function zip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    var r = {};\n    fltn(data, '', r, opts);\n    var k = Object.keys(r);\n    var lft = k.length, o = 0, tot = 0;\n    var slft = lft, files = new Array(lft);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var cbf = function () {\n        var out = new u8(tot + 22), oe = o, cdl = tot - o;\n        tot = 0;\n        for (var i = 0; i < slft; ++i) {\n            var f = files[i];\n            try {\n                wzh(out, tot, f.c, f.d, f.m, f.n, f.u, f.p, null, f.t);\n                wzh(out, o, f.c, f.d, f.m, f.n, f.u, f.p, tot, f.t), o += 46 + f.n.length, tot += 30 + f.n.length + f.d.length;\n            }\n            catch (e) {\n                return cb(e, null);\n            }\n        }\n        wzf(out, o, files.length, cdl, oe);\n        cb(null, out);\n    };\n    if (!lft)\n        cbf();\n    var _loop_1 = function (i) {\n        var fn = k[i];\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var c = crc(), m = file.length;\n        c.p(file);\n        var n = strToU8(fn), s = n.length;\n        var t = p.level == 0 ? 0 : 8;\n        var cbl = function (e, d) {\n            if (e) {\n                tAll();\n                cb(e, null);\n            }\n            else {\n                var l = d.length;\n                files[i] = {\n                    t: t,\n                    d: d,\n                    m: m,\n                    c: c.d(),\n                    u: fn.length != l,\n                    n: n,\n                    p: p\n                };\n                o += 30 + s + l;\n                tot += 76 + 2 * s + l;\n                if (!--lft)\n                    cbf();\n            }\n        };\n        if (n.length > 65535)\n            cbl('filename too long', null);\n        if (!t)\n            cbl(null, file);\n        else if (m < 160000) {\n            try {\n                cbl(null, deflateSync(file, p));\n            }\n            catch (e) {\n                cbl(e, null);\n            }\n        }\n        else\n            term.push(deflate(file, p, cbl));\n    };\n    // Cannot use lft because it can decrease\n    for (var i = 0; i < slft; ++i) {\n        _loop_1(i);\n    }\n    return tAll;\n}\n/**\n * Synchronously creates a ZIP file. Prefer using `zip` for better performance\n * with more than one file.\n * @param data The directory structure for the ZIP archive\n * @param opts The main options, merged with per-file options\n * @returns The generated ZIP archive\n */\nexport function zipSync(data, opts) {\n    if (opts === void 0) { opts = {}; }\n    var r = {};\n    var files = [];\n    fltn(data, '', r, opts);\n    var o = 0;\n    var tot = 0;\n    for (var fn in r) {\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var t = p.level == 0 ? 0 : 8;\n        var n = strToU8(fn), s = n.length;\n        if (n.length > 65535)\n            throw 'filename too long';\n        var d = t ? deflateSync(file, p) : file, l = d.length;\n        var c = crc();\n        c.p(file);\n        files.push({\n            t: t,\n            d: d,\n            m: file.length,\n            c: c.d(),\n            u: fn.length != s,\n            n: n,\n            o: o,\n            p: p\n        });\n        o += 30 + s + l;\n        tot += 76 + 2 * s + l;\n    }\n    var out = new u8(tot + 22), oe = o, cdl = tot - o;\n    for (var i = 0; i < files.length; ++i) {\n        var f = files[i];\n        wzh(out, f.o, f.c, f.d, f.m, f.n, f.u, f.p, null, f.t);\n        wzh(out, o, f.c, f.d, f.m, f.n, f.u, f.p, f.o, f.t), o += 46 + f.n.length;\n    }\n    wzf(out, o, files.length, cdl, oe);\n    return out;\n}\n/**\n * Asynchronously decompresses a ZIP archive\n * @param data The raw compressed ZIP file\n * @param cb The callback to call with the decompressed files\n * @returns A function that can be used to immediately terminate the unzipping\n */\nexport function unzip(data, cb) {\n    if (typeof cb != 'function')\n        throw 'no callback';\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var files = {};\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558) {\n            cb('invalid zip file', null);\n            return;\n        }\n    }\n    ;\n    var lft = b2(data, e + 8);\n    if (!lft)\n        cb(null, {});\n    var c = lft;\n    var o = b4(data, e + 16);\n    var z = o == 4294967295;\n    if (z) {\n        e = b4(data, e - 12);\n        if (b4(data, e) != 0x6064B50)\n            throw 'invalid zip file';\n        c = lft = b4(data, e + 32);\n        o = b4(data, e + 48);\n    }\n    var _loop_2 = function (i) {\n        var _a = zh(data, o, z), c_1 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n        o = no;\n        var cbl = function (e, d) {\n            if (e) {\n                tAll();\n                cb(e, null);\n            }\n            else {\n                files[fn] = d;\n                if (!--lft)\n                    cb(null, files);\n            }\n        };\n        if (!c_1)\n            cbl(null, slc(data, b, b + sc));\n        else if (c_1 == 8) {\n            var infl = data.subarray(b, b + sc);\n            if (sc < 320000) {\n                try {\n                    cbl(null, inflateSync(infl, new u8(su)));\n                }\n                catch (e) {\n                    cbl(e, null);\n                }\n            }\n            else\n                term.push(inflate(infl, { size: su }, cbl));\n        }\n        else\n            cbl('unknown compression type ' + c_1, null);\n    };\n    for (var i = 0; i < c; ++i) {\n        _loop_2(i);\n    }\n    return tAll;\n}\n/**\n * Synchronously decompresses a ZIP archive. Prefer using `unzip` for better\n * performance with more than one file.\n * @param data The raw compressed ZIP file\n * @returns The decompressed files\n */\nexport function unzipSync(data) {\n    var files = {};\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558)\n            throw 'invalid zip file';\n    }\n    ;\n    var c = b2(data, e + 8);\n    if (!c)\n        return {};\n    var o = b4(data, e + 16);\n    var z = o == 4294967295;\n    if (z) {\n        e = b4(data, e - 12);\n        if (b4(data, e) != 0x6064B50)\n            throw 'invalid zip file';\n        c = b4(data, e + 32);\n        o = b4(data, e + 48);\n    }\n    for (var i = 0; i < c; ++i) {\n        var _a = zh(data, o, z), c_2 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n        o = no;\n        if (!c_2)\n            files[fn] = slc(data, b, b + sc);\n        else if (c_2 == 8)\n            files[fn] = inflateSync(data.subarray(b, b + sc), new u8(su));\n        else\n            throw 'unknown compression type ' + c_2;\n    }\n    return files;\n}\n","import type { MaskInputOptions, SlimDOMOptions } from 'rrweb-snapshot'\nimport { PostHog } from './posthog-core'\nimport { CaptureMetrics } from './capture-metrics'\nimport { RetryQueue } from './retry-queue'\n\nexport type Property = any\nexport type Properties = Record<string, Property>\nexport interface CaptureResult {\n    uuid: string\n    event: string\n    properties: Properties\n    $set?: Properties\n    $set_once?: Properties\n    timestamp?: Date\n}\nexport type CaptureCallback = (response: any, data: any) => void\n\nexport type AutocaptureCompatibleElement = 'a' | 'button' | 'form' | 'input' | 'select' | 'textarea' | 'label'\nexport type DomAutocaptureEvents = 'click' | 'change' | 'submit'\n\n/**\n * If an array is passed for an allowlist, autocapture events will only be sent for elements matching\n * at least one of the elements in the array. Multiple allowlists can be used\n */\nexport interface AutocaptureConfig {\n    /**\n     * List of URLs to allow autocapture on, can be strings to match\n     * or regexes e.g. ['https://example.com', 'test.com/.*']\n     */\n    url_allowlist?: (string | RegExp)[]\n\n    /**\n     * List of DOM events to allow autocapture on  e.g. ['click', 'change', 'submit']\n     */\n    dom_event_allowlist?: DomAutocaptureEvents[]\n\n    /**\n     * List of DOM elements to allow autocapture on\n     * e.g. ['a', 'button', 'form', 'input', 'select', 'textarea', 'label']\n     */\n    element_allowlist?: AutocaptureCompatibleElement[]\n\n    /**\n     * List of CSS selectors to allow autocapture on\n     * e.g. ['[ph-capture]']\n     */\n    css_selector_allowlist?: string[]\n}\n\nexport type UUIDVersion = 'og' | 'v7'\n\nexport interface PostHogConfig {\n    api_host: string\n    api_method: string\n    api_transport: string\n    ui_host: string | null\n    token: string\n    autocapture: boolean | AutocaptureConfig\n    rageclick: boolean\n    cross_subdomain_cookie: boolean\n    persistence: 'localStorage' | 'cookie' | 'memory' | 'localStorage+cookie' | 'sessionStorage'\n    persistence_name: string\n    cookie_name: string\n    loaded: (posthog_instance: PostHog) => void\n    store_google: boolean\n    custom_campaign_params: string[]\n    save_referrer: boolean\n    test: boolean\n    verbose: boolean\n    capture_pageview: boolean\n    capture_pageleave: boolean\n    debug: boolean\n    cookie_expiration: number\n    upgrade: boolean\n    disable_session_recording: boolean\n    disable_persistence: boolean\n    disable_cookie: boolean\n    enable_recording_console_log?: boolean\n    secure_cookie: boolean\n    ip: boolean\n    opt_out_capturing_by_default: boolean\n    opt_out_persistence_by_default: boolean\n    opt_out_capturing_persistence_type: 'localStorage' | 'cookie'\n    opt_out_capturing_cookie_prefix: string | null\n    opt_in_site_apps: boolean\n    respect_dnt: boolean\n    property_blacklist: string[]\n    xhr_headers: { [header_name: string]: string }\n    on_xhr_error: (failedRequest: XMLHttpRequest) => void\n    inapp_protocol: string\n    inapp_link_new_window: boolean\n    request_batching: boolean\n    sanitize_properties: ((properties: Properties, event_name: string) => Properties) | null\n    properties_string_max_length: number\n    session_recording: SessionRecordingOptions\n    session_idle_timeout_seconds: number\n    mask_all_element_attributes: boolean\n    mask_all_text: boolean\n    advanced_disable_decide: boolean\n    advanced_disable_feature_flags: boolean\n    advanced_disable_feature_flags_on_first_load: boolean\n    advanced_disable_toolbar_metrics: boolean\n    get_device_id: (uuid: string) => string\n    name: string\n    callback_fn: string\n    _onCapture: (eventName: string, eventData: CaptureResult) => void\n    _capture_metrics: boolean\n    capture_performance?: boolean\n    // Should only be used for testing. Could negatively impact performance.\n    disable_compression: boolean\n    bootstrap: {\n        distinctID?: string\n        isIdentifiedID?: boolean\n        featureFlags?: Record<string, boolean | string>\n        featureFlagPayloads?: Record<string, JsonType>\n    }\n    segment?: any\n    // we are replacing the OG uuid generation code, with newer faster UUIDv7\n    // this is a temporary flag to allow us to test the new UUID generation code\n    // this flag *will be deleted* in a future version of ablaevent-js\n    uuid_version?: UUIDVersion\n}\n\nexport interface OptInOutCapturingOptions {\n    capture: (event: string, properties: Properties, options: CaptureOptions) => void\n    capture_event_name: string\n    capture_properties: Properties\n    enable_persistence: boolean\n    clear_persistence: boolean\n    persistence_type: 'cookie' | 'localStorage' | 'localStorage+cookie'\n    cookie_prefix: string\n    cookie_expiration: number\n    cross_subdomain_cookie: boolean\n    secure_cookie: boolean\n}\n\nexport interface isFeatureEnabledOptions {\n    send_event: boolean\n}\n\nexport interface SessionRecordingOptions {\n    blockClass?: string | RegExp\n    blockSelector?: string | null\n    ignoreClass?: string\n    maskTextClass?: string | RegExp\n    maskTextSelector?: string | null\n    maskTextFn?: ((text: string) => string) | null\n    maskAllInputs?: boolean\n    maskInputOptions?: MaskInputOptions\n    maskInputFn?: ((text: string, element?: HTMLElement) => string) | null\n    /** Modify the network request before it is captured. Returning null stops it being captured */\n    maskNetworkRequestFn?: ((url: NetworkRequest) => NetworkRequest | null | undefined) | null\n    slimDOMOptions?: SlimDOMOptions | 'all' | true\n    collectFonts?: boolean\n    inlineStylesheet?: boolean\n    recorderVersion?: 'v1' | 'v2'\n    recordCrossOriginIframes?: boolean\n}\n\nexport type SessionIdChangedCallback = (sessionId: string, windowId: string | null | undefined) => void\n\nexport enum Compression {\n    GZipJS = 'gzip-js',\n    Base64 = 'base64',\n}\n\nexport interface XHROptions {\n    transport?: 'XHR' | 'sendBeacon'\n    method?: 'POST' | 'GET'\n    urlQueryArgs?: { compression: Compression }\n    verbose?: boolean\n    blob?: boolean\n    sendBeacon?: boolean\n}\n\nexport interface CaptureOptions extends XHROptions {\n    $set?: Properties /** used with $identify */\n    $set_once?: Properties /** used with $identify */\n    _batchKey?: string /** key of queue, e.g. 'sessionRecording' vs 'event' */\n    _metrics?: Properties\n    _noTruncate?: boolean /** if set, overrides and disables config.properties_string_max_length */\n    endpoint?: string /** defaults to '/e/' */\n    send_instantly?: boolean /** if set skips the batched queue */\n    timestamp?: Date\n}\n\nexport interface RetryQueueElement {\n    retryAt: Date\n    requestData: QueuedRequestData\n}\nexport interface QueuedRequestData {\n    url: string\n    data: Properties\n    options: CaptureOptions\n    headers?: Properties\n    callback?: RequestCallback\n    retriesPerformedSoFar?: number\n}\n\nexport interface XHRParams extends QueuedRequestData {\n    captureMetrics: CaptureMetrics\n    retryQueue: RetryQueue\n    onXHRError: (req: XMLHttpRequest) => void\n    timeout?: number\n    onRateLimited?: (req: XMLHttpRequest) => void\n}\n\nexport interface DecideResponse {\n    status: number\n    supportedCompression: Compression[]\n    config: {\n        enable_collect_everything: boolean\n    }\n    custom_properties: AutoCaptureCustomProperty[] // TODO: delete, not sent\n    featureFlags: Record<string, string | boolean>\n    featureFlagPayloads: Record<string, JsonType>\n    errorsWhileComputingFlags: boolean\n    autocapture_opt_out?: boolean\n    capturePerformance?: boolean\n    // this is currently in development and may have breaking changes without a major version bump\n    autocaptureExceptions?:\n        | boolean\n        | {\n              endpoint?: string\n              errors_to_ignore: string[]\n          }\n    sessionRecording?: {\n        endpoint?: string\n        consoleLogRecordingEnabled?: boolean\n        recorderVersion?: 'v1' | 'v2'\n    }\n    toolbarParams: ToolbarParams\n    editorParams?: ToolbarParams /** @deprecated, renamed to toolbarParams, still present on older API responses */\n    toolbarVersion: 'toolbar' /** @deprecated, moved to toolbarParams */\n    isAuthenticated: boolean\n    siteApps: { id: number; url: string }[]\n}\n\nexport type FeatureFlagsCallback = (flags: string[], variants: Record<string, string | boolean>) => void\n\n// TODO: delete custom_properties after changeless typescript refactor\nexport interface AutoCaptureCustomProperty {\n    name: string\n    css_selector: string\n    event_selectors: string[]\n}\n\nexport interface CompressionData {\n    data: string\n    compression?: Compression\n}\n\nexport interface GDPROptions {\n    capture?: (\n        event: string,\n        properties: Properties,\n        options: CaptureOptions\n    ) => void /** function used for capturing a PostHog event to record the opt-in action */\n    captureEventName?: string /** event name to be used for capturing the opt-in action */\n    captureProperties?: Properties /** set of properties to be captured along with the opt-in action */\n    /** persistence mechanism used */\n    persistenceType?: 'cookie' | 'localStorage' | 'localStorage+cookie'\n    persistencePrefix?: string /** [__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name */\n    cookieExpiration?: number /** number of days until the opt-in cookie expires */\n    crossSubdomainCookie?: boolean /** whether the opt-in cookie is set as cross-subdomain or not */\n    secureCookie?: boolean /** whether the opt-in cookie is set as secure or not */\n    respectDnt?: boolean\n    window?: Window\n}\n\nexport type RequestCallback = (response: Record<string, any>, data?: Properties) => void\n\nexport interface PersistentStore {\n    is_supported: () => boolean\n    error: (error: any) => void\n    parse: (name: string) => any\n    get: (name: string) => any\n    set: (name: string, value: any, expire_days?: number | null, cross_subdomain?: boolean, secure?: boolean) => void\n    remove: (name: string, cross_subdomain?: boolean) => void\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport type Breaker = {}\nexport type EventHandler = (event: Event) => boolean | void\n\nexport type ToolbarUserIntent = 'add-action' | 'edit-action'\nexport type ToolbarSource = 'url' | 'localstorage'\nexport type ToolbarVersion = 'toolbar'\n\n/* sync with posthog */\nexport interface ToolbarParams {\n    token?: string /** public ablaevent-js token */\n    temporaryToken?: string /** private temporary user token */\n    actionId?: number\n    userIntent?: ToolbarUserIntent\n    source?: ToolbarSource\n    toolbarVersion?: ToolbarVersion\n    instrument?: boolean\n    distinctId?: string\n    userEmail?: string\n    dataAttributes?: string[]\n    featureFlags?: Record<string, string | boolean>\n}\n\nexport interface PostData {\n    buffer?: BlobPart\n    compression?: Compression\n    data?: string\n}\n\nexport interface JSC {\n    (): void\n    [key: string]: (response: any) => void\n}\n\nexport type SnippetArrayItem = [method: string, ...args: any[]]\n\nexport type JsonType = string | number | boolean | null | { [key: string]: JsonType } | Array<JsonType>\n\n/** A feature that isn't publicly available yet.*/\nexport interface EarlyAccessFeature {\n    // Sync this with the backend's EarlyAccessFeatureSerializer!\n    name: string\n    description: string\n    stage: 'concept' | 'alpha' | 'beta'\n    documentationUrl: string | null\n    flagKey: string | null\n}\n\nexport type EarlyAccessFeatureCallback = (earlyAccessFeatures: EarlyAccessFeature[]) => void\n\nexport interface EarlyAccessFeatureResponse {\n    earlyAccessFeatures: EarlyAccessFeature[]\n}\n\nexport type NetworkRequest = {\n    url: string\n}\n","import { _each, _HTTPBuildQuery, logger } from './utils'\nimport Config from './config'\nimport { PostData, XHROptions, XHRParams } from './types'\n\nexport const addParamsToURL = (\n    url: string,\n    urlQueryArgs: Record<string, any> | undefined,\n    parameterOptions: { ip?: boolean }\n): string => {\n    const args = urlQueryArgs || {}\n    args['ip'] = parameterOptions['ip'] ? 1 : 0\n    args['_'] = new Date().getTime().toString()\n    args['ver'] = Config.LIB_VERSION\n\n    const halves = url.split('?')\n    if (halves.length > 1) {\n        const params = halves[1].split('&')\n        for (const p of params) {\n            const key = p.split('=')[0]\n            if (args[key]) {\n                delete args[key]\n            }\n        }\n    }\n\n    const argSeparator = url.indexOf('?') > -1 ? '&' : '?'\n    return url + argSeparator + _HTTPBuildQuery(args)\n}\n\nexport const encodePostData = (data: PostData | Uint8Array, options: Partial<XHROptions>): string | BlobPart | null => {\n    if (options.blob && data.buffer) {\n        return new Blob([data.buffer], { type: 'text/plain' })\n    }\n\n    if (options.sendBeacon || options.blob) {\n        const body = encodePostData(data, { method: 'POST' }) as BlobPart\n        return new Blob([body], { type: 'application/x-www-form-urlencoded' })\n    }\n\n    if (options.method !== 'POST') {\n        return null\n    }\n\n    let body_data\n    const isUint8Array = (d: unknown): d is Uint8Array => Object.prototype.toString.call(d) === '[object Uint8Array]'\n    if (Array.isArray(data) || isUint8Array(data)) {\n        // TODO: eh? passing an Array here?\n        body_data = 'data=' + encodeURIComponent(data as any)\n    } else {\n        body_data = 'data=' + encodeURIComponent(data.data as string)\n    }\n\n    if ('compression' in data && data.compression) {\n        body_data += '&compression=' + data.compression\n    }\n\n    return body_data\n}\n\nexport const xhr = ({\n    url,\n    data,\n    headers,\n    options,\n    captureMetrics,\n    callback,\n    retriesPerformedSoFar,\n    retryQueue,\n    onXHRError,\n    timeout = 10000,\n    onRateLimited,\n}: XHRParams) => {\n    const req = new XMLHttpRequest()\n    req.open(options.method || 'GET', url, true)\n\n    const body = encodePostData(data, options)\n\n    captureMetrics.incr('_send_request')\n    captureMetrics.incr('_send_request_inflight')\n\n    _each(headers, function (headerValue, headerName) {\n        req.setRequestHeader(headerName, headerValue)\n    })\n\n    if (options.method === 'POST' && !options.blob) {\n        req.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')\n    }\n\n    req.timeout = timeout\n    // send the ph_optout cookie\n    // withCredentials cannot be modified until after calling .open on Android and Mobile Safari\n    req.withCredentials = true\n    req.onreadystatechange = () => {\n        if (req.readyState === 4) {\n            captureMetrics.incr(`xhr-response`)\n            captureMetrics.incr(`xhr-response-${req.status}`)\n            captureMetrics.decr('_send_request_inflight')\n\n            // XMLHttpRequest.DONE == 4, except in safari 4\n            if (req.status === 200) {\n                if (callback) {\n                    let response\n                    try {\n                        response = JSON.parse(req.responseText)\n                    } catch (e) {\n                        logger.error(e)\n                        return\n                    }\n                    callback(response)\n                }\n            } else {\n                if (typeof onXHRError === 'function') {\n                    onXHRError(req)\n                }\n\n                // don't retry certain errors\n                if ([401, 403, 404, 500].indexOf(req.status) < 0) {\n                    retryQueue.enqueue({\n                        url,\n                        data,\n                        options,\n                        headers,\n                        retriesPerformedSoFar: (retriesPerformedSoFar || 0) + 1,\n                        callback,\n                    })\n                }\n\n                if (req.status === 429) {\n                    onRateLimited?.(req)\n                }\n\n                if (callback) {\n                    callback({ status: 0 })\n                }\n            }\n        }\n    }\n    req.send(body)\n}\n","import { RequestQueueScaffold } from './base-request-queue'\nimport { encodePostData, xhr } from './send-request'\nimport { CaptureMetrics } from './capture-metrics'\nimport { QueuedRequestData, RetryQueueElement } from './types'\nimport Config from './config'\nimport { RateLimiter } from './rate-limiter'\n\nconst thirtyMinutes = 30 * 60 * 1000\n\n/**\n * Generates a jitter-ed exponential backoff delay in milliseconds\n *\n * The base value is 6 seconds, which is doubled with each retry\n * up to the maximum of 30 minutes\n *\n * Each value then has +/- 50% jitter\n *\n * Giving a range of 6 seconds up to 45 minutes\n */\nexport function pickNextRetryDelay(retriesPerformedSoFar: number): number {\n    const rawBackoffTime = 3000 * 2 ** retriesPerformedSoFar\n    const minBackoff = rawBackoffTime / 2\n    const cappedBackoffTime = Math.min(thirtyMinutes, rawBackoffTime)\n    const jitterFraction = Math.random() - 0.5 // A random number between -0.5 and 0.5\n    const jitter = jitterFraction * (cappedBackoffTime - minBackoff)\n    return Math.ceil(cappedBackoffTime + jitter)\n}\n\nexport class RetryQueue extends RequestQueueScaffold {\n    captureMetrics: CaptureMetrics\n    queue: RetryQueueElement[]\n    isPolling: boolean\n    areWeOnline: boolean\n    onXHRError: (failedRequest: XMLHttpRequest) => void\n    rateLimiter: RateLimiter\n\n    constructor(\n        captureMetrics: CaptureMetrics,\n        onXHRError: (failedRequest: XMLHttpRequest) => void,\n        rateLimiter: RateLimiter\n    ) {\n        super()\n        this.captureMetrics = captureMetrics\n        this.isPolling = false\n        this.queue = []\n        this.areWeOnline = true\n        this.onXHRError = onXHRError\n        this.rateLimiter = rateLimiter\n\n        if (typeof window !== 'undefined' && 'onLine' in window.navigator) {\n            this.areWeOnline = window.navigator.onLine\n            window.addEventListener('online', () => {\n                this._handleWeAreNowOnline()\n            })\n            window.addEventListener('offline', () => {\n                this.areWeOnline = false\n            })\n        }\n    }\n\n    enqueue(requestData: QueuedRequestData): void {\n        const retriesPerformedSoFar = requestData.retriesPerformedSoFar || 0\n        if (retriesPerformedSoFar >= 10) {\n            return\n        }\n        const msToNextRetry = pickNextRetryDelay(retriesPerformedSoFar)\n        const retryAt = new Date(Date.now() + msToNextRetry)\n\n        this.queue.push({ retryAt, requestData })\n        console.warn(`Enqueued failed request for retry in ${msToNextRetry}`)\n        if (!this.isPolling) {\n            this.isPolling = true\n            this.poll()\n        }\n    }\n\n    poll(): void {\n        this._poller && clearTimeout(this._poller)\n        this._poller = setTimeout(() => {\n            if (this.areWeOnline && this.queue.length > 0) {\n                this.flush()\n            }\n            this.poll()\n        }, this._pollInterval) as any as number\n    }\n\n    flush(): void {\n        // using Date.now to make tests easier, as recommended here https://codewithhugo.com/mocking-the-current-date-in-jest-tests/\n        const now = new Date(Date.now())\n        const toFlush = this.queue.filter(({ retryAt }) => retryAt < now)\n        if (toFlush.length > 0) {\n            this.queue = this.queue.filter(({ retryAt }) => retryAt >= now)\n            for (const { requestData } of toFlush) {\n                this._executeXhrRequest(requestData)\n            }\n        }\n    }\n\n    unload(): void {\n        if (this._poller) {\n            clearTimeout(this._poller)\n            this._poller = undefined\n        }\n\n        for (const { requestData } of this.queue) {\n            const { url, data, options } = requestData\n\n            if (this.rateLimiter.isRateLimited(options._batchKey)) {\n                if (Config.DEBUG) {\n                    console.warn('[PostHog RetryQueue] is quota limited. Dropping request.')\n                }\n                continue\n            }\n\n            try {\n                // we've had send beacon in place for at least 2 years\n                // eslint-disable-next-line compat/compat\n                window.navigator.sendBeacon(url, encodePostData(data, { ...options, sendBeacon: true }))\n            } catch (e) {\n                // Note sendBeacon automatically retries, and after the first retry it will lose reference to contextual `this`.\n                // This means in some cases `this.getConfig` will be undefined.\n                if (Config.DEBUG) {\n                    console.error(e)\n                }\n            }\n        }\n        this.queue = []\n    }\n\n    _executeXhrRequest({ url, data, options, headers, callback, retriesPerformedSoFar }: QueuedRequestData): void {\n        if (this.rateLimiter.isRateLimited(options._batchKey)) {\n            if (Config.DEBUG) {\n                console.warn('[PostHog RetryQueue] in quota limited mode. Dropping request.')\n            }\n            return\n        }\n\n        xhr({\n            url,\n            data: data || {},\n            options: options || {},\n            headers: headers || {},\n            retriesPerformedSoFar: retriesPerformedSoFar || 0,\n            callback,\n            captureMetrics: this.captureMetrics,\n            retryQueue: this,\n            onXHRError: this.onXHRError,\n            onRateLimited: this.rateLimiter.on429Response,\n        })\n    }\n\n    _handleWeAreNowOnline(): void {\n        this.areWeOnline = true\n        this.flush()\n    }\n}\n","import { PostHogPersistence, SESSION_ID } from './posthog-persistence'\nimport { sessionStore } from './storage'\nimport { PostHogConfig, SessionIdChangedCallback } from './types'\n\nconst MAX_SESSION_IDLE_TIMEOUT = 30 * 60 // 30 mins\nconst MIN_SESSION_IDLE_TIMEOUT = 60 // 1 mins\nconst SESSION_LENGTH_LIMIT = 24 * 3600 * 1000 // 24 hours\n\nexport class SessionIdManager {\n    private config: Partial<PostHogConfig>\n    private persistence: PostHogPersistence\n    private _windowId: string | null | undefined\n    private _sessionId: string | null | undefined\n    private _window_id_storage_key: string\n    private _primary_window_exists_storage_key: string\n    private _sessionStartTimestamp: number | null\n    private _sessionActivityTimestamp: number | null\n    private _sessionTimeoutMs: number\n    private _sessionIdChangedHandlers: SessionIdChangedCallback[] = []\n\n    constructor(config: Partial<PostHogConfig>, persistence: PostHogPersistence, private uuidFn: () => string) {\n        this.config = config\n        this.persistence = persistence\n        this._windowId = undefined\n        this._sessionId = undefined\n        this._sessionStartTimestamp = null\n        this._sessionActivityTimestamp = null\n\n        const persistenceName = config['persistence_name'] || config['token']\n        let desiredTimeout = config['session_idle_timeout_seconds'] || MAX_SESSION_IDLE_TIMEOUT\n\n        if (typeof desiredTimeout !== 'number') {\n            console.warn('[PostHog] session_idle_timeout_seconds must be a number. Defaulting to 30 minutes.')\n            desiredTimeout = MAX_SESSION_IDLE_TIMEOUT\n        } else if (desiredTimeout > MAX_SESSION_IDLE_TIMEOUT) {\n            console.warn(\n                '[PostHog] session_idle_timeout_seconds cannot be  greater than 30 minutes. Using 30 minutes instead.'\n            )\n        } else if (desiredTimeout < MIN_SESSION_IDLE_TIMEOUT) {\n            console.warn(\n                '[PostHog] session_idle_timeout_seconds cannot be less than 60 seconds. Using 60 seconds instead.'\n            )\n        }\n\n        this._sessionTimeoutMs =\n            Math.min(Math.max(desiredTimeout, MIN_SESSION_IDLE_TIMEOUT), MAX_SESSION_IDLE_TIMEOUT) * 1000\n        this._window_id_storage_key = 'ph_' + persistenceName + '_window_id'\n        this._primary_window_exists_storage_key = 'ph_' + persistenceName + '_primary_window_exists'\n\n        // primary_window_exists is set when the DOM has been loaded and is cleared on unload\n        // if it exists here it means there was no unload which suggests this window is opened as a tab duplication, window.open, etc.\n        if (this._canUseSessionStorage()) {\n            const lastWindowId = sessionStore.parse(this._window_id_storage_key)\n\n            const primaryWindowExists = sessionStore.parse(this._primary_window_exists_storage_key)\n            if (lastWindowId && !primaryWindowExists) {\n                // Persist window from previous storage state\n                this._windowId = lastWindowId\n            } else {\n                // Wipe any reference to previous window id\n                sessionStore.remove(this._window_id_storage_key)\n            }\n            // Flag this session as having a primary window\n            sessionStore.set(this._primary_window_exists_storage_key, true)\n        }\n\n        this._listenToReloadWindow()\n    }\n\n    onSessionId(callback: SessionIdChangedCallback): () => void {\n        // KLUDGE: when running in tests the handlers array was always undefined\n        // it's yucky but safe to set it here so that it's always definitely available\n        if (this._sessionIdChangedHandlers === undefined) {\n            this._sessionIdChangedHandlers = []\n        }\n\n        this._sessionIdChangedHandlers.push(callback)\n        if (this._sessionId) {\n            callback(this._sessionId, this._windowId)\n        }\n        return () => {\n            this._sessionIdChangedHandlers = this._sessionIdChangedHandlers.filter((h) => h !== callback)\n        }\n    }\n\n    private _canUseSessionStorage(): boolean {\n        // We only want to use sessionStorage if persistence is enabled and not memory storage\n        return this.config.persistence !== 'memory' && !this.persistence.disabled && sessionStore.is_supported()\n    }\n\n    // Note: this tries to store the windowId in sessionStorage. SessionStorage is unique to the current window/tab,\n    // and persists page loads/reloads. So it's uniquely suited for storing the windowId. This function also respects\n    // when persistence is disabled (by user config) and when sessionStorage is not supported (it *should* be supported on all browsers),\n    // and in that case, it falls back to memory (which sadly, won't persist page loads)\n    private _setWindowId(windowId: string): void {\n        if (windowId !== this._windowId) {\n            this._windowId = windowId\n            if (this._canUseSessionStorage()) {\n                sessionStore.set(this._window_id_storage_key, windowId)\n            }\n        }\n    }\n\n    private _getWindowId(): string | null {\n        if (this._windowId) {\n            return this._windowId\n        }\n        if (this._canUseSessionStorage()) {\n            return sessionStore.parse(this._window_id_storage_key)\n        }\n        // New window id will be generated\n        return null\n    }\n\n    // Note: 'this.persistence.register' can be disabled in the config.\n    // In that case, this works by storing sessionId and the timestamp in memory.\n    private _setSessionId(\n        sessionId: string | null,\n        sessionActivityTimestamp: number | null,\n        sessionStartTimestamp: number | null\n    ): void {\n        if (\n            sessionId !== this._sessionId ||\n            sessionActivityTimestamp !== this._sessionActivityTimestamp ||\n            sessionStartTimestamp !== this._sessionStartTimestamp\n        ) {\n            this._sessionStartTimestamp = sessionStartTimestamp\n            this._sessionActivityTimestamp = sessionActivityTimestamp\n            this._sessionId = sessionId\n            this.persistence.register({\n                [SESSION_ID]: [sessionActivityTimestamp, sessionId, sessionStartTimestamp],\n            })\n        }\n    }\n\n    private _getSessionId(): [number, string, number] {\n        if (this._sessionId && this._sessionActivityTimestamp && this._sessionStartTimestamp) {\n            return [this._sessionActivityTimestamp, this._sessionId, this._sessionStartTimestamp]\n        }\n        const sessionId = this.persistence.props[SESSION_ID]\n\n        if (Array.isArray(sessionId) && sessionId.length === 2) {\n            // Storage does not yet have a session start time. Add the last activity timestamp as the start time\n            sessionId.push(sessionId[0])\n        }\n\n        return sessionId || [0, null, 0]\n    }\n\n    // Resets the session id by setting it to null. On the subsequent call to checkAndGetSessionAndWindowId,\n    // new ids will be generated.\n    resetSessionId(): void {\n        this._setSessionId(null, null, null)\n    }\n\n    /*\n     * Listens to window unloads and removes the primaryWindowExists key from sessionStorage.\n     * Reloaded or fresh tabs created after a DOM unloads (reloading the same tab) WILL NOT have this primaryWindowExists flag in session storage.\n     * Cloned sessions (new tab, tab duplication, window.open(), ...) WILL have this primaryWindowExists flag in their copied session storage.\n     * We conditionally check the primaryWindowExists value in the constructor to decide if the window id in the last session storage should be carried over.\n     */\n    private _listenToReloadWindow(): void {\n        window.addEventListener('beforeunload', () => {\n            if (this._canUseSessionStorage()) {\n                sessionStore.remove(this._primary_window_exists_storage_key)\n            }\n        })\n    }\n\n    /*\n     * This function returns the current sessionId and windowId. It should be used to\n     * access these values over directly calling `._sessionId` or `._windowId`. In addition\n     * to returning the sessionId and windowId, this function also manages cycling the\n     * sessionId and windowId when appropriate by doing the following:\n     *\n     * 1. If the sessionId or windowId is not set, it will generate a new one and store it.\n     * 2. If the readOnly param is set to false, it will:\n     *    a. Check if it has been > SESSION_CHANGE_THRESHOLD since the last call with this flag set.\n     *       If so, it will generate a new sessionId and store it.\n     *    b. Update the timestamp stored with the sessionId to ensure the current session is extended\n     *       for the appropriate amount of time.\n     *\n     * @param {boolean} readOnly (optional) Defaults to False. Should be set to True when the call to the function should not extend or cycle the session (e.g. being called for non-user generated events)\n     * @param {Number} timestamp (optional) Defaults to the current time. The timestamp to be stored with the sessionId (used when determining if a new sessionId should be generated)\n     */\n    checkAndGetSessionAndWindowId(readOnly = false, _timestamp: number | null = null) {\n        const timestamp = _timestamp || new Date().getTime()\n\n        // eslint-disable-next-line prefer-const\n        let [lastTimestamp, sessionId, startTimestamp] = this._getSessionId()\n        let windowId = this._getWindowId()\n\n        const sessionPastMaximumLength =\n            startTimestamp && startTimestamp > 0 && Math.abs(timestamp - startTimestamp) > SESSION_LENGTH_LIMIT\n\n        let valuesChanged = false\n        if (\n            !sessionId ||\n            (!readOnly && Math.abs(timestamp - lastTimestamp) > this._sessionTimeoutMs) ||\n            sessionPastMaximumLength\n        ) {\n            sessionId = this.uuidFn()\n            windowId = this.uuidFn()\n            startTimestamp = timestamp\n            valuesChanged = true\n        } else if (!windowId) {\n            windowId = this.uuidFn()\n            valuesChanged = true\n        }\n\n        const newTimestamp = lastTimestamp === 0 || !readOnly || sessionPastMaximumLength ? timestamp : lastTimestamp\n        const sessionStartTimestamp = startTimestamp === 0 ? new Date().getTime() : startTimestamp\n\n        this._setWindowId(windowId)\n        this._setSessionId(sessionId, newTimestamp, sessionStartTimestamp)\n\n        if (valuesChanged) {\n            this._sessionIdChangedHandlers.forEach((handler) => handler(sessionId, windowId))\n        }\n\n        return {\n            sessionId,\n            windowId,\n            sessionStartTimestamp,\n        }\n    }\n}\n","/**\n * Integrate Sentry with PostHog. This will add a direct link to the person in Sentry, and an $exception event in PostHog\n *\n * ### Usage\n *\n *     Sentry.init({\n *          dsn: 'https://example',\n *          integrations: [\n *              new posthog.SentryIntegration(posthog)\n *          ]\n *     })\n *\n * @param {Object} [posthog] The posthog object\n * @param {string} [organization] Optional: The Sentry organization, used to send a direct link from PostHog to Sentry\n * @param {Number} [projectId] Optional: The Sentry project id, used to send a direct link from PostHog to Sentry\n * @param {string} [prefix] Optional: Url of a self-hosted sentry instance (default: https://sentry.io/organizations/)\n */\n\nimport { PostHog } from '../posthog-core'\nimport { ErrorProperties } from './exceptions/error-conversion'\n\n// NOTE - we can't import from @sentry/types because it changes frequently and causes clashes\n// We only use a small subset of the types, so we can just define the integration overall and use any for the rest\n\n// import {\n//     Event as _SentryEvent,\n//     EventProcessor as _SentryEventProcessor,\n//     Hub as _SentryHub,\n//     Integration as _SentryIntegration,\n// } from '@sentry/types'\n\n// Uncomment the above and comment the below to get type checking for development\n\ntype _SentryEvent = any\ntype _SentryEventProcessor = any\ntype _SentryHub = any\n\ninterface _SentryIntegration {\n    name: string\n    setupOnce(addGlobalEventProcessor: (callback: _SentryEventProcessor) => void, getCurrentHub: () => _SentryHub): void\n}\n\ninterface SentryExceptionProperties {\n    $sentry_event_id: any\n    $sentry_exception: any\n    $sentry_exception_message: any\n    $sentry_exception_type: any\n    $sentry_tags: any\n    $sentry_url?: string\n}\n\nexport class SentryIntegration implements _SentryIntegration {\n    name: string\n\n    setupOnce: (\n        addGlobalEventProcessor: (callback: _SentryEventProcessor) => void,\n        getCurrentHub: () => _SentryHub\n    ) => void\n\n    constructor(_posthog: PostHog, organization?: string, projectId?: number, prefix?: string) {\n        // setupOnce gets called by Sentry when it intializes the plugin\n        this.name = 'ablaevent-js'\n        this.setupOnce = function (addGlobalEventProcessor: (callback: _SentryEventProcessor) => void) {\n            addGlobalEventProcessor((event: _SentryEvent) => {\n                if (event.level !== 'error' || !_posthog.__loaded) return event\n                if (!event.tags) event.tags = {}\n\n                const host = _posthog.config.ui_host || _posthog.config.api_host\n                event.tags['PostHog Person URL'] = host + '/person/' + _posthog.get_distinct_id()\n                if (_posthog.sessionRecordingStarted()) {\n                    event.tags['PostHog Recording URL'] = _posthog.get_session_replay_url({ withTimestamp: true })\n                }\n\n                const exceptions = event.exception?.values || []\n\n                const data: SentryExceptionProperties & ErrorProperties = {\n                    // PostHog Exception Properties,\n                    $exception_message: exceptions[0]?.value,\n                    $exception_type: exceptions[0]?.type,\n                    $exception_personURL: host + '/person/' + _posthog.get_distinct_id(),\n                    // Sentry Exception Properties\n                    $sentry_event_id: event.event_id,\n                    $sentry_exception: event.exception,\n                    $sentry_exception_message: exceptions[0]?.value,\n                    $sentry_exception_type: exceptions[0]?.type,\n                    $sentry_tags: event.tags,\n                }\n\n                if (organization && projectId)\n                    data['$sentry_url'] =\n                        (prefix || 'https://sentry.io/organizations/') +\n                        organization +\n                        '/issues/?project=' +\n                        projectId +\n                        '&query=' +\n                        event.event_id\n                _posthog.capture('$exception', data)\n                return event\n            })\n        }\n    }\n}\n","/**\n * Extend Segment with extra PostHog JS functionality. Required for things like Recordings and feature flags to work correctly.\n *\n * ### Usage\n *\n *  ```js\n *  // After your standard segment anyalytics install\n *  analytics.load(\"GOEDfA21zZTtR7clsBuDvmBKAtAdZ6Np\");\n *\n *  analytics.ready(() => {\n *    posthog.init('<posthog-api-key>', {\n *      capture_pageview: false,\n *      segment: window.analytics, // NOTE: Be sure to use window.analytics here!\n *    });\n *    window.analytics.page();\n *  })\n *  ```\n */\nimport { PostHog } from '../posthog-core'\n\n// Loosely based on https://github.com/segmentio/analytics-next/blob/master/packages/core/src/plugins/index.ts\ninterface SegmentPluginContext {\n    event: {\n        event: string\n        userId?: string\n        anonymousId?: string\n        properties: any\n    }\n}\n\ninterface SegmentPlugin {\n    name: string\n    version: string\n    type: 'enrichment'\n    isLoaded: () => boolean\n    load: (ctx: SegmentPluginContext, instance: any, config?: any) => Promise<unknown>\n    unload?: (ctx: SegmentPluginContext, instance: any) => Promise<unknown> | unknown\n    ready?: () => Promise<unknown>\n    track?: (ctx: SegmentPluginContext) => Promise<SegmentPluginContext> | SegmentPluginContext\n    identify?: (ctx: SegmentPluginContext) => Promise<SegmentPluginContext> | SegmentPluginContext\n    page?: (ctx: SegmentPluginContext) => Promise<SegmentPluginContext> | SegmentPluginContext\n    group?: (ctx: SegmentPluginContext) => Promise<SegmentPluginContext> | SegmentPluginContext\n    alias?: (ctx: SegmentPluginContext) => Promise<SegmentPluginContext> | SegmentPluginContext\n    screen?: (ctx: SegmentPluginContext) => Promise<SegmentPluginContext> | SegmentPluginContext\n}\n\nexport const createSegmentIntegration = (posthog: PostHog): SegmentPlugin => {\n    if (!Promise || !Promise.resolve) {\n        console.warn('This browser does not have Promise support, and can not use the segment integration')\n    }\n\n    const enrichEvent = (ctx: SegmentPluginContext, eventName: string) => {\n        if (!ctx.event.userId && ctx.event.anonymousId !== posthog.get_distinct_id()) {\n            // This is our only way of detecting that segment's analytics.reset() has been called so we also call it\n            posthog.reset()\n        }\n        if (ctx.event.userId && ctx.event.userId !== posthog.get_distinct_id()) {\n            posthog.register({\n                distinct_id: ctx.event.userId,\n            })\n            posthog.reloadFeatureFlags()\n        }\n\n        const additionalProperties = posthog._calculate_event_properties(eventName, ctx.event.properties)\n        ctx.event.properties = Object.assign({}, additionalProperties, ctx.event.properties)\n        return ctx\n    }\n\n    return {\n        name: 'PostHog JS',\n        type: 'enrichment',\n        version: '1.0.0',\n        isLoaded: () => true,\n        // check and early return above\n        // eslint-disable-next-line compat/compat\n        load: () => Promise.resolve(),\n        track: (ctx) => enrichEvent(ctx, ctx.event.event),\n        page: (ctx) => enrichEvent(ctx, '$pageview'),\n        identify: (ctx) => enrichEvent(ctx, '$identify'),\n        screen: (ctx) => enrichEvent(ctx, '$screen'),\n    }\n}\n","export class PageViewIdManager {\n    _pageViewId: string | undefined\n\n    _seenFirstPageView = false\n\n    constructor(private uuidFn: () => string) {}\n\n    onPageview(): void {\n        // As the first $pageview event may come after a different event,\n        // we only reset the ID _after_ the second $pageview event.\n        if (this._seenFirstPageView) {\n            this._pageViewId = this.uuidFn()\n        }\n        this._seenFirstPageView = true\n    }\n\n    getPageViewId(): string {\n        if (!this._pageViewId) {\n            this._pageViewId = this.uuidFn()\n        }\n\n        return this._pageViewId\n    }\n}\n","export function isEvent(candidate: unknown): candidate is Event {\n    return typeof Event !== 'undefined' && isInstanceOf(candidate, Event)\n}\n\nexport function isPlainObject(candidate: unknown): candidate is Record<string, unknown> {\n    return isBuiltin(candidate, 'Object')\n}\n\nexport function isInstanceOf(candidate: unknown, base: any): boolean {\n    try {\n        return candidate instanceof base\n    } catch (_e) {\n        return false\n    }\n}\n\nexport function isPrimitive(\n    candidate: unknown\n): candidate is number | string | boolean | bigint | symbol | null | undefined {\n    return candidate === null || (typeof candidate !== 'object' && typeof candidate !== 'function')\n}\n\nexport function isError(candidate: unknown): candidate is Error {\n    switch (Object.prototype.toString.call(candidate)) {\n        case '[object Error]':\n        case '[object Exception]':\n        case '[object DOMException]':\n            return true\n        default:\n            return isInstanceOf(candidate, Error)\n    }\n}\n\nexport function isErrorEvent(event: string | Error | Event): event is ErrorEvent {\n    return isBuiltin(event, 'ErrorEvent')\n}\n\nexport function isErrorWithStack(candidate: unknown): candidate is Error {\n    return 'stack' in (candidate as Error)\n}\n\nexport function isBuiltin(candidate: unknown, className: string): boolean {\n    return Object.prototype.toString.call(candidate) === `[object ${className}]`\n}\n\nexport function isDOMException(candidate: unknown): boolean {\n    return isBuiltin(candidate, 'DOMException')\n}\n\nexport function isDOMError(candidate: unknown): boolean {\n    return isBuiltin(candidate, 'DOMError')\n}\n","// copied and adapted from https://github.com/getsentry/sentry-javascript/blob/41fef4b10f3a644179b77985f00f8696c908539f/packages/browser/src/stack-parsers.ts\n// 💖open source\n\n// This was originally forked from https://github.com/csnover/TraceKit, and was largely\n// re-written as part of raven - js.\n//\n// This code was later copied to the JavaScript mono - repo and further modified and\n// refactored over the years.\n\n// Copyright (c) 2013 Onur Can Cakmak onur.cakmak@gmail.com and all TraceKit contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy of this\n// software and associated documentation files(the 'Software'), to deal in the Software\n// without restriction, including without limitation the rights to use, copy, modify,\n// merge, publish, distribute, sublicense, and / or sell copies of the Software, and to\n// permit persons to whom the Software is furnished to do so, subject to the following\n// conditions:\n//\n// The above copyright notice and this permission notice shall be included in all copies\n// or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n// INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n// PARTICULAR PURPOSE AND NONINFRINGEMENT.IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n// HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF\n// CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE\n// OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nconst WEBPACK_ERROR_REGEXP = /\\(error: (.*)\\)/\nconst STACKTRACE_FRAME_LIMIT = 50\n\nconst UNKNOWN_FUNCTION = '?'\n\nconst OPERA10_PRIORITY = 10\nconst OPERA11_PRIORITY = 20\nconst CHROME_PRIORITY = 30\nconst WINJS_PRIORITY = 40\nconst GECKO_PRIORITY = 50\n\nexport interface StackFrame {\n    filename?: string\n    function?: string\n    module?: string\n    platform?: string\n    lineno?: number\n    colno?: number\n    abs_path?: string\n    context_line?: string\n    pre_context?: string[]\n    post_context?: string[]\n    in_app?: boolean\n    instruction_addr?: string\n    addr_mode?: string\n    vars?: { [key: string]: any }\n    debug_id?: string\n}\n\nfunction createFrame(filename: string, func: string, lineno?: number, colno?: number): StackFrame {\n    const frame: StackFrame = {\n        filename,\n        function: func,\n        in_app: true, // All browser frames are considered in_app\n    }\n\n    if (lineno !== undefined) {\n        frame.lineno = lineno\n    }\n\n    if (colno !== undefined) {\n        frame.colno = colno\n    }\n\n    return frame\n}\n\nexport type StackParser = (stack: string, skipFirst?: number) => StackFrame[]\nexport type StackLineParserFn = (line: string) => StackFrame | undefined\nexport type StackLineParser = [number, StackLineParserFn]\n\n// Chromium based browsers: Chrome, Brave, new Opera, new Edge\nconst chromeRegex =\n    /^\\s*at (?:(.+?\\)(?: \\[.+\\])?|.*?) ?\\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\\/)?.*?)(?::(\\d+))?(?::(\\d+))?\\)?\\s*$/i\nconst chromeEvalRegex = /\\((\\S*)(?::(\\d+))(?::(\\d+))\\)/\n\nconst chrome: StackLineParserFn = (line) => {\n    const parts = chromeRegex.exec(line)\n\n    if (parts) {\n        const isEval = parts[2] && parts[2].indexOf('eval') === 0 // start of line\n\n        if (isEval) {\n            const subMatch = chromeEvalRegex.exec(parts[2])\n\n            if (subMatch) {\n                // throw out eval line/column and use top-most line/column number\n                parts[2] = subMatch[1] // url\n                parts[3] = subMatch[2] // line\n                parts[4] = subMatch[3] // column\n            }\n        }\n\n        // Kamil: One more hack won't hurt us right? Understanding and adding more rules on top of these regexps right now\n        // would be way too time consuming. (TODO: Rewrite whole RegExp to be more readable)\n        const [func, filename] = extractSafariExtensionDetails(parts[1] || UNKNOWN_FUNCTION, parts[2])\n\n        return createFrame(filename, func, parts[3] ? +parts[3] : undefined, parts[4] ? +parts[4] : undefined)\n    }\n\n    return\n}\n\nexport const chromeStackLineParser: StackLineParser = [CHROME_PRIORITY, chrome]\n\n// gecko regex: `(?:bundle|\\d+\\.js)`: `bundle` is for react native, `\\d+\\.js` also but specifically for ram bundles because it\n// generates filenames without a prefix like `file://` the filenames in the stacktrace are just 42.js\n// We need this specific case for now because we want no other regex to match.\nconst geckoREgex =\n    /^\\s*(.*?)(?:\\((.*?)\\))?(?:^|@)?((?:[-a-z]+)?:\\/.*?|\\[native code\\]|[^@]*(?:bundle|\\d+\\.js)|\\/[\\w\\-. /=]+)(?::(\\d+))?(?::(\\d+))?\\s*$/i\nconst geckoEvalRegex = /(\\S+) line (\\d+)(?: > eval line \\d+)* > eval/i\n\nconst gecko: StackLineParserFn = (line) => {\n    const parts = geckoREgex.exec(line)\n\n    if (parts) {\n        const isEval = parts[3] && parts[3].indexOf(' > eval') > -1\n        if (isEval) {\n            const subMatch = geckoEvalRegex.exec(parts[3])\n\n            if (subMatch) {\n                // throw out eval line/column and use top-most line number\n                parts[1] = parts[1] || 'eval'\n                parts[3] = subMatch[1]\n                parts[4] = subMatch[2]\n                parts[5] = '' // no column when eval\n            }\n        }\n\n        let filename = parts[3]\n        let func = parts[1] || UNKNOWN_FUNCTION\n        ;[func, filename] = extractSafariExtensionDetails(func, filename)\n\n        return createFrame(filename, func, parts[4] ? +parts[4] : undefined, parts[5] ? +parts[5] : undefined)\n    }\n\n    return\n}\n\nexport const geckoStackLineParser: StackLineParser = [GECKO_PRIORITY, gecko]\n\nconst winjsRegex = /^\\s*at (?:((?:\\[object object\\])?.+) )?\\(?((?:[-a-z]+):.*?):(\\d+)(?::(\\d+))?\\)?\\s*$/i\n\nconst winjs: StackLineParserFn = (line) => {\n    const parts = winjsRegex.exec(line)\n\n    return parts\n        ? createFrame(parts[2], parts[1] || UNKNOWN_FUNCTION, +parts[3], parts[4] ? +parts[4] : undefined)\n        : undefined\n}\n\nexport const winjsStackLineParser: StackLineParser = [WINJS_PRIORITY, winjs]\n\nconst opera10Regex = / line (\\d+).*script (?:in )?(\\S+)(?:: in function (\\S+))?$/i\n\nconst opera10: StackLineParserFn = (line) => {\n    const parts = opera10Regex.exec(line)\n    return parts ? createFrame(parts[2], parts[3] || UNKNOWN_FUNCTION, +parts[1]) : undefined\n}\n\nexport const opera10StackLineParser: StackLineParser = [OPERA10_PRIORITY, opera10]\n\nconst opera11Regex = / line (\\d+), column (\\d+)\\s*(?:in (?:<anonymous function: ([^>]+)>|([^)]+))\\(.*\\))? in (.*):\\s*$/i\n\nconst opera11: StackLineParserFn = (line) => {\n    const parts = opera11Regex.exec(line)\n    return parts ? createFrame(parts[5], parts[3] || parts[4] || UNKNOWN_FUNCTION, +parts[1], +parts[2]) : undefined\n}\n\nexport const opera11StackLineParser: StackLineParser = [OPERA11_PRIORITY, opera11]\n\nexport const defaultStackLineParsers = [chromeStackLineParser, geckoStackLineParser, winjsStackLineParser]\n\nexport function reverse(stack: ReadonlyArray<StackFrame>): StackFrame[] {\n    if (!stack.length) {\n        return []\n    }\n\n    const localStack = stack.slice(0, STACKTRACE_FRAME_LIMIT)\n\n    localStack.reverse()\n\n    return localStack.map((frame) => ({\n        ...frame,\n        filename: frame.filename || localStack[localStack.length - 1].filename,\n        function: frame.function || '?',\n    }))\n}\n\nexport function createStackParser(...parsers: StackLineParser[]): StackParser {\n    const sortedParsers = parsers.sort((a, b) => a[0] - b[0]).map((p) => p[1])\n\n    return (stack: string, skipFirst = 0): StackFrame[] => {\n        const frames: StackFrame[] = []\n        const lines = stack.split('\\n')\n\n        for (let i = skipFirst; i < lines.length; i++) {\n            const line = lines[i]\n            // Ignore lines over 1kb as they are unlikely to be stack frames.\n            // Many of the regular expressions use backtracking which results in run time that increases exponentially with\n            // input size. Huge strings can result in hangs/Denial of Service:\n            // https://github.com/getsentry/sentry-javascript/issues/2286\n            if (line.length > 1024) {\n                continue\n            }\n\n            // https://github.com/getsentry/sentry-javascript/issues/5459\n            // Remove webpack (error: *) wrappers\n            const cleanedLine = WEBPACK_ERROR_REGEXP.test(line) ? line.replace(WEBPACK_ERROR_REGEXP, '$1') : line\n\n            // https://github.com/getsentry/sentry-javascript/issues/7813\n            // Skip Error: lines\n            if (cleanedLine.match(/\\S*Error: /)) {\n                continue\n            }\n\n            for (const parser of sortedParsers) {\n                const frame = parser(cleanedLine)\n\n                if (frame) {\n                    frames.push(frame)\n                    break\n                }\n            }\n\n            if (frames.length >= STACKTRACE_FRAME_LIMIT) {\n                break\n            }\n        }\n\n        return reverse(frames)\n    }\n}\n\nexport const defaultStackParser = createStackParser(...defaultStackLineParsers)\n\n/**\n * Safari web extensions, starting version unknown, can produce \"frames-only\" stacktraces.\n * What it means, is that instead of format like:\n *\n * Error: wat\n *   at function@url:row:col\n *   at function@url:row:col\n *   at function@url:row:col\n *\n * it produces something like:\n *\n *   function@url:row:col\n *   function@url:row:col\n *   function@url:row:col\n *\n * Because of that, it won't be captured by `chrome` RegExp and will fall into `Gecko` branch.\n * This function is extracted so that we can use it in both places without duplicating the logic.\n * Unfortunately \"just\" changing RegExp is too complicated now and making it pass all tests\n * and fix this case seems like an impossible, or at least way too time-consuming task.\n */\nconst extractSafariExtensionDetails = (func: string, filename: string): [string, string] => {\n    const isSafariExtension = func.indexOf('safari-extension') !== -1\n    const isSafariWebExtension = func.indexOf('safari-web-extension') !== -1\n\n    return isSafariExtension || isSafariWebExtension\n        ? [\n              func.indexOf('@') !== -1 ? func.split('@')[0] : UNKNOWN_FUNCTION,\n              isSafariExtension ? `safari-extension:${filename}` : `safari-web-extension:${filename}`,\n          ]\n        : [func, filename]\n}\n","import {\n    isDOMError,\n    isDOMException,\n    isError,\n    isErrorEvent,\n    isErrorWithStack,\n    isEvent,\n    isPlainObject,\n    isPrimitive,\n} from './type-checking'\nimport { defaultStackParser, StackFrame } from './stack-trace'\n\n/**\n * based on the very wonderful MIT licensed Sentry SDK\n */\n\nconst ERROR_TYPES_PATTERN =\n    /^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i\n\nexport type ErrorEventArgs = [\n    event: string | Event,\n    source?: string | undefined,\n    lineno?: number | undefined,\n    colno?: number | undefined,\n    error?: Error | undefined\n]\n\nexport interface ErrorProperties {\n    $exception_type: string\n    $exception_message: string\n    $exception_source?: string\n    $exception_lineno?: number\n    $exception_colno?: number\n    $exception_DOMException_code?: string\n    $exception_is_synthetic?: boolean\n    $exception_stack_trace_raw?: string\n    $exception_handled?: boolean\n    $exception_personURL?: string\n}\n\nconst reactMinifiedRegexp = /Minified React error #\\d+;/i\n\nfunction getPopSize(ex: Error & { framesToPop?: number }): number {\n    if (ex) {\n        if (typeof ex.framesToPop === 'number') {\n            return ex.framesToPop\n        }\n\n        if (reactMinifiedRegexp.test(ex.message)) {\n            return 1\n        }\n    }\n\n    return 0\n}\n\nexport function parseStackFrames(ex: Error & { framesToPop?: number; stacktrace?: string }): StackFrame[] {\n    // Access and store the stacktrace property before doing ANYTHING\n    // else to it because Opera is not very good at providing it\n    // reliably in other circumstances.\n    const stacktrace = ex.stacktrace || ex.stack || ''\n\n    const popSize = getPopSize(ex)\n\n    try {\n        return defaultStackParser(stacktrace, popSize)\n    } catch (e) {\n        // no-empty\n    }\n\n    return []\n}\n\nfunction errorPropertiesFromError(error: Error): ErrorProperties {\n    const frames = parseStackFrames(error)\n\n    return {\n        $exception_type: error.name,\n        $exception_message: error.message,\n        $exception_stack_trace_raw: JSON.stringify(frames),\n    }\n}\n\nfunction errorPropertiesFromString(candidate: string): ErrorProperties {\n    return {\n        $exception_type: 'Error',\n        $exception_message: candidate,\n    }\n}\n\n/**\n * Given any captured exception, extract its keys and create a sorted\n * and truncated list that will be used inside the event message.\n * eg. `Non-error exception captured with keys: foo, bar, baz`\n */\nfunction extractExceptionKeysForMessage(exception: Record<string, unknown>, maxLength = 40): string {\n    const keys = Object.keys(exception)\n    keys.sort()\n\n    if (!keys.length) {\n        return '[object has no keys]'\n    }\n\n    for (let i = keys.length; i > 0; i--) {\n        const serialized = keys.slice(0, i).join(', ')\n        if (serialized.length > maxLength) {\n            continue\n        }\n        if (i === keys.length) {\n            return serialized\n        }\n        return serialized.length <= maxLength ? serialized : `${serialized.slice(0, maxLength)}...`\n    }\n\n    return ''\n}\n\nfunction errorPropertiesFromObject(candidate: Record<string, unknown>): ErrorProperties {\n    return {\n        $exception_type: isEvent(candidate) ? candidate.constructor.name : 'Error',\n        $exception_message: `Non-Error ${'exception'} captured with keys: ${extractExceptionKeysForMessage(candidate)}`,\n    }\n}\n\nexport function errorToProperties([event, source, lineno, colno, error]: ErrorEventArgs): ErrorProperties {\n    // exception type and message are not optional but, it's useful to start off without them enforced\n    let errorProperties: Omit<ErrorProperties, '$exception_type' | '$exception_message'> & {\n        $exception_type?: string\n        $exception_message?: string\n    } = {}\n\n    if (error === undefined && typeof event === 'string') {\n        let name = 'Error'\n        let message = event\n        const groups = event.match(ERROR_TYPES_PATTERN)\n        if (groups) {\n            name = groups[1]\n            message = groups[2]\n        }\n        errorProperties = {\n            $exception_type: name,\n            $exception_message: message,\n        }\n    }\n\n    const candidate = error || event\n\n    if (isDOMError(candidate) || isDOMException(candidate)) {\n        // https://developer.mozilla.org/en-US/docs/Web/API/DOMError\n        // https://developer.mozilla.org/en-US/docs/Web/API/DOMException\n\n        const domException = candidate as unknown as DOMException\n\n        if (isErrorWithStack(candidate)) {\n            errorProperties = errorPropertiesFromError(candidate as Error)\n        } else {\n            const name = domException.name || (isDOMError(domException) ? 'DOMError' : 'DOMException')\n            const message = domException.message ? `${name}: ${domException.message}` : name\n            errorProperties = errorPropertiesFromString(message)\n            errorProperties.$exception_type = isDOMError(domException) ? 'DOMError' : 'DOMException'\n            errorProperties.$exception_message = errorProperties.$exception_message || message\n        }\n        if ('code' in domException) {\n            errorProperties['$exception_DOMException_code'] = `${domException.code}`\n        }\n    } else if (isErrorEvent(candidate as ErrorEvent) && (candidate as ErrorEvent).error) {\n        errorProperties = errorPropertiesFromError((candidate as ErrorEvent).error as Error)\n    } else if (isError(candidate)) {\n        errorProperties = errorPropertiesFromError(candidate)\n    } else if (isPlainObject(candidate) || isEvent(candidate)) {\n        // group these by using the keys available on the object\n        const objectException = candidate as Record<string, unknown>\n        errorProperties = errorPropertiesFromObject(objectException)\n        errorProperties.$exception_is_synthetic = true\n    } else {\n        // If none of previous checks were valid, then it must be a string\n        errorProperties.$exception_type = errorProperties.$exception_type || 'Error'\n        errorProperties.$exception_message = errorProperties.$exception_message || candidate\n        errorProperties.$exception_is_synthetic = true\n    }\n\n    return {\n        ...errorProperties,\n        // now we make sure the mandatory fields that were made optional are present\n        $exception_type: errorProperties.$exception_type || 'UnknownErrorType',\n        $exception_message: errorProperties.$exception_message || '',\n        ...(source\n            ? {\n                  $exception_source: source, // TODO get this from URL if not present\n              }\n            : {}),\n        ...(lineno ? { $exception_lineno: lineno } : {}),\n        ...(colno ? { $exception_colno: colno } : {}),\n    }\n}\n\nexport function unhandledRejectionToProperties([ev]: [ev: PromiseRejectionEvent]): ErrorProperties {\n    // dig the object of the rejection out of known event types\n    let error: unknown = ev\n    try {\n        // PromiseRejectionEvents store the object of the rejection under 'reason'\n        // see https://developer.mozilla.org/en-US/docs/Web/API/PromiseRejectionEvent\n        if ('reason' in ev) {\n            error = ev.reason\n        }\n        // something, somewhere, (likely a browser extension) effectively casts PromiseRejectionEvents\n        // to CustomEvents, moving the `promise` and `reason` attributes of the PRE into\n        // the CustomEvent's `detail` attribute, since they're not part of CustomEvent's spec\n        // see https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent and\n        // https://github.com/getsentry/sentry-javascript/issues/2380\n        else if ('detail' in ev && 'reason' in (ev as any).detail) {\n            error = (ev as any).detail.reason\n        }\n    } catch (_oO) {\n        // no-empty\n    }\n\n    // exception type and message are not optional but, it's useful to start off without them enforced\n    let errorProperties: Omit<ErrorProperties, '$exception_type' | '$exception_message'> & {\n        $exception_type?: string\n        $exception_message?: string\n    } = {}\n    if (isPrimitive(error)) {\n        errorProperties = {\n            $exception_message: `Non-Error promise rejection captured with value: ${String(error)}`,\n        }\n    } else {\n        errorProperties = errorToProperties([error as string | Event])\n    }\n    errorProperties.$exception_handled = false\n\n    return {\n        ...errorProperties,\n        // now we make sure the mandatory fields that were made optional are present\n        $exception_type: (errorProperties.$exception_type = 'UnhandledRejection'),\n        $exception_message: (errorProperties.$exception_message =\n            errorProperties.$exception_message || (ev as any).reason || String(error)),\n    }\n}\n","import { window } from '../../utils'\nimport { PostHog } from '../../posthog-core'\nimport { DecideResponse, Properties } from '../../types'\nimport { ErrorEventArgs, ErrorProperties, errorToProperties, unhandledRejectionToProperties } from './error-conversion'\nimport { isPrimitive } from './type-checking'\n\nconst EXCEPTION_INGESTION_ENDPOINT = '/e/'\n\nexport class ExceptionObserver {\n    instance: PostHog\n    remoteEnabled: boolean | undefined\n    private originalOnErrorHandler: typeof window['onerror'] | null | undefined = undefined\n    private originalOnUnhandledRejectionHandler: typeof window['onunhandledrejection'] | null | undefined = undefined\n\n    private errorsToIgnore: RegExp[] = []\n\n    constructor(instance: PostHog) {\n        this.instance = instance\n    }\n\n    private debugLog(...args: any[]) {\n        if (this.instance.get_config('debug')) {\n            console.log('PostHog.js [PostHog.ExceptionObserver]', ...args)\n        }\n    }\n\n    startCapturing() {\n        if (!this.isEnabled() || (window.onerror as any)?.__POSTHOG_INSTRUMENTED__) {\n            return\n        }\n\n        try {\n            this.originalOnErrorHandler = window.onerror\n\n            window.onerror = function (this: ExceptionObserver, ...args: ErrorEventArgs): boolean {\n                this.captureException(args)\n\n                if (this.originalOnErrorHandler) {\n                    // eslint-disable-next-line prefer-rest-params\n                    return this.originalOnErrorHandler.apply(this, args)\n                }\n\n                return false\n            }.bind(this)\n            ;(window.onerror as any).__POSTHOG_INSTRUMENTED__ = true\n\n            this.originalOnUnhandledRejectionHandler = window.onunhandledrejection\n\n            window.onunhandledrejection = function (\n                this: ExceptionObserver,\n                ...args: [ev: PromiseRejectionEvent]\n            ): boolean {\n                const errorProperties: ErrorProperties = unhandledRejectionToProperties(args)\n                this.sendExceptionEvent(errorProperties)\n\n                if (this.originalOnUnhandledRejectionHandler) {\n                    // eslint-disable-next-line prefer-rest-params\n                    return this.originalOnUnhandledRejectionHandler.apply(window, args)\n                }\n\n                return true\n            }.bind(this)\n            ;(window.onunhandledrejection as any).__POSTHOG_INSTRUMENTED__ = true\n        } catch (e) {\n            console.error('PostHog failed to start exception autocapture', e)\n            this.stopCapturing()\n        }\n    }\n\n    stopCapturing() {\n        if (this.originalOnErrorHandler !== undefined) {\n            window.onerror = this.originalOnErrorHandler\n            this.originalOnErrorHandler = null\n        }\n        delete (window.onerror as any)?.__POSTHOG_INSTRUMENTED__\n\n        if (this.originalOnUnhandledRejectionHandler !== undefined) {\n            window.onunhandledrejection = this.originalOnUnhandledRejectionHandler\n            this.originalOnUnhandledRejectionHandler = null\n        }\n        delete (window.onunhandledrejection as any)?.__POSTHOG_INSTRUMENTED__\n    }\n\n    isCapturing() {\n        return !!(window.onerror as any)?.__POSTHOG_INSTRUMENTED__\n    }\n\n    isEnabled() {\n        return this.remoteEnabled ?? false\n    }\n\n    afterDecideResponse(response: DecideResponse) {\n        const autocaptureExceptionsResponse = response.autocaptureExceptions\n        this.remoteEnabled = !!autocaptureExceptionsResponse || false\n        if (\n            !isPrimitive(autocaptureExceptionsResponse) &&\n            'errors_to_ignore' in autocaptureExceptionsResponse &&\n            Array.isArray(autocaptureExceptionsResponse.errors_to_ignore)\n        ) {\n            const dropRules = autocaptureExceptionsResponse.errors_to_ignore\n\n            this.errorsToIgnore = dropRules.map((rule) => {\n                return new RegExp(rule)\n            })\n        }\n\n        if (this.isEnabled()) {\n            this.startCapturing()\n            this.debugLog('Remote config for exception autocapture is enabled, starting', autocaptureExceptionsResponse)\n        } else {\n            this.debugLog(\n                'Remote config for exception autocapture is disabled, not starting',\n                autocaptureExceptionsResponse\n            )\n        }\n    }\n\n    captureException(args: ErrorEventArgs, properties?: Properties) {\n        const errorProperties = errorToProperties(args)\n\n        if (this.errorsToIgnore.some((regex) => regex.test(errorProperties.$exception_message || ''))) {\n            this.debugLog('Ignoring exception based on remote config', errorProperties)\n            return\n        }\n\n        const propertiesToSend = { ...properties, ...errorProperties }\n\n        const posthogHost = this.instance.get_config('ui_host') || this.instance.get_config('api_host')\n        errorProperties.$exception_personURL = posthogHost + '/person/' + this.instance.get_distinct_id()\n\n        this.sendExceptionEvent(propertiesToSend)\n    }\n\n    /**\n     * :TRICKY: Make sure we batch these requests\n     */\n    sendExceptionEvent(properties: { [key: string]: any }) {\n        this.instance.capture('$exception', properties, {\n            transport: 'XHR',\n            method: 'POST',\n            endpoint: EXCEPTION_INGESTION_ENDPOINT,\n            _noTruncate: true,\n            _batchKey: 'exceptionEvent',\n        })\n    }\n}\n","import { PostHog } from './posthog-core'\nimport { SURVEYS } from './posthog-persistence'\n\n/**\n * Having Survey types in types.ts was confusing tsc\n * and generating an invalid module.d.ts\n * See https://github.com/AblaAnalytics/ablaevent-js/issues/698\n */\nexport interface SurveyAppearance {\n    background_color?: string\n    button_color?: string\n    text_color?: string\n}\n\nexport enum SurveyType {\n    Popover = 'Popover',\n    Button = 'Button',\n    Email = 'Email',\n    FullScreen = 'Fullscreen',\n}\n\nexport interface SurveyQuestion {\n    type: SurveyQuestionType\n    question: string\n    required?: boolean\n    link?: boolean\n    choices?: string[]\n}\n\nexport enum SurveyQuestionType {\n    Open = 'open',\n    MultipleChoiceSingle = 'multiple_single',\n    MultipleChoiceMulti = 'multiple_multi',\n    NPS = 'nps',\n    Rating = 'rating',\n    Link = 'link',\n}\n\nexport interface SurveyResponse {\n    surveys: Survey[]\n}\n\nexport type SurveyCallback = (surveys: Survey[]) => void\n\nexport interface Survey {\n    // Sync this with the backend's SurveySerializer!\n    name: string\n    description: string\n    type: SurveyType\n    linked_flag_key?: string | null\n    targeting_flag_key?: string | null\n    questions: SurveyQuestion[]\n    appearance?: SurveyAppearance | null\n    conditions?: { url?: string; selector?: string } | null\n    start_date?: string | null\n    end_date?: string | null\n}\n\nexport class PostHogSurveys {\n    instance: PostHog\n\n    constructor(instance: PostHog) {\n        this.instance = instance\n    }\n\n    getSurveys(callback: SurveyCallback, forceReload = false) {\n        const existingSurveys = this.instance.get_property(SURVEYS)\n        if (!existingSurveys || forceReload) {\n            this.instance._send_request(\n                `${this.instance.get_config('api_host')}/api/surveys/?token=${this.instance.get_config('token')}`,\n                {},\n                { method: 'GET' },\n                (response) => {\n                    const surveys = response.surveys\n                    this.instance.persistence.register({ [SURVEYS]: surveys })\n                    return callback(surveys)\n                }\n            )\n        } else {\n            return callback(existingSurveys)\n        }\n    }\n\n    getActiveMatchingSurveys(callback: SurveyCallback, forceReload = false) {\n        this.getSurveys((surveys) => {\n            const activeSurveys = surveys.filter((survey) => {\n                return !!(survey.start_date && !survey.end_date)\n            })\n            const conditionMatchedSurveys = activeSurveys.filter((survey) => {\n                if (!survey.conditions) {\n                    return true\n                }\n                const urlCheck = survey.conditions?.url\n                    ? window.location.href.indexOf(survey.conditions.url) > -1\n                    : true\n                const selectorCheck = survey.conditions?.selector\n                    ? document.querySelector(survey.conditions.selector)\n                    : true\n                return urlCheck && selectorCheck\n            })\n            const targetingMatchedSurveys = conditionMatchedSurveys.filter((survey) => {\n                if (!survey.linked_flag_key && !survey.targeting_flag_key) {\n                    return true\n                }\n                const linkedFlagCheck = survey.linked_flag_key\n                    ? this.instance.featureFlags.isFeatureEnabled(survey.linked_flag_key)\n                    : true\n                const targetingFlagCheck = survey.targeting_flag_key\n                    ? this.instance.featureFlags.isFeatureEnabled(survey.targeting_flag_key)\n                    : true\n                return linkedFlagCheck && targetingFlagCheck\n            })\n\n            return callback(targetingMatchedSurveys)\n        }, forceReload)\n    }\n}\n","import Config from './config'\nimport {\n    _copyAndTruncateStrings,\n    _each,\n    _eachArray,\n    _extend,\n    _info,\n    _isArray,\n    _isBlockedUA,\n    _isObject,\n    _isUndefined,\n    _register_event,\n    _safewrap_class,\n    _UUID,\n    document,\n    logger,\n    userAgent,\n    window,\n} from './utils'\nimport { autocapture } from './autocapture'\nimport { PostHogFeatureFlags } from './posthog-featureflags'\nimport { ALIAS_ID_KEY, FLAG_CALL_REPORTED, PEOPLE_DISTINCT_ID_KEY, PostHogPersistence } from './posthog-persistence'\nimport { SessionRecording } from './extensions/sessionrecording'\nimport { WebPerformanceObserver } from './extensions/web-performance'\nimport { Decide } from './decide'\nimport { Toolbar } from './extensions/toolbar'\nimport { clearOptInOut, hasOptedIn, hasOptedOut, optIn, optOut, userOptedOut } from './gdpr-utils'\nimport { cookieStore, localStore } from './storage'\nimport { RequestQueue } from './request-queue'\nimport { CaptureMetrics } from './capture-metrics'\nimport { compressData, decideCompression } from './compression'\nimport { addParamsToURL, encodePostData, xhr } from './send-request'\nimport { RetryQueue } from './retry-queue'\nimport { SessionIdManager } from './sessionid'\nimport {\n    AutocaptureConfig,\n    CaptureOptions,\n    CaptureResult,\n    Compression,\n    EarlyAccessFeatureCallback,\n    GDPROptions,\n    isFeatureEnabledOptions,\n    JSC,\n    JsonType,\n    OptInOutCapturingOptions,\n    PostHogConfig,\n    Properties,\n    Property,\n    RequestCallback,\n    SessionIdChangedCallback,\n    SnippetArrayItem,\n    ToolbarParams,\n    XHROptions,\n} from './types'\nimport { SentryIntegration } from './extensions/sentry-integration'\nimport { createSegmentIntegration } from './extensions/segment-integration'\nimport { PageViewIdManager } from './page-view-id'\nimport { ExceptionObserver } from './extensions/exceptions/exception-autocapture'\nimport { PostHogSurveys, SurveyCallback } from './posthog-surveys'\nimport { RateLimiter } from './rate-limiter'\n\n/*\nSIMPLE STYLE GUIDE:\n\nthis.x === public function\nthis._x === internal - only use within this file\nthis.__x === private - only use within the class\n\nGlobals should be all caps\n*/\n\nenum InitType {\n    INIT_MODULE = 0,\n    INIT_SNIPPET = 1,\n}\n\nlet init_type: InitType\n\n// TODO: the type of this is very loose. Sometimes it's also PostHogLib itself\nlet posthog_master: Record<string, PostHog> & {\n    init: (token: string, config: Partial<PostHogConfig>, name: string) => void\n}\n\n// some globals for comparisons\nconst __NOOP = () => {}\nconst __NOOPTIONS = {}\n\nconst PRIMARY_INSTANCE_NAME = 'posthog'\n\n/*\n * Dynamic... constants? Is that an oxymoron?\n */\n// http://hacks.mozilla.org/2009/07/cross-site-xmlhttprequest-with-cors/\n// https://developer.mozilla.org/en-US/docs/DOM/XMLHttpRequest#withCredentials\nconst USE_XHR = window.XMLHttpRequest && 'withCredentials' in new XMLHttpRequest()\n\n// IE<10 does not support cross-origin XHR's but script tags\n// with defer won't block window.onload; ENQUEUE_REQUESTS\n// should only be true for Opera<12\nlet ENQUEUE_REQUESTS = !USE_XHR && userAgent.indexOf('MSIE') === -1 && userAgent.indexOf('Mozilla') === -1\n\nconst defaultConfig = (): PostHogConfig => ({\n    api_host: 'https://e.abla.io',\n    api_method: 'POST',\n    api_transport: 'XHR',\n    ui_host: null,\n    token: '',\n    autocapture: true,\n    rageclick: true,\n    cross_subdomain_cookie: document?.location?.hostname?.indexOf('herokuapp.com') === -1,\n    persistence: 'cookie',\n    persistence_name: '',\n    cookie_name: '',\n    loaded: __NOOP,\n    store_google: true,\n    custom_campaign_params: [],\n    save_referrer: true,\n    test: false,\n    verbose: false,\n    capture_pageview: true,\n    capture_pageleave: true, // We'll only capture pageleave events if capture_pageview is also true\n    debug: false,\n    cookie_expiration: 365,\n    upgrade: false,\n    disable_session_recording: false,\n    disable_persistence: false,\n    disable_cookie: false,\n    enable_recording_console_log: undefined, // When undefined, it falls back to the server-side setting\n    secure_cookie: window?.location?.protocol === 'https:',\n    ip: true,\n    opt_out_capturing_by_default: false,\n    opt_out_persistence_by_default: false,\n    opt_out_capturing_persistence_type: 'localStorage',\n    opt_out_capturing_cookie_prefix: null,\n    opt_in_site_apps: false,\n    property_blacklist: [],\n    respect_dnt: false,\n    sanitize_properties: null,\n    xhr_headers: {}, // { header: value, header2: value }\n    inapp_protocol: '//',\n    inapp_link_new_window: false,\n    request_batching: true,\n    properties_string_max_length: 65535,\n    session_recording: {},\n    mask_all_element_attributes: false,\n    mask_all_text: false,\n    advanced_disable_decide: false,\n    advanced_disable_feature_flags: false,\n    advanced_disable_feature_flags_on_first_load: false,\n    advanced_disable_toolbar_metrics: false,\n    on_xhr_error: (req) => {\n        const error = 'Bad HTTP status: ' + req.status + ' ' + req.statusText\n        console.error(error)\n    },\n    get_device_id: (uuid) => uuid,\n    // Used for internal testing\n    _onCapture: __NOOP,\n    _capture_metrics: false,\n    capture_performance: undefined,\n    name: 'posthog',\n    callback_fn: 'posthog._jsc',\n    bootstrap: {},\n    disable_compression: false,\n    session_idle_timeout_seconds: 30 * 60, // 30 minutes\n    uuid_version: 'v7',\n})\n\n/**\n * create_phlib(token:string, config:object, name:string)\n *\n * This function is used by the init method of PostHogLib objects\n * as well as the main initializer at the end of the JSLib (that\n * initializes document.posthog as well as any additional instances\n * declared before this file has loaded).\n */\nconst create_phlib = function (\n    token: string,\n    config?: Partial<PostHogConfig>,\n    name?: string,\n    createComplete?: (instance: PostHog) => void\n): PostHog {\n    let instance: PostHog\n    const target =\n        name === PRIMARY_INSTANCE_NAME || !posthog_master ? posthog_master : name ? posthog_master[name] : undefined\n    const callbacksHandled = {\n        initComplete: false,\n        syncCode: false,\n    }\n    const handleCallback = (callbackName: keyof typeof callbacksHandled) => (instance: PostHog) => {\n        if (!callbacksHandled[callbackName]) {\n            callbacksHandled[callbackName] = true\n            if (callbacksHandled.initComplete && callbacksHandled.syncCode) {\n                createComplete?.(instance)\n            }\n        }\n    }\n\n    if (target && init_type === InitType.INIT_MODULE) {\n        instance = target as any\n    } else {\n        if (target && !_isArray(target)) {\n            console.error('You have already initialized ' + name)\n            // TODO: throw something instead?\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            return\n        }\n        instance = new PostHog()\n    }\n\n    instance._init(token, config, name, handleCallback('initComplete'))\n    instance.toolbar.maybeLoadToolbar()\n\n    instance.sessionRecording = new SessionRecording(instance)\n    instance.sessionRecording.startRecordingIfEnabled()\n\n    instance.webPerformance = new WebPerformanceObserver(instance)\n    instance.webPerformance.startObservingIfEnabled()\n\n    instance.exceptionAutocapture = new ExceptionObserver(instance)\n\n    instance.__autocapture = instance.get_config('autocapture')\n    autocapture._setIsAutocaptureEnabled(instance)\n    if (autocapture._isAutocaptureEnabled) {\n        instance.__autocapture = instance.get_config('autocapture')\n        const num_buckets = 100\n        const num_enabled_buckets = 100\n        if (!autocapture.enabledForProject(instance.get_config('token'), num_buckets, num_enabled_buckets)) {\n            instance.__autocapture = false\n            logger.log('Not in active bucket: disabling Automatic Event Collection.')\n        } else if (!autocapture.isBrowserSupported()) {\n            instance.__autocapture = false\n            logger.log('Disabling Automatic Event Collection because this browser is not supported')\n        } else {\n            autocapture.init(instance)\n        }\n    }\n\n    // if any instance on the page has debug = true, we set the\n    // global debug to be true\n    Config.DEBUG = Config.DEBUG || instance.get_config('debug')\n\n    // if target is not defined, we called init after the lib already\n    // loaded, so there won't be an array of things to execute\n    if (typeof target !== 'undefined' && _isArray(target)) {\n        // Crunch through the people queue first - we queue this data up &\n        // flush on identify, so it's better to do all these operations first\n        instance._execute_array.call(instance.people, (target as any).people)\n        instance._execute_array(target)\n    }\n\n    handleCallback('syncCode')(instance)\n    return instance\n}\n\n/**\n * PostHog Library Object\n * @constructor\n */\nexport class PostHog {\n    __loaded: boolean\n    __loaded_recorder_version: 'v1' | 'v2' | undefined // flag that keeps track of which version of recorder is loaded\n    config: PostHogConfig\n\n    persistence: PostHogPersistence\n    rateLimiter: RateLimiter\n    sessionPersistence: PostHogPersistence\n    sessionManager: SessionIdManager\n    pageViewIdManager: PageViewIdManager\n    featureFlags: PostHogFeatureFlags\n    surveys: PostHogSurveys\n    toolbar: Toolbar\n    sessionRecording: SessionRecording | undefined\n    webPerformance: WebPerformanceObserver | undefined\n    exceptionAutocapture: ExceptionObserver | undefined\n\n    _captureMetrics: CaptureMetrics\n    _requestQueue: RequestQueue\n    _retryQueue: RetryQueue\n\n    _triggered_notifs: any\n    compression: Partial<Record<Compression, boolean>>\n    _jsc: JSC\n    __captureHooks: ((eventName: string) => void)[]\n    __request_queue: [url: string, data: Record<string, any>, options: XHROptions, callback?: RequestCallback][]\n    __autocapture: boolean | AutocaptureConfig | undefined\n    decideEndpointWasHit: boolean\n\n    SentryIntegration: typeof SentryIntegration\n    segmentIntegration: () => any\n    // keep the default as the original version of the function\n    // config _might_ override this in init below\n    private uuidFn: (version?: 'v7') => string = _UUID('og')\n\n    /** DEPRECATED: We keep this to support existing usage but now one should just call .setPersonProperties */\n    people: {\n        set: (prop: string | Properties, to?: string, callback?: RequestCallback) => void\n        set_once: (prop: string | Properties, to?: string, callback?: RequestCallback) => void\n    }\n\n    constructor() {\n        this.config = defaultConfig()\n        this.compression = {}\n        this.decideEndpointWasHit = false\n        this.SentryIntegration = SentryIntegration\n        this.segmentIntegration = () => createSegmentIntegration(this)\n        this.__captureHooks = []\n        this.__request_queue = []\n        this.__loaded = false\n        this.__loaded_recorder_version = undefined\n        this.__autocapture = undefined\n        this._jsc = function () {} as JSC\n\n        this.featureFlags = new PostHogFeatureFlags(this)\n        this.toolbar = new Toolbar(this)\n        this.pageViewIdManager = new PageViewIdManager(this.uuidFn)\n        this.surveys = new PostHogSurveys(this)\n\n        // these are created in _init() after we have the config\n        this._captureMetrics = undefined as any\n        this._requestQueue = undefined as any\n        this._retryQueue = undefined as any\n        this.persistence = undefined as any\n        this.sessionPersistence = undefined as any\n        this.sessionManager = undefined as any\n        this.rateLimiter = new RateLimiter()\n\n        // NOTE: See the property definition for deprecation notice\n        this.people = {\n            set: (prop: string | Properties, to?: string, callback?: RequestCallback) => {\n                const setProps = typeof prop === 'string' ? { [prop]: to } : prop\n                this.setPersonProperties(setProps)\n                callback?.({})\n            },\n            set_once: (prop: string | Properties, to?: string, callback?: RequestCallback) => {\n                const setProps = typeof prop === 'string' ? { [prop]: to } : prop\n                this.setPersonProperties(undefined, setProps)\n                callback?.({})\n            },\n        }\n    }\n\n    // Initialization methods\n\n    /**\n     * This function initializes a new instance of the PostHog capturing object.\n     * All new instances are added to the main posthog object as sub properties (such as\n     * posthog.library_name) and also returned by this function. To define a\n     * second instance on the page, you would call:\n     *\n     *     posthog.init('new token', { your: 'config' }, 'library_name');\n     *\n     * and use it like so:\n     *\n     *     posthog.library_name.capture(...);\n     *\n     * @param {String} token   Your PostHog API token\n     * @param {Object} [config]  A dictionary of config options to override. <a href=\"https://github.com/AblaAnalytics/ablaevent-js/blob/6e0e873/src/posthog-core.js#L57-L91\">See a list of default config options</a>.\n     * @param {String} [name]    The name for the new posthog instance that you want created\n     */\n    init(token: string, config?: Partial<PostHogConfig>, name?: string): PostHog | void {\n        if (_isUndefined(name)) {\n            console.error('You must name your new library: init(token, config, name)')\n            return\n        }\n        if (name === PRIMARY_INSTANCE_NAME) {\n            console.error('You must initialize the main posthog object right after you include the PostHog js snippet')\n            return\n        }\n\n        const instance: PostHog = create_phlib(token, config, name, (instance: PostHog) => {\n            posthog_master[name] = instance\n            instance._loaded()\n        })\n        posthog_master[name] = instance\n\n        return instance\n    }\n\n    // posthog._init(token:string, config:object, name:string)\n    //\n    // This function sets up the current instance of the posthog\n    // library.  The difference between this method and the init(...)\n    // method is this one initializes the actual instance, whereas the\n    // init(...) method sets up a new library and calls _init on it.\n    //\n    // Note that there are operations that can be asynchronous, so we\n    // accept a callback that is called when all the asynchronous work\n    // is done. Note that we do not use promises because we want to be\n    // IE11 compatible. We could use polyfills, which would make the\n    // code a bit cleaner, but will add some overhead.\n    //\n    _init(\n        token: string,\n        config: Partial<PostHogConfig> = {},\n        name?: string,\n        initComplete?: (instance: PostHog) => void\n    ): void {\n        this.__loaded = true\n        this.config = {} as PostHogConfig // will be set right below\n        this._triggered_notifs = []\n\n        // To avoid using Promises and their helper functions, we instead keep\n        // track of which callbacks have been called, and then call initComplete\n        // when all of them have been called. To add additional async code, add\n        // to `callbacksHandled` and pass updateInitComplete as a callback to\n        // the async code.\n        const callbacksHandled = { segmentRegister: false, syncCode: false }\n        const updateInitComplete = (callbackName: keyof typeof callbacksHandled) => () => {\n            // Update the register of callbacks that have been called, and if\n            // they have all been called, then we are ready to call\n            // initComplete.\n            if (!callbacksHandled[callbackName]) {\n                callbacksHandled[callbackName] = true\n                if (callbacksHandled.segmentRegister && callbacksHandled.syncCode) {\n                    initComplete?.(this)\n                }\n            }\n        }\n\n        this.set_config(\n            _extend({}, defaultConfig(), config, {\n                name: name,\n                token: token,\n                callback_fn: (name === PRIMARY_INSTANCE_NAME ? name : PRIMARY_INSTANCE_NAME + '.' + name) + '._jsc',\n            })\n        )\n\n        // in preparation for switching from a custom UUID format\n        // to UUID v7 this lets us inject the desired default version\n        // into the _UUID function\n        this.uuidFn = _UUID(this.config.uuid_version || 'og')\n\n        this._jsc = function () {} as JSC\n\n        // Check if recorder.js is already loaded\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        if (window?.rrweb?.record || window?.rrwebRecord) {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            this.__loaded_recorder_version = window?.rrweb?.version\n        }\n\n        this.persistence = new PostHogPersistence(this.config)\n\n        this._captureMetrics = new CaptureMetrics(this.get_config('_capture_metrics'))\n        this._requestQueue = new RequestQueue(this._captureMetrics, this._handle_queued_event.bind(this))\n        this._retryQueue = new RetryQueue(this._captureMetrics, this.get_config('on_xhr_error'), this.rateLimiter)\n        this.__captureHooks = []\n        this.__request_queue = []\n\n        this.sessionManager = new SessionIdManager(this.config, this.persistence, this.uuidFn)\n        this.sessionPersistence =\n            this.config.persistence === 'sessionStorage'\n                ? this.persistence\n                : new PostHogPersistence({ ...this.config, persistence: 'sessionStorage' })\n\n        this._gdpr_init()\n\n        if (config.segment) {\n            // Use segments anonymousId instead\n            this.config.get_device_id = () => config.segment.user().anonymousId()\n\n            // If a segment user ID exists, set it as the distinct_id\n            if (config.segment.user().id()) {\n                this.register({\n                    distinct_id: config.segment.user().id(),\n                })\n                this.persistence.set_user_state('identified')\n            }\n\n            config.segment.register(this.segmentIntegration()).then(updateInitComplete('segmentRegister'))\n        } else {\n            updateInitComplete('segmentRegister')()\n        }\n\n        if (config.bootstrap?.distinctID !== undefined) {\n            const uuid = this.get_config('get_device_id')(this.uuidFn())\n            const deviceID = config.bootstrap?.isIdentifiedID ? uuid : config.bootstrap.distinctID\n            this.persistence.set_user_state(config.bootstrap?.isIdentifiedID ? 'identified' : 'anonymous')\n            this.register({\n                distinct_id: config.bootstrap.distinctID,\n                $device_id: deviceID,\n            })\n        }\n\n        if (this._hasBootstrappedFeatureFlags()) {\n            const activeFlags = Object.keys(config.bootstrap?.featureFlags || {})\n                .filter((flag) => !!config.bootstrap?.featureFlags?.[flag])\n                .reduce(\n                    (res: Record<string, string | boolean>, key) => (\n                        (res[key] = config.bootstrap?.featureFlags?.[key] || false), res\n                    ),\n                    {}\n                )\n            const featureFlagPayloads = Object.keys(config.bootstrap?.featureFlagPayloads || {})\n                .filter((key) => activeFlags[key])\n                .reduce((res: Record<string, JsonType>, key) => {\n                    if (config.bootstrap?.featureFlagPayloads?.[key]) {\n                        res[key] = config.bootstrap?.featureFlagPayloads?.[key]\n                    }\n                    return res\n                }, {})\n\n            this.featureFlags.receivedFeatureFlags({ featureFlags: activeFlags, featureFlagPayloads })\n        }\n\n        if (!this.get_distinct_id()) {\n            // There is no need to set the distinct id\n            // or the device id if something was already stored\n            // in the persitence\n            const uuid = this.get_config('get_device_id')(this.uuidFn())\n            this.register_once(\n                {\n                    distinct_id: uuid,\n                    $device_id: uuid,\n                },\n                ''\n            )\n            // distinct id == $device_id is a proxy for anonymous user\n            this.persistence.set_user_state('anonymous')\n        }\n        // Set up event handler for pageleave\n        // Use `onpagehide` if available, see https://calendar.perfplanet.com/2020/beaconing-in-practice/#beaconing-reliability-avoiding-abandons\n        window.addEventListener &&\n            window.addEventListener('onpagehide' in self ? 'pagehide' : 'unload', this._handle_unload.bind(this))\n\n        // Make sure that we also call the initComplete callback at the end of\n        // the synchronous code as well.\n        updateInitComplete('syncCode')()\n    }\n\n    // Private methods\n\n    _loaded(): void {\n        // Pause `reloadFeatureFlags` calls in config.loaded callback.\n        // These feature flags are loaded in the decide call made right\n        // afterwards\n        this.featureFlags.setReloadingPaused(true)\n\n        try {\n            this.get_config('loaded')(this)\n        } catch (err) {\n            console.error('`loaded` function failed', err)\n        }\n\n        this._start_queue_if_opted_in()\n\n        // this happens after so a user can call identify in\n        // the loaded callback\n        if (this.get_config('capture_pageview')) {\n            this.capture('$pageview', { title: document.title }, { send_instantly: true })\n        }\n\n        // Call decide to get what features are enabled and other settings.\n        // As a reminder, if the /decide endpoint is disabled, feature flags, toolbar, session recording, autocapture,\n        // and compression will not be available.\n        if (!this.get_config('advanced_disable_decide')) {\n            new Decide(this).call()\n        }\n\n        this.featureFlags.resetRequestQueue()\n        this.featureFlags.setReloadingPaused(false)\n    }\n\n    _start_queue_if_opted_in(): void {\n        if (!this.has_opted_out_capturing()) {\n            if (this.get_config('request_batching')) {\n                this._requestQueue.poll()\n            }\n        }\n    }\n\n    _dom_loaded(): void {\n        if (!this.has_opted_out_capturing()) {\n            _eachArray(this.__request_queue, (item) => {\n                this._send_request(...item)\n            })\n        }\n\n        this.__request_queue = []\n\n        this._start_queue_if_opted_in()\n    }\n\n    /**\n     * _prepare_callback() should be called by callers of _send_request for use\n     * as the callback argument.\n     *\n     * If there is no callback, this returns null.\n     * If we are going to make XHR/XDR requests, this returns a function.\n     * If we are going to use script tags, this returns a string to use as the\n     * callback GET param.\n     */\n    // TODO: get rid of the \"| string\"\n    _prepare_callback(callback?: RequestCallback, data?: Properties): RequestCallback | null | string {\n        if (_isUndefined(callback)) {\n            return null\n        }\n\n        if (USE_XHR) {\n            return function (response) {\n                callback(response, data)\n            }\n        } else {\n            // if the user gives us a callback, we store as a random\n            // property on this instances jsc function and update our\n            // callback string to reflect that.\n            const jsc = this._jsc\n            const randomized_cb = '' + Math.floor(Math.random() * 100000000)\n            const callback_string = this.get_config('callback_fn') + '[' + randomized_cb + ']'\n            jsc[randomized_cb] = function (response: any) {\n                delete jsc[randomized_cb]\n                callback(response, data)\n            }\n            return callback_string\n        }\n    }\n\n    _handle_unload(): void {\n        if (!this.get_config('request_batching')) {\n            if (this.get_config('capture_pageview') && this.get_config('capture_pageleave')) {\n                this.capture('$pageleave', null, { transport: 'sendBeacon' })\n            }\n            return\n        }\n\n        if (this.get_config('capture_pageview') && this.get_config('capture_pageleave')) {\n            this.capture('$pageleave')\n        }\n        if (this.get_config('_capture_metrics')) {\n            this._requestQueue.updateUnloadMetrics()\n            this.capture('$capture_metrics', this._captureMetrics.metrics)\n        }\n        this._requestQueue.unload()\n        this._retryQueue.unload()\n    }\n\n    _handle_queued_event(url: string, data: Record<string, any>, options?: XHROptions): void {\n        const jsonData = JSON.stringify(data)\n        this.__compress_and_send_json_request(url, jsonData, options || __NOOPTIONS, __NOOP)\n    }\n\n    __compress_and_send_json_request(\n        url: string,\n        jsonData: string,\n        options: XHROptions,\n        callback?: RequestCallback\n    ): void {\n        const [data, _options] = compressData(decideCompression(this.compression), jsonData, options)\n        this._send_request(url, data, _options, callback)\n    }\n\n    _send_request(url: string, data: Record<string, any>, options: CaptureOptions, callback?: RequestCallback): void {\n        if (this.rateLimiter.isRateLimited(options._batchKey)) {\n            if (this.get_config('debug')) {\n                console.warn('[PostHog SendRequest] is quota limited. Dropping request.')\n            }\n            return\n        }\n\n        if (ENQUEUE_REQUESTS) {\n            this.__request_queue.push([url, data, options, callback])\n            return\n        }\n\n        const DEFAULT_OPTIONS = {\n            method: this.get_config('api_method'),\n            transport: this.get_config('api_transport'),\n            verbose: this.get_config('verbose'),\n        }\n\n        options = _extend(DEFAULT_OPTIONS, options || {})\n        if (!USE_XHR) {\n            options.method = 'GET'\n        }\n\n        const useSendBeacon = 'sendBeacon' in window.navigator && options.transport === 'sendBeacon'\n        url = addParamsToURL(url, options.urlQueryArgs || {}, {\n            ip: this.get_config('ip'),\n        })\n\n        if (useSendBeacon) {\n            // beacon documentation https://w3c.github.io/beacon/\n            // beacons format the message and use the type property\n            try {\n                window.navigator.sendBeacon(url, encodePostData(data, { ...options, sendBeacon: true }))\n            } catch (e) {\n                // send beacon is a best-effort, fire-and-forget mechanism on page unload,\n                // we don't want to throw errors here\n            }\n        } else if (USE_XHR) {\n            try {\n                xhr({\n                    url: url,\n                    data: data,\n                    headers: this.get_config('xhr_headers'),\n                    options: options,\n                    captureMetrics: this._captureMetrics,\n                    callback,\n                    retriesPerformedSoFar: 0,\n                    retryQueue: this._retryQueue,\n                    onXHRError: this.get_config('on_xhr_error'),\n                    onRateLimited: this.rateLimiter.on429Response,\n                })\n            } catch (e) {\n                console.error(e)\n            }\n        } else {\n            const script = document.createElement('script')\n            script.type = 'text/javascript'\n            script.async = true\n            script.defer = true\n            script.src = url\n            const s = document.getElementsByTagName('script')[0]\n            s.parentNode?.insertBefore(script, s)\n        }\n    }\n\n    /**\n     * _execute_array() deals with processing any posthog function\n     * calls that were called before the PostHog library were loaded\n     * (and are thus stored in an array so they can be called later)\n     *\n     * Note: we fire off all the posthog function calls && user defined\n     * functions BEFORE we fire off posthog capturing calls. This is so\n     * identify/register/set_config calls can properly modify early\n     * capturing calls.\n     *\n     * @param {Array} array\n     */\n    _execute_array(array: SnippetArrayItem[]): void {\n        let fn_name\n        const alias_calls: SnippetArrayItem[] = []\n        const other_calls: SnippetArrayItem[] = []\n        const capturing_calls: SnippetArrayItem[] = []\n        _eachArray(array, (item) => {\n            if (item) {\n                fn_name = item[0]\n                if (_isArray(fn_name)) {\n                    capturing_calls.push(item) // chained call e.g. posthog.get_group().set()\n                } else if (typeof item === 'function') {\n                    ;(item as any).call(this)\n                } else if (_isArray(item) && fn_name === 'alias') {\n                    alias_calls.push(item)\n                } else if (\n                    _isArray(item) &&\n                    fn_name.indexOf('capture') !== -1 &&\n                    typeof (this as any)[fn_name] === 'function'\n                ) {\n                    capturing_calls.push(item)\n                } else {\n                    other_calls.push(item)\n                }\n            }\n        })\n\n        const execute = function (calls: SnippetArrayItem[], thisArg: any) {\n            _eachArray(\n                calls,\n                function (item) {\n                    if (_isArray(item[0])) {\n                        // chained call\n                        let caller = thisArg\n                        _each(item, function (call) {\n                            caller = caller[call[0]].apply(caller, call.slice(1))\n                        })\n                    } else {\n                        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                        // @ts-ignore\n                        this[item[0]].apply(this, item.slice(1))\n                    }\n                },\n                thisArg\n            )\n        }\n\n        execute(alias_calls, this)\n        execute(other_calls, this)\n        execute(capturing_calls, this)\n    }\n\n    _hasBootstrappedFeatureFlags(): boolean {\n        return (\n            (this.config.bootstrap?.featureFlags && Object.keys(this.config.bootstrap?.featureFlags).length > 0) ||\n            false\n        )\n    }\n\n    /**\n     * push() keeps the standard async-array-push\n     * behavior around after the lib is loaded.\n     * This is only useful for external integrations that\n     * do not wish to rely on our convenience methods\n     * (created in the snippet).\n     *\n     * ### Usage:\n     *     posthog.push(['register', { a: 'b' }]);\n     *\n     * @param {Array} item A [function_name, args...] array to be executed\n     */\n    push(item: SnippetArrayItem): void {\n        this._execute_array([item])\n    }\n\n    /*\n     * PostHog supports exception autocapture, however, this function\n     * is used to manually capture an exception\n     * and can be used to add more context to that exception\n     *\n     * Properties passed as the second option will be merged with the properties\n     * of the exception event.\n     * Where there is a key in both generated exception and passed properties,\n     * the generated exception property takes precedence.\n     */\n    captureException(exception: Error, properties?: Properties): void {\n        this.exceptionAutocapture?.captureException(\n            [exception.name, undefined, undefined, undefined, exception],\n            properties\n        )\n    }\n\n    /**\n     * Capture an event. This is the most important and\n     * frequently used PostHog function.\n     *\n     * ### Usage:\n     *\n     *     // capture an event named 'Registered'\n     *     posthog.capture('Registered', {'Gender': 'Male', 'Age': 21});\n     *\n     *     // capture an event using navigator.sendBeacon\n     *     posthog.capture('Left page', {'duration_seconds': 35}, {transport: 'sendBeacon'});\n     *\n     * @param {String} event_name The name of the event. This can be anything the user does - 'Button Click', 'Sign Up', 'Item Purchased', etc.\n     * @param {Object} [properties] A set of properties to include with the event you're sending. These describe the user who did the event or details about the event itself.\n     * @param {Object} [options] Optional configuration for this capture request.\n     * @param {String} [options.transport] Transport method for network request ('XHR' or 'sendBeacon').\n     * @param {Date} [options.timestamp] Timestamp is a Date object. If not set, it'll automatically be set to the current time.\n     */\n    capture(\n        event_name: string,\n        properties?: Properties | null,\n        options: CaptureOptions = __NOOPTIONS\n    ): CaptureResult | void {\n        // While developing, a developer might purposefully _not_ call init(),\n        // in this case, we would like capture to be a noop.\n        if (!this.__loaded) {\n            return\n        }\n\n        if (userOptedOut(this, false)) {\n            return\n        }\n\n        this._captureMetrics.incr('capture')\n        if (event_name === '$snapshot') {\n            this._captureMetrics.incr('snapshot')\n        }\n\n        options = options || __NOOPTIONS\n        const transport = options['transport'] // external API, don't minify 'transport' prop\n        if (transport) {\n            options.transport = transport // 'transport' prop name can be minified internally\n        }\n\n        // typing doesn't prevent interesting data\n        if (_isUndefined(event_name) || typeof event_name !== 'string') {\n            console.error('No event name provided to posthog.capture')\n            return\n        }\n\n        if (_isBlockedUA(userAgent)) {\n            return\n        }\n\n        // update persistence\n        this.sessionPersistence.update_search_keyword()\n\n        if (this.get_config('store_google')) {\n            this.sessionPersistence.update_campaign_params()\n        }\n        if (this.get_config('save_referrer')) {\n            this.sessionPersistence.update_referrer_info()\n        }\n\n        let data: CaptureResult = {\n            uuid: this.uuidFn('v7'),\n            event: event_name,\n            properties: this._calculate_event_properties(event_name, properties || {}),\n        }\n\n        if (event_name === '$identify') {\n            data['$set'] = options['$set']\n            data['$set_once'] = options['$set_once']\n        }\n\n        data = _copyAndTruncateStrings(\n            data,\n            options._noTruncate ? null : this.get_config('properties_string_max_length')\n        )\n        data.timestamp = options.timestamp || new Date()\n\n        if (this.get_config('debug')) {\n            logger.log('PostHog.js send', data)\n        }\n        const jsonData = JSON.stringify(data)\n\n        const url = this.get_config('api_host') + (options.endpoint || '/e/')\n\n        const has_unique_traits = options !== __NOOPTIONS\n\n        if (\n            this.get_config('request_batching') &&\n            (!has_unique_traits || options._batchKey) &&\n            !options.send_instantly\n        ) {\n            this._requestQueue.enqueue(url, data, options)\n        } else {\n            this.__compress_and_send_json_request(url, jsonData, options)\n        }\n\n        this._invokeCaptureHooks(event_name, data)\n\n        return data\n    }\n\n    _addCaptureHook(callback: (eventName: string) => void): void {\n        this.__captureHooks.push(callback)\n    }\n\n    _invokeCaptureHooks(eventName: string, eventData: CaptureResult): void {\n        this.config._onCapture(eventName, eventData)\n        _each(this.__captureHooks, (callback) => callback(eventName))\n    }\n\n    _calculate_event_properties(event_name: string, event_properties: Properties): Properties {\n        // set defaults\n        const start_timestamp = this.persistence.remove_event_timer(event_name)\n        let properties = { ...event_properties }\n        properties['token'] = this.get_config('token')\n\n        if (event_name === '$snapshot') {\n            const persistenceProps = { ...this.persistence.properties(), ...this.sessionPersistence.properties() }\n            properties['distinct_id'] = persistenceProps.distinct_id\n            return properties\n        }\n\n        const infoProperties = _info.properties()\n\n        if (this.sessionManager) {\n            const { sessionId, windowId } = this.sessionManager.checkAndGetSessionAndWindowId()\n            properties['$session_id'] = sessionId\n            properties['$window_id'] = windowId\n        }\n\n        if (this.webPerformance?.isEnabled) {\n            if (event_name === '$pageview') {\n                this.pageViewIdManager.onPageview()\n            }\n            properties = _extend(properties, { $pageview_id: this.pageViewIdManager.getPageViewId() })\n        }\n\n        if (event_name === '$pageview') {\n            properties['title'] = document.title\n        }\n\n        if (event_name === '$performance_event') {\n            const persistenceProps = this.persistence.properties()\n            // Early exit for $performance_event as we only need session and $current_url\n            properties['distinct_id'] = persistenceProps.distinct_id\n            properties['$current_url'] = infoProperties.$current_url\n            return properties\n        }\n\n        // set $duration if time_event was previously called for this event\n        if (typeof start_timestamp !== 'undefined') {\n            const duration_in_ms = new Date().getTime() - start_timestamp\n            properties['$duration'] = parseFloat((duration_in_ms / 1000).toFixed(3))\n        }\n\n        // note: extend writes to the first object, so lets make sure we\n        // don't write to the persistence properties object and info\n        // properties object by passing in a new object\n\n        // update properties with pageview info and super-properties\n        properties = _extend(\n            {},\n            _info.properties(),\n            this.persistence.properties(),\n            this.sessionPersistence.properties(),\n            properties\n        )\n\n        const property_blacklist = this.get_config('property_blacklist')\n        if (_isArray(property_blacklist)) {\n            _each(property_blacklist, function (blacklisted_prop) {\n                delete properties[blacklisted_prop]\n            })\n        } else {\n            console.error('Invalid value for property_blacklist config: ' + property_blacklist)\n        }\n\n        const sanitize_properties = this.get_config('sanitize_properties')\n        if (sanitize_properties) {\n            properties = sanitize_properties(properties, event_name)\n        }\n\n        return properties\n    }\n\n    /**\n     * Register a set of super properties, which are included with all\n     * events. This will overwrite previous super property values, except\n     * for session properties (see `register_for_session(properties)`).\n     *\n     * ### Usage:\n     *\n     *     // register 'Gender' as a super property\n     *     posthog.register({'Gender': 'Female'});\n     *\n     *     // register several super properties when a user signs up\n     *     posthog.register({\n     *         'Email': 'jdoe@example.com',\n     *         'Account Type': 'Free'\n     *     });\n     *\n     *     // Display the properties\n     *     console.log(posthog.persistence.properties())\n     *\n     * @param {Object} properties An associative array of properties to store about the user\n     * @param {Number} [days] How many days since the user's last visit to store the super properties\n     */\n    register(properties: Properties, days?: number): void {\n        this.persistence.register(properties, days)\n    }\n\n    /**\n     * Register a set of super properties only once. These will not\n     * overwrite previous super property values, unlike register().\n     *\n     * ### Usage:\n     *\n     *     // register a super property for the first time only\n     *     posthog.register_once({\n     *         'First Login Date': new Date().toISOString()\n     *     });\n     *\n     *     // Display the properties\n     *     console.log(posthog.persistence.properties())\n     *\n     * ### Notes:\n     *\n     * If default_value is specified, current super properties\n     * with that value will be overwritten.\n     *\n     * @param {Object} properties An associative array of properties to store about the user\n     * @param {*} [default_value] Value to override if already set in super properties (ex: 'False') Default: 'None'\n     * @param {Number} [days] How many days since the users last visit to store the super properties\n     */\n    register_once(properties: Properties, default_value?: Property, days?: number): void {\n        this.persistence.register_once(properties, default_value, days)\n    }\n\n    /**\n     * Register a set of super properties, which are included with all events, but only\n     * for THIS SESSION. These will overwrite all other super property values.\n     *\n     * Unlike regular super properties, which last in LocalStorage for a long time,\n     * session super properties get cleared after a session ends.\n     *\n     * ### Usage:\n     *\n     *     // register on all events this session\n     *     posthog.register_for_session({'referer': customGetReferer()});\n     *\n     *     // register several session super properties when a user signs up\n     *     posthog.register_for_session({\n     *         'selectedPlan': 'pro',\n     *         'completedSteps': 4,\n     *     });\n     *\n     *     // Display the properties\n     *     console.log(posthog.sessionPersistence.properties())\n     *\n     * @param {Object} properties An associative array of properties to store about the user\n     */\n    register_for_session(properties: Properties): void {\n        this.sessionPersistence.register(properties)\n    }\n\n    /**\n     * Delete a super property stored with the current user.\n     *\n     * @param {String} property The name of the super property to remove\n     */\n    unregister(property: string): void {\n        this.persistence.unregister(property)\n    }\n\n    /**\n     * Delete a session super property stored with the current user.\n     *\n     * @param {String} property The name of the session super property to remove\n     */\n    unregister_for_session(property: string): void {\n        this.sessionPersistence.unregister(property)\n    }\n\n    _register_single(prop: string, value: Property) {\n        this.register({ [prop]: value })\n    }\n\n    /*\n     * Get feature flag value for user (supports multivariate flags).\n     *\n     * ### Usage:\n     *\n     *     if(posthog.getFeatureFlag('beta-feature') === 'some-value') { // do something }\n     *\n     * @param {Object|String} prop Key of the feature flag.\n     * @param {Object|String} options (optional) If {send_event: false}, we won't send an $feature_flag_call event to PostHog.\n     */\n    getFeatureFlag(key: string, options?: { send_event?: boolean }): boolean | string | undefined {\n        return this.featureFlags.getFeatureFlag(key, options)\n    }\n\n    /*\n     * Get feature flag payload value matching key for user (supports multivariate flags).\n     *\n     * ### Usage:\n     *\n     *     if(posthog.getFeatureFlag('beta-feature') === 'some-value') {\n     *          const someValue = posthog.getFeatureFlagPayload('beta-feature')\n     *          // do something\n     *     }\n     *\n     * @param {Object|String} prop Key of the feature flag.\n     */\n    getFeatureFlagPayload(key: string): JsonType {\n        const payload = this.featureFlags.getFeatureFlagPayload(key)\n        try {\n            return JSON.parse(payload as any)\n        } catch {\n            return payload\n        }\n    }\n\n    /*\n     * See if feature flag is enabled for user.\n     *\n     * ### Usage:\n     *\n     *     if(posthog.isFeatureEnabled('beta-feature')) { // do something }\n     *\n     * @param {Object|String} prop Key of the feature flag.\n     * @param {Object|String} options (optional) If {send_event: false}, we won't send an $feature_flag_call event to PostHog.\n     */\n    isFeatureEnabled(key: string, options?: isFeatureEnabledOptions): boolean | undefined {\n        return this.featureFlags.isFeatureEnabled(key, options)\n    }\n\n    reloadFeatureFlags(): void {\n        this.featureFlags.reloadFeatureFlags()\n    }\n\n    /** Opt the user in or out of an early access feature. */\n    updateEarlyAccessFeatureEnrollment(key: string, isEnrolled: boolean): void {\n        this.featureFlags.updateEarlyAccessFeatureEnrollment(key, isEnrolled)\n    }\n\n    /** Get the list of early access features. To check enrollment status, use `isFeatureEnabled`. */\n    getEarlyAccessFeatures(callback: EarlyAccessFeatureCallback, force_reload = false): void {\n        return this.featureFlags.getEarlyAccessFeatures(callback, force_reload)\n    }\n\n    /*\n     * Register an event listener that runs when feature flags become available or when they change.\n     * If there are flags, the listener is called immediately in addition to being called on future changes.\n     *\n     * ### Usage:\n     *\n     *     posthog.onFeatureFlags(function(featureFlags) { // do something })\n     *\n     * @param {Function} [callback] The callback function will be called once the feature flags are ready or when they are updated.\n     *                              It'll return a list of feature flags enabled for the user.\n     * @returns {Function} A function that can be called to unsubscribe the listener. Used by useEffect when the component unmounts.\n     */\n    onFeatureFlags(callback: (flags: string[], variants: Record<string, string | boolean>) => void): () => void {\n        return this.featureFlags.onFeatureFlags(callback)\n    }\n\n    /*\n     * Register an event listener that runs whenever the session id or window id change.\n     * If there is already a session id, the listener is called immediately in addition to being called on future changes.\n     *\n     * Can be used, for example, to sync the PostHog session id with a backend session.\n     *\n     * ### Usage:\n     *\n     *     posthog.onSessionId(function(sessionId, windowId) { // do something })\n     *\n     * @param {Function} [callback] The callback function will be called once a session id is present or when it or the window id are updated.\n     * @returns {Function} A function that can be called to unsubscribe the listener. E.g. Used by useEffect when the component unmounts.\n     */\n    onSessionId(callback: SessionIdChangedCallback): () => void {\n        return this.sessionManager.onSessionId(callback)\n    }\n\n    /** Get list of all surveys. */\n    getSurveys(callback: SurveyCallback, forceReload = false): void {\n        this.surveys.getSurveys(callback, forceReload)\n    }\n\n    /** Get surveys that should be enabled for the current user. */\n    getActiveMatchingSurveys(callback: SurveyCallback, forceReload = false): void {\n        this.surveys.getActiveMatchingSurveys(callback, forceReload)\n    }\n\n    /**\n     * Identify a user with a unique ID instead of a PostHog\n     * randomly generated distinct_id. If the method is never called,\n     * then unique visitors will be identified by a UUID that is generated\n     * the first time they visit the site.\n     *\n     * If user properties are passed, they are also sent to posthog.\n     *\n     * ### Usage:\n     *\n     *      posthog.identify('[user unique id]')\n     *      posthog.identify('[user unique id]', { email: 'john@example.com' })\n     *      posthog.identify('[user unique id]', {}, { referral_code: '12345' })\n     *\n     * ### Notes:\n     *\n     * You can call this function to overwrite a previously set\n     * unique ID for the current user.\n     *\n     * If the user has been identified ($user_state in persistence is set to 'identified'),\n     * then capture of $identify is skipped to avoid merging users. For example,\n     * if your system allows an admin user to impersonate another user.\n     *\n     * Then a single browser instance can have:\n     *\n     *  `identify('a') -> capture(1) -> identify('b') -> capture(2)`\n     *\n     * and capture 1 and capture 2 will have the correct distinct_id.\n     * but users a and b will NOT be merged in posthog.\n     *\n     * However, if reset is called then:\n     *\n     *  `identify('a') -> capture(1) -> reset() -> capture(2) -> identify('b') -> capture(3)`\n     *\n     * users a and b are not merged.\n     * Capture 1 is associated with user a.\n     * A new distinct id is generated for capture 2.\n     * which is merged with user b.\n     * So, capture 2 and 3 are associated with user b.\n     *\n     * If you want to merge two identified users, you can call posthog.alias\n     *\n     * @param {String} [new_distinct_id] A string that uniquely identifies a user. If not provided, the distinct_id currently in the persistent store (cookie or localStorage) will be used.\n     * @param {Object} [userPropertiesToSet] Optional: An associative array of properties to store about the user\n     * @param {Object} [userPropertiesToSetOnce] Optional: An associative array of properties to store about the user. If property is previously set, this does not override that value.\n     */\n    identify(new_distinct_id?: string, userPropertiesToSet?: Properties, userPropertiesToSetOnce?: Properties): void {\n        //if the new_distinct_id has not been set ignore the identify event\n        if (!new_distinct_id) {\n            console.error('Unique user id has not been set in posthog.identify')\n            return\n        }\n\n        this._captureMetrics.incr('identify')\n\n        const previous_distinct_id = this.get_distinct_id()\n        this.register({ $user_id: new_distinct_id })\n\n        if (!this.get_property('$device_id')) {\n            // The persisted distinct id might not actually be a device id at all\n            // it might be a distinct id of the user from before\n            const device_id = previous_distinct_id\n            this.register_once(\n                {\n                    $had_persisted_distinct_id: true,\n                    $device_id: device_id,\n                },\n                ''\n            )\n        }\n\n        // if the previous distinct id had an alias stored, then we clear it\n        if (new_distinct_id !== previous_distinct_id && new_distinct_id !== this.get_property(ALIAS_ID_KEY)) {\n            this.unregister(ALIAS_ID_KEY)\n            this.register({ distinct_id: new_distinct_id })\n        }\n\n        const isKnownAnonymous = this.persistence.get_user_state() === 'anonymous'\n\n        // send an $identify event any time the distinct_id is changing and the old ID is an anoymous ID\n        // - logic on the server will determine whether or not to do anything with it.\n        if (new_distinct_id !== previous_distinct_id && isKnownAnonymous) {\n            this.persistence.set_user_state('identified')\n\n            // Update current user properties\n            this.setPersonPropertiesForFlags(userPropertiesToSet || {}, false)\n\n            this.capture(\n                '$identify',\n                {\n                    distinct_id: new_distinct_id,\n                    $anon_distinct_id: previous_distinct_id,\n                },\n                { $set: userPropertiesToSet || {}, $set_once: userPropertiesToSetOnce || {} }\n            )\n            // let the reload feature flag request know to send this previous distinct id\n            // for flag consistency\n            this.featureFlags.setAnonymousDistinctId(previous_distinct_id)\n        } else if (userPropertiesToSet || userPropertiesToSetOnce) {\n            // If the distinct_id is not changing, but we have user properties to set, we can go for a $set event\n            this.setPersonProperties(userPropertiesToSet, userPropertiesToSetOnce)\n        }\n\n        // Reload active feature flags if the user identity changes.\n        // Note we don't reload this on property changes as these get processed async\n        if (new_distinct_id !== previous_distinct_id) {\n            this.reloadFeatureFlags()\n            // also clear any stored flag calls\n            this.unregister(FLAG_CALL_REPORTED)\n        }\n    }\n\n    /**\n     * Sets properties for the Person associated with the current distinct_id.\n     *\n     *\n     * @param {Object} [userPropertiesToSet] Optional: An associative array of properties to store about the user\n     * @param {Object} [userPropertiesToSetOnce] Optional: An associative array of properties to store about the user. If property is previously set, this does not override that value.\n     */\n    setPersonProperties(userPropertiesToSet?: Properties, userPropertiesToSetOnce?: Properties): void {\n        if (!userPropertiesToSet && !userPropertiesToSetOnce) {\n            return\n        }\n\n        // Update current user properties\n        this.setPersonPropertiesForFlags(userPropertiesToSet || {})\n\n        this.capture('$set', { $set: userPropertiesToSet || {}, $set_once: userPropertiesToSetOnce || {} })\n    }\n\n    /**\n     * Alpha feature: don't use unless you know what you're doing!\n     *\n     * Sets group analytics information for subsequent events and reloads feature flags.\n     *\n     * @param {String} groupType Group type (example: 'organization')\n     * @param {String} groupKey Group key (example: 'org::5')\n     * @param {Object} groupPropertiesToSet Optional properties to set for group\n     */\n    group(groupType: string, groupKey: string, groupPropertiesToSet?: Properties): void {\n        if (!groupType || !groupKey) {\n            console.error('posthog.group requires a group type and group key')\n            return\n        }\n\n        this._captureMetrics.incr('group')\n\n        const existingGroups = this.getGroups()\n\n        // if group key changes, remove stored group properties\n        if (existingGroups[groupType] !== groupKey) {\n            this.resetGroupPropertiesForFlags(groupType)\n        }\n\n        this.register({ $groups: { ...existingGroups, [groupType]: groupKey } })\n\n        if (groupPropertiesToSet) {\n            this.capture('$groupidentify', {\n                $group_type: groupType,\n                $group_key: groupKey,\n                $group_set: groupPropertiesToSet,\n            })\n            this.setGroupPropertiesForFlags({ [groupType]: groupPropertiesToSet })\n        }\n\n        // If groups change and no properties change, reload feature flags.\n        // The property change reload case is handled in setGroupPropertiesForFlags.\n        if (existingGroups[groupType] !== groupKey && !groupPropertiesToSet) {\n            this.reloadFeatureFlags()\n        }\n    }\n\n    /**\n     * Resets only the group properties of the user currently logged in.\n     */\n    resetGroups(): void {\n        this.register({ $groups: {} })\n        this.resetGroupPropertiesForFlags()\n\n        // If groups changed, reload feature flags.\n        this.reloadFeatureFlags()\n    }\n\n    /**\n     * Set override person properties for feature flags.\n     * This is used when dealing with new persons / where you don't want to wait for ingestion\n     * to update user properties.\n     */\n    setPersonPropertiesForFlags(properties: Properties, reloadFeatureFlags = true): void {\n        this.featureFlags.setPersonPropertiesForFlags(properties, reloadFeatureFlags)\n    }\n\n    resetPersonPropertiesForFlags(): void {\n        this.featureFlags.resetPersonPropertiesForFlags()\n    }\n\n    /**\n     * Set override group properties for feature flags.\n     * This is used when dealing with new groups / where you don't want to wait for ingestion\n     * to update properties.\n     * Takes in an object, the key of which is the group type.\n     * For example:\n     *     setGroupPropertiesForFlags({'organization': { name: 'CYZ', employees: '11' } })\n     */\n    setGroupPropertiesForFlags(properties: { [type: string]: Properties }, reloadFeatureFlags = true): void {\n        this.featureFlags.setGroupPropertiesForFlags(properties, reloadFeatureFlags)\n    }\n\n    resetGroupPropertiesForFlags(group_type?: string): void {\n        this.featureFlags.resetGroupPropertiesForFlags(group_type)\n    }\n\n    /**\n     * Clears super properties and generates a new random distinct_id for this instance.\n     * Useful for clearing data when a user logs out.\n     */\n    reset(reset_device_id?: boolean): void {\n        const device_id = this.get_property('$device_id')\n        this.persistence.clear()\n        this.sessionPersistence.clear()\n        this.persistence.set_user_state('anonymous')\n        this.sessionManager.resetSessionId()\n        const uuid = this.get_config('get_device_id')(this.uuidFn())\n        this.register_once(\n            {\n                distinct_id: uuid,\n                $device_id: reset_device_id ? uuid : device_id,\n            },\n            ''\n        )\n    }\n\n    /**\n     * Returns the current distinct id of the user. This is either the id automatically\n     * generated by the library or the id that has been passed by a call to identify().\n     *\n     * ### Notes:\n     *\n     * get_distinct_id() can only be called after the PostHog library has finished loading.\n     * init() has a loaded function available to handle this automatically. For example:\n     *\n     *     // set distinct_id after the posthog library has loaded\n     *     posthog.init('YOUR PROJECT TOKEN', {\n     *         loaded: function(posthog) {\n     *             distinct_id = posthog.get_distinct_id();\n     *         }\n     *     });\n     */\n    get_distinct_id(): string {\n        return this.get_property('distinct_id')\n    }\n\n    getGroups(): Record<string, any> {\n        return this.get_property('$groups') || {}\n    }\n\n    /**\n     * Returns the current session_id.\n     *\n     * NOTE: This should only be used for informative purposes.\n     * Any actual internal use case for the session_id should be handled by the sessionManager.\n     */\n\n    get_session_id(): string {\n        return this.sessionManager.checkAndGetSessionAndWindowId(true).sessionId\n    }\n\n    /**\n     * Returns the Replay url for the current session.\n     *\n     * @param options Options for the url\n     * @param options.withTimestamp Whether to include the timestamp in the url (defaults to false)\n     * @param options.timestampLookBack How many seconds to look back for the timestamp (defaults to 10)\n     */\n    get_session_replay_url(options?: { withTimestamp?: boolean; timestampLookBack?: number }): string {\n        const host = this.config.ui_host || this.config.api_host\n        const { sessionId, sessionStartTimestamp } = this.sessionManager.checkAndGetSessionAndWindowId(true)\n        let url = host + '/replay/' + sessionId\n        if (options?.withTimestamp && sessionStartTimestamp) {\n            const LOOK_BACK = options.timestampLookBack ?? 10\n            if (!sessionStartTimestamp) {\n                return url\n            }\n            const recordingStartTime = Math.max(\n                Math.floor((new Date().getTime() - sessionStartTimestamp) / 1000) - LOOK_BACK,\n                0\n            )\n            url += `?t=${recordingStartTime}`\n        }\n\n        return url\n    }\n\n    /**\n     * Create an alias, which PostHog will use to link two distinct_ids going forward (not retroactively).\n     * Multiple aliases can map to the same original ID, but not vice-versa. Aliases can also be chained - the\n     * following is a valid scenario:\n     *\n     *     posthog.alias('new_id', 'existing_id');\n     *     ...\n     *     posthog.alias('newer_id', 'new_id');\n     *\n     * If the original ID is not passed in, we will use the current distinct_id - probably the auto-generated GUID.\n     *\n     * ### Notes:\n     *\n     * The best practice is to call alias() when a unique ID is first created for a user\n     * (e.g., when a user first registers for an account and provides an email address).\n     * alias() should never be called more than once for a given user, except to\n     * chain a newer ID to a previously new ID, as described above.\n     *\n     * @param {String} alias A unique identifier that you want to use for this user in the future.\n     * @param {String} [original] The current identifier being used for this user.\n     */\n    alias(alias: string, original?: string): CaptureResult | void | number {\n        // If the $people_distinct_id key exists in persistence, there has been a previous\n        // posthog.people.identify() call made for this user. It is VERY BAD to make an alias with\n        // this ID, as it will duplicate users.\n        if (alias === this.get_property(PEOPLE_DISTINCT_ID_KEY)) {\n            logger.critical('Attempting to create alias for existing People user - aborting.')\n            return -2\n        }\n\n        if (_isUndefined(original)) {\n            original = this.get_distinct_id()\n        }\n        if (alias !== original) {\n            this._register_single(ALIAS_ID_KEY, alias)\n            return this.capture('$create_alias', { alias: alias, distinct_id: original })\n        } else {\n            console.error('alias matches current distinct_id - skipping api call.')\n            this.identify(alias)\n            return -1\n        }\n    }\n\n    /**\n     * Update the configuration of a posthog library instance.\n     *\n     * The default config is:\n     *\n     *     {\n     *       // PostHog API host\n     *       api_host: 'https://e.abla.io',\n     *\n     *       // HTTP method for capturing requests\n     *       api_method: 'POST'\n     *\n     *       // PostHog web app host, currently only used by the Sentry integration.\n     *       // This will only be different from api_host when using a reverse-proxied API host – in that case\n     *       // the original web app host needs to be passed here so that links to the web app are still convenient.\n     *       ui_host: 'https://e.abla.io',\n     *\n     *       // Automatically capture clicks, form submissions and change events\n     *       autocapture: true\n     *\n     *       // Capture rage clicks\n     *       rageclick: true\n     *\n     *       // transport for sending requests ('XHR' or 'sendBeacon')\n     *       // NB: sendBeacon should only be used for scenarios such as\n     *       // page unload where a \"best-effort\" attempt to send is\n     *       // acceptable; the sendBeacon API does not support callbacks\n     *       // or any way to know the result of the request. PostHog\n     *       // capturing via sendBeacon will not support any event-\n     *       // batching or retry mechanisms.\n     *       api_transport: 'XHR'\n     *\n     *       // super properties cookie expiration (in days)\n     *       cookie_expiration: 365\n     *\n     *       // super properties span subdomains\n     *       cross_subdomain_cookie: true\n     *\n     *       // debug mode\n     *       debug: false\n     *\n     *       // if this is true, the posthog cookie or localStorage entry\n     *       // will be deleted, and no user persistence will take place\n     *       disable_persistence: false\n     *\n     *       // if this is true, PostHog will automatically determine\n     *       // City, Region and Country data using the IP address of\n     *       //the client\n     *       ip: true\n     *\n     *       // opt users out of capturing by this PostHog instance by default\n     *       opt_out_capturing_by_default: false\n     *\n     *       // opt users out of browser data storage by this PostHog instance by default\n     *       opt_out_persistence_by_default: false\n     *\n     *       // persistence mechanism used by opt-in/opt-out methods - cookie\n     *       // or localStorage - falls back to cookie if localStorage is unavailable\n     *       opt_out_capturing_persistence_type: 'localStorage'\n     *\n     *       // customize the name of cookie/localStorage set by opt-in/opt-out methods\n     *       opt_out_capturing_cookie_prefix: null\n     *\n     *       // type of persistent store for super properties (cookie/\n     *       // localStorage) if set to 'localStorage', any existing\n     *       // posthog cookie value with the same persistence_name\n     *       // will be transferred to localStorage and deleted\n     *       persistence: 'cookie'\n     *\n     *       // name for super properties persistent store\n     *       persistence_name: ''\n     *\n     *       // names of properties/superproperties which should never\n     *       // be sent with capture() calls\n     *       property_blacklist: []\n     *\n     *       // if this is true, posthog cookies will be marked as\n     *       // secure, meaning they will only be transmitted over https\n     *       secure_cookie: false\n     *\n     *       // should we capture a page view on page load\n     *       capture_pageview: true\n     *\n     *       // if you set upgrade to be true, the library will check for\n     *       // a cookie from our old js library and import super\n     *       // properties from it, then the old cookie is deleted\n     *       // The upgrade config option only works in the initialization,\n     *       // so make sure you set it when you create the library.\n     *       upgrade: false\n     *\n     *       // if this is true, session recording is always disabled.\n     *       disable_session_recording: false,\n     *\n     *       // extra HTTP request headers to set for each API request, in\n     *       // the format {'Header-Name': value}\n     *       xhr_headers: {}\n     *\n     *       // protocol for fetching in-app message resources, e.g.\n     *       // 'https://' or 'http://'; defaults to '//' (which defers to the\n     *       // current page's protocol)\n     *       inapp_protocol: '//'\n     *\n     *       // whether to open in-app message link in new tab/window\n     *       inapp_link_new_window: false\n     *\n     *      // a set of rrweb config options that PostHog users can configure\n     *      // see https://github.com/rrweb-io/rrweb/blob/master/guide.md\n     *      session_recording: {\n     *         blockClass: 'ph-no-capture',\n     *         blockSelector: null,\n     *         ignoreClass: 'ph-ignore-input',\n     *         maskAllInputs: true,\n     *         maskInputOptions: {},\n     *         maskInputFn: null,\n     *         slimDOMOptions: {},\n     *         collectFonts: false\n     *      }\n     *\n     *      // prevent autocapture from capturing any attribute names on elements\n     *      mask_all_element_attributes: false\n     *\n     *      // prevent autocapture from capturing textContent on all elements\n     *      mask_all_text: false\n     *\n     *      // Anonymous users get a random UUID as their device by default.\n     *      // This option allows overriding that option.\n     *      get_device_id: (uuid) => uuid\n     *     }\n     *\n     *\n     * @param {Object} config A dictionary of new configuration values to update\n     */\n\n    set_config(config: Partial<PostHogConfig>): void {\n        const oldConfig = { ...this.config }\n        if (_isObject(config)) {\n            _extend(this.config, config)\n\n            if (!this.get_config('persistence_name')) {\n                this.config.persistence_name = this.config.cookie_name\n            }\n            if (!this.get_config('disable_persistence')) {\n                this.config.disable_persistence = this.config.disable_cookie\n            }\n\n            if (this.persistence) {\n                this.persistence.update_config(this.config)\n            }\n            if (this.sessionPersistence) {\n                this.sessionPersistence.update_config(this.config)\n            }\n            if (localStore.is_supported() && localStore.get('ph_debug') === 'true') {\n                this.config.debug = true\n            }\n            if (this.get_config('debug')) {\n                Config.DEBUG = true\n            }\n\n            if (this.sessionRecording && typeof config.disable_session_recording !== 'undefined') {\n                if (oldConfig.disable_session_recording !== config.disable_session_recording) {\n                    if (config.disable_session_recording) {\n                        this.sessionRecording.stopRecording()\n                    } else {\n                        this.sessionRecording.startRecordingIfEnabled()\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * turns session recording on, and updates the config option\n     * disable_session_recording to false\n     */\n    startSessionRecording(): void {\n        this.set_config({ disable_session_recording: false })\n    }\n\n    /**\n     * turns session recording off, and updates the config option\n     * disable_session_recording to true\n     */\n    stopSessionRecording(): void {\n        this.set_config({ disable_session_recording: true })\n    }\n\n    /**\n     * returns a boolean indicating whether session recording\n     * is currently running\n     */\n    sessionRecordingStarted(): boolean {\n        return !!this.sessionRecording?.started()\n    }\n\n    /**\n     * returns a boolean indicating whether the toolbar loaded\n     * @param toolbarParams\n     */\n\n    loadToolbar(params: ToolbarParams): boolean {\n        return this.toolbar.loadToolbar(params)\n    }\n\n    /**\n     * returns the current config object for the library.\n     */\n    get_config<K extends keyof PostHogConfig>(prop_name: K): PostHogConfig[K] {\n        return this.config?.[prop_name]\n    }\n\n    /**\n     * Returns the value of the super property named property_name. If no such\n     * property is set, get_property() will return the undefined value.\n     *\n     * ### Notes:\n     *\n     * get_property() can only be called after the PostHog library has finished loading.\n     * init() has a loaded function available to handle this automatically. For example:\n     *\n     *     // grab value for '$user_id' after the posthog library has loaded\n     *     posthog.init('YOUR PROJECT TOKEN', {\n     *         loaded: function(posthog) {\n     *             user_id = posthog.get_property('$user_id');\n     *         }\n     *     });\n     *\n     * @param {String} property_name The name of the super property you want to retrieve\n     */\n    get_property(property_name: string): Property | undefined {\n        return this.persistence['props'][property_name]\n    }\n\n    /**\n     * Returns the value of the session super property named property_name. If no such\n     * property is set, getSessionProperty() will return the undefined value.\n     *\n     * ### Notes:\n     *\n     * This is based on browser-level `sessionStorage`, NOT the PostHog session.\n     * getSessionProperty() can only be called after the PostHog library has finished loading.\n     * init() has a loaded function available to handle this automatically. For example:\n     *\n     *     // grab value for 'user_id' after the posthog library has loaded\n     *     posthog.init('YOUR PROJECT TOKEN', {\n     *         loaded: function(posthog) {\n     *             user_id = posthog.getSessionProperty('user_id');\n     *         }\n     *     });\n     *\n     * @param {String} property_name The name of the session super property you want to retrieve\n     */\n    getSessionProperty(property_name: string): Property | undefined {\n        return this.sessionPersistence['props'][property_name]\n    }\n\n    toString(): string {\n        let name = this.get_config('name') ?? PRIMARY_INSTANCE_NAME\n        if (name !== PRIMARY_INSTANCE_NAME) {\n            name = PRIMARY_INSTANCE_NAME + '.' + name\n        }\n        return name\n    }\n\n    // perform some housekeeping around GDPR opt-in/out state\n    _gdpr_init(): void {\n        const is_localStorage_requested = this.get_config('opt_out_capturing_persistence_type') === 'localStorage'\n\n        // try to convert opt-in/out cookies to localStorage if possible\n        if (is_localStorage_requested && localStore.is_supported()) {\n            if (!this.has_opted_in_capturing() && this.has_opted_in_capturing({ persistence_type: 'cookie' })) {\n                this.opt_in_capturing({ enable_persistence: false })\n            }\n            if (!this.has_opted_out_capturing() && this.has_opted_out_capturing({ persistence_type: 'cookie' })) {\n                this.opt_out_capturing({ clear_persistence: false })\n            }\n            this.clear_opt_in_out_capturing({\n                persistence_type: 'cookie',\n                enable_persistence: false,\n            })\n        }\n\n        // check whether the user has already opted out - if so, clear & disable persistence\n        if (this.has_opted_out_capturing()) {\n            this._gdpr_update_persistence({ clear_persistence: true })\n\n            // check whether we should opt out by default\n            // note: we don't clear persistence here by default since opt-out default state is often\n            //       used as an initial state while GDPR information is being collected\n        } else if (\n            !this.has_opted_in_capturing() &&\n            (this.get_config('opt_out_capturing_by_default') || cookieStore.get('ph_optout'))\n        ) {\n            cookieStore.remove('ph_optout')\n            this.opt_out_capturing({\n                clear_persistence: this.get_config('opt_out_persistence_by_default'),\n            })\n        }\n    }\n\n    /**\n     * Enable or disable persistence based on options\n     * only enable/disable if persistence is not already in this state\n     * @param {boolean} [options.clear_persistence] If true, will delete all data stored by the sdk in persistence and disable it\n     * @param {boolean} [options.enable_persistence] If true, will re-enable sdk persistence\n     */\n    _gdpr_update_persistence(options: Partial<OptInOutCapturingOptions>): void {\n        let disabled\n        if (options && options['clear_persistence']) {\n            disabled = true\n        } else if (options && options['enable_persistence']) {\n            disabled = false\n        } else {\n            return\n        }\n\n        if (!this.get_config('disable_persistence') && this.persistence.disabled !== disabled) {\n            this.persistence.set_disabled(disabled)\n        }\n        if (!this.get_config('disable_persistence') && this.sessionPersistence.disabled !== disabled) {\n            this.sessionPersistence.set_disabled(disabled)\n        }\n    }\n\n    // call a base gdpr function after constructing the appropriate token and options args\n    _gdpr_call_func<R = any>(\n        func: (token: string, options: GDPROptions) => R,\n        options?: Partial<OptInOutCapturingOptions>\n    ): R {\n        options = _extend(\n            {\n                capture: this.capture.bind(this),\n                persistence_type: this.get_config('opt_out_capturing_persistence_type'),\n                cookie_prefix: this.get_config('opt_out_capturing_cookie_prefix'),\n                cookie_expiration: this.get_config('cookie_expiration'),\n                cross_subdomain_cookie: this.get_config('cross_subdomain_cookie'),\n                secure_cookie: this.get_config('secure_cookie'),\n            },\n            options || {}\n        )\n\n        // check if localStorage can be used for recording opt out status, fall back to cookie if not\n        if (!localStore.is_supported() && options['persistence_type'] === 'localStorage') {\n            options['persistence_type'] = 'cookie'\n        }\n\n        return func(this.get_config('token'), {\n            capture: options['capture'],\n            captureEventName: options['capture_event_name'],\n            captureProperties: options['capture_properties'],\n            persistenceType: options['persistence_type'],\n            persistencePrefix: options['cookie_prefix'],\n            cookieExpiration: options['cookie_expiration'],\n            crossSubdomainCookie: options['cross_subdomain_cookie'],\n            secureCookie: options['secure_cookie'],\n        })\n    }\n\n    /**\n     * Opt the user in to data capturing and cookies/localstorage for this PostHog instance\n     *\n     * ### Usage\n     *\n     *     // opt user in\n     *     posthog.opt_in_capturing();\n     *\n     *     // opt user in with specific event name, properties, cookie configuration\n     *     posthog.opt_in_capturing({\n     *         capture_event_name: 'User opted in',\n     *         capture_event_properties: {\n     *             'Email': 'jdoe@example.com'\n     *         },\n     *         cookie_expiration: 30,\n     *         secure_cookie: true\n     *     });\n     *\n     * @param {Object} [options] A dictionary of config options to override\n     * @param {function} [options.capture] Function used for capturing a PostHog event to record the opt-in action (default is this PostHog instance's capture method)\n     * @param {string} [options.capture_event_name=$opt_in] Event name to be used for capturing the opt-in action\n     * @param {Object} [options.capture_properties] Set of properties to be captured along with the opt-in action\n     * @param {boolean} [options.enable_persistence=true] If true, will re-enable sdk persistence\n     * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n     * @param {string} [options.cookie_prefix=__ph_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n     * @param {Number} [options.cookie_expiration] Number of days until the opt-in cookie expires (overrides value specified in this PostHog instance's config)\n     * @param {boolean} [options.cross_subdomain_cookie] Whether the opt-in cookie is set as cross-subdomain or not (overrides value specified in this PostHog instance's config)\n     * @param {boolean} [options.secure_cookie] Whether the opt-in cookie is set as secure or not (overrides value specified in this PostHog instance's config)\n     */\n    opt_in_capturing(options?: Partial<OptInOutCapturingOptions>): void {\n        options = _extend(\n            {\n                enable_persistence: true,\n            },\n            options || {}\n        )\n\n        this._gdpr_call_func(optIn, options)\n        this._gdpr_update_persistence(options)\n    }\n\n    /**\n     * Opt the user out of data capturing and cookies/localstorage for this PostHog instance\n     *\n     * ### Usage\n     *\n     *     // opt user out\n     *     posthog.opt_out_capturing();\n     *\n     *     // opt user out with different cookie configuration from PostHog instance\n     *     posthog.opt_out_capturing({\n     *         cookie_expiration: 30,\n     *         secure_cookie: true\n     *     });\n     *\n     * @param {Object} [options] A dictionary of config options to override\n     * @param {boolean} [options.clear_persistence=true] If true, will delete all data stored by the sdk in persistence\n     * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n     * @param {string} [options.cookie_prefix=__ph_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n     * @param {Number} [options.cookie_expiration] Number of days until the opt-in cookie expires (overrides value specified in this PostHog instance's config)\n     * @param {boolean} [options.cross_subdomain_cookie] Whether the opt-in cookie is set as cross-subdomain or not (overrides value specified in this PostHog instance's config)\n     * @param {boolean} [options.secure_cookie] Whether the opt-in cookie is set as secure or not (overrides value specified in this PostHog instance's config)\n     */\n    opt_out_capturing(options?: Partial<OptInOutCapturingOptions>): void {\n        const _options = _extend(\n            {\n                clear_persistence: true,\n            },\n            options || {}\n        )\n\n        this._gdpr_call_func(optOut, _options)\n        this._gdpr_update_persistence(_options)\n    }\n\n    /**\n     * Check whether the user has opted in to data capturing and cookies/localstorage for this PostHog instance\n     *\n     * ### Usage\n     *\n     *     const has_opted_in = posthog.has_opted_in_capturing();\n     *     // use has_opted_in value\n     *\n     * @param {Object} [options] A dictionary of config options to override\n     * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n     * @param {string} [options.cookie_prefix=__ph_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n     * @returns {boolean} current opt-in status\n     */\n    has_opted_in_capturing(options?: Partial<OptInOutCapturingOptions>): boolean {\n        return this._gdpr_call_func(hasOptedIn, options)\n    }\n\n    /**\n     * Check whether the user has opted out of data capturing and cookies/localstorage for this PostHog instance\n     *\n     * ### Usage\n     *\n     *     const has_opted_out = posthog.has_opted_out_capturing();\n     *     // use has_opted_out value\n     *\n     * @param {Object} [options] A dictionary of config options to override\n     * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n     * @param {string} [options.cookie_prefix=__ph_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n     * @returns {boolean} current opt-out status\n     */\n    has_opted_out_capturing(options?: Partial<OptInOutCapturingOptions>): boolean {\n        return this._gdpr_call_func(hasOptedOut, options)\n    }\n\n    /**\n     * Clear the user's opt in/out status of data capturing and cookies/localstorage for this PostHog instance\n     *\n     * ### Usage\n     *\n     *     // clear user's opt-in/out status\n     *     posthog.clear_opt_in_out_capturing();\n     *\n     *     // clear user's opt-in/out status with specific cookie configuration - should match\n     *     // configuration used when opt_in_capturing/opt_out_capturing methods were called.\n     *     posthog.clear_opt_in_out_capturing({\n     *         cookie_expiration: 30,\n     *         secure_cookie: true\n     *     });\n     *\n     * @param {Object} [options] A dictionary of config options to override\n     * @param {boolean} [options.enable_persistence=true] If true, will re-enable sdk persistence\n     * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n     * @param {string} [options.cookie_prefix=__ph_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n     * @param {Number} [options.cookie_expiration] Number of days until the opt-in cookie expires (overrides value specified in this PostHog instance's config)\n     * @param {boolean} [options.cross_subdomain_cookie] Whether the opt-in cookie is set as cross-subdomain or not (overrides value specified in this PostHog instance's config)\n     * @param {boolean} [options.secure_cookie] Whether the opt-in cookie is set as secure or not (overrides value specified in this PostHog instance's config)\n     */\n    clear_opt_in_out_capturing(options?: Partial<OptInOutCapturingOptions>): void {\n        const _options: Partial<OptInOutCapturingOptions> = _extend(\n            {\n                enable_persistence: true,\n            },\n            options ?? {}\n        )\n        this._gdpr_call_func(clearOptInOut, _options)\n        this._gdpr_update_persistence(_options)\n    }\n\n    debug(debug?: boolean): void {\n        if (debug === false) {\n            window.console.log(\"You've disabled debug mode.\")\n            localStorage && localStorage.removeItem('ph_debug')\n            this.set_config({ debug: false })\n        } else {\n            window.console.log(\n                \"You're now in debug mode. All calls to PostHog will be logged in your console.\\nYou can disable this with `posthog.debug(false)`.\"\n            )\n            localStorage && localStorage.setItem('ph_debug', 'true')\n            this.set_config({ debug: true })\n        }\n    }\n}\n\n_safewrap_class(PostHog, ['identify'])\n\nconst instances: Record<string, PostHog> = {}\nconst extend_mp = function () {\n    // add all the sub posthog instances\n    _each(instances, function (instance, name) {\n        if (name !== PRIMARY_INSTANCE_NAME) {\n            posthog_master[name] = instance\n        }\n    })\n}\n\nconst override_ph_init_func = function () {\n    // we override the snippets init function to handle the case where a\n    // user initializes the posthog library after the script loads & runs\n    posthog_master['init'] = function (token?: string, config?: Partial<PostHogConfig>, name?: string) {\n        if (name) {\n            // initialize a sub library\n            if (!posthog_master[name]) {\n                posthog_master[name] = instances[name] = create_phlib(\n                    token || '',\n                    config || {},\n                    name,\n                    (instance: PostHog) => {\n                        posthog_master[name] = instances[name] = instance\n                        instance._loaded()\n                    }\n                )\n            }\n            return posthog_master[name]\n        } else {\n            let instance: PostHog = posthog_master as any as PostHog\n\n            if (instances[PRIMARY_INSTANCE_NAME]) {\n                // main posthog lib already initialized\n                instance = instances[PRIMARY_INSTANCE_NAME]\n            } else if (token) {\n                // intialize the main posthog lib\n                instance = create_phlib(token, config || {}, PRIMARY_INSTANCE_NAME, (instance: PostHog) => {\n                    instances[PRIMARY_INSTANCE_NAME] = instance\n                    instance._loaded()\n                })\n                instances[PRIMARY_INSTANCE_NAME] = instance\n            }\n\n            ;(posthog_master as any) = instance\n            if (init_type === InitType.INIT_SNIPPET) {\n                ;(window as any)[PRIMARY_INSTANCE_NAME] = posthog_master\n            }\n            extend_mp()\n            return instance\n        }\n    }\n}\n\nconst add_dom_loaded_handler = function () {\n    // Cross browser DOM Loaded support\n    function dom_loaded_handler() {\n        // function flag since we only want to execute this once\n        if ((dom_loaded_handler as any).done) {\n            return\n        }\n        ;(dom_loaded_handler as any).done = true\n\n        ENQUEUE_REQUESTS = false\n\n        _each(instances, function (inst: PostHog) {\n            inst._dom_loaded()\n        })\n    }\n\n    if (document.addEventListener) {\n        if (document.readyState === 'complete') {\n            // safari 4 can fire the DOMContentLoaded event before loading all\n            // external JS (including this file). you will see some copypasta\n            // on the internet that checks for 'complete' and 'loaded', but\n            // 'loaded' is an IE thing\n            dom_loaded_handler()\n        } else {\n            document.addEventListener('DOMContentLoaded', dom_loaded_handler, false)\n        }\n    }\n\n    // fallback handler, always will work\n    _register_event(window, 'load', dom_loaded_handler, true)\n}\n\nexport function init_from_snippet(): void {\n    init_type = InitType.INIT_SNIPPET\n    if (_isUndefined((window as any).posthog)) {\n        ;(window as any).posthog = []\n    }\n    posthog_master = (window as any).posthog\n\n    if (posthog_master['__loaded'] || (posthog_master['config'] && posthog_master['persistence'])) {\n        // lib has already been loaded at least once; we don't want to override the global object this time so bomb early\n        console.error('PostHog library has already been downloaded at least once.')\n        return\n    }\n\n    // Load instances of the PostHog Library\n    _each(posthog_master['_i'], function (item: [token: string, config: Partial<PostHogConfig>, name: string]) {\n        if (item && _isArray(item)) {\n            instances[item[2]] = create_phlib(...item)\n        }\n    })\n\n    override_ph_init_func()\n    ;(posthog_master['init'] as any)()\n\n    // Fire loaded events after updating the window's posthog object\n    _each(instances, function (instance) {\n        instance._loaded()\n    })\n\n    add_dom_loaded_handler()\n}\n\nexport function init_as_module(): PostHog {\n    init_type = InitType.INIT_MODULE\n    ;(posthog_master as any) = new PostHog()\n\n    override_ph_init_func()\n    ;(posthog_master['init'] as any)()\n    add_dom_loaded_handler()\n\n    return posthog_master as any\n}\n","import { SESSION_RECORDING_BATCH_KEY } from './extensions/sessionrecording'\n\n/**\n * Really a 429 response should have a `Retry-After` header which is either a date string,\n * or the number of seconds to wait before retrying\n *\n * But we can rate limit endpoints differently, so send custom header per endpoint\n * The endpoints are configurable, so we tie the headers/retries to specific batch keys\n *\n * And only support a number of seconds to wait before retrying\n */\nconst supportedRetryHeaders = {\n    'X-PostHog-Retry-After-Recordings': SESSION_RECORDING_BATCH_KEY,\n    'X-PostHog-Retry-After-Events': 'events',\n}\n\nexport class RateLimiter {\n    limits: Record<string, number> = {}\n\n    isRateLimited(batchKey: string | undefined): boolean {\n        const retryAfter = this.limits[batchKey || 'events'] || false\n\n        if (retryAfter === false) {\n            return false\n        }\n        return new Date().getTime() < retryAfter\n    }\n\n    on429Response(response: XMLHttpRequest): void {\n        if (response.status !== 429) {\n            return\n        }\n\n        Object.entries(supportedRetryHeaders).forEach(([header, batchKey]) => {\n            const responseHeader = response.getResponseHeader(header)\n            if (!responseHeader) {\n                return\n            }\n\n            let retryAfterSeconds = parseInt(responseHeader, 10)\n            if (isNaN(retryAfterSeconds)) {\n                retryAfterSeconds = 60\n            }\n\n            if (retryAfterSeconds) {\n                const retryAfterMillis = retryAfterSeconds * 1000\n                this.limits[batchKey] = new Date().getTime() + retryAfterMillis\n            }\n        })\n    }\n}\n","import { gzipSync, strToU8 } from 'fflate'\nimport { _base64Encode } from './utils'\nimport { Compression, CompressionData, XHROptions } from './types'\n\nexport function decideCompression(compressionSupport: Partial<Record<Compression, boolean>>): Compression {\n    if (compressionSupport[Compression.GZipJS]) {\n        return Compression.GZipJS\n    } else {\n        return Compression.Base64\n    }\n}\n\nexport function compressData(\n    compression: Compression,\n    jsonData: string,\n    options: XHROptions\n): [CompressionData | Uint8Array, XHROptions] {\n    if (compression === Compression.GZipJS) {\n        // :TRICKY: This returns an UInt8Array. We don't encode this to a string - returning a blob will do this for us.\n        return [\n            gzipSync(strToU8(jsonData), { mtime: 0 }),\n            { ...options, blob: true, urlQueryArgs: { compression: Compression.GZipJS } },\n        ]\n    } else {\n        return [{ data: _base64Encode(jsonData) }, options]\n    }\n}\n","import { init_as_module } from './posthog-core'\nexport { PostHog } from './posthog-core'\nexport * from './types'\nexport const posthog = init_as_module()\nexport default posthog\n"],"names":["Config","DEBUG","LIB_VERSION","Math","trunc","v","ceil","floor","Number","isInteger","value","isFinite","DIGITS","UUID","bytes","_classCallCheck","this","length","TypeError","_createClass","key","text","i","charAt","Error","slice","other","compareTo","diff","sign","unixTsMs","randA","randBHi","randBLo","RangeError","Uint8Array","pow","V7Generator","_defineProperty","DefaultRandom","generateOrAbort","undefined","timestamp","valueAfterReset","ts","Date","now","resetCounter","counter","fromFieldsV7","random","nextUint32","getRandomValues","buffer","UUIDV7_DENY_WEAK_RNG","crypto","defaultGenerator","Uint32Array","Infinity","cursor","uuidv7obj","generate","ArrayProto","Array","prototype","ObjProto","Object","toString","hasOwnProperty","win","window","navigator","userAgent","document","localDomains","nativeForEach","forEach","nativeIndexOf","indexOf","nativeIsArray","isArray","breaker","logger","log","_isUndefined","console","_len","arguments","args","_key","apply","err","_eachArray","arg","error","_len2","_args","_key2","critical","_len3","_key3","_trim","str","replace","obj","iterator","thisArg","l","call","_each","_extend","_len4","_key5","source","prop","_isArray","_isFunction","f","test","x","_includes","needle","_isObject","_isString","_isNumber","_timestamp","_safewrap","_len5","_key7","e","_strip_empty_properties","p","ret","k","LONG_STRINGS_ALLOW_LIST","_copyAndTruncateStrings","object","maxStringLength","customizer","COPY_IN_PROGRESS_SET","Set","internalDeepCircularCopy","has","add","result","it","push","val","_base64Encode","data","h1","h2","h3","h4","bits","b64","ac","enc","tmp_arr","_utf8Encode","charCodeAt","join","string","start","end","stringl","n","utftext","c1","String","fromCharCode","substring","_UUID","defaultVersion","T","d","valueOf","ticks","performance","version","se","screen","height","width","ch","ua","xor","byte_array","j","tmp","unshift","UA","_isBlockedUA","_getQueryParam","url","param","cleanParam","results","RegExp","exec","decodeURIComponent","_getHashParam","hash","matches","match","_register_event","fixEvent","event","preventDefault","stopPropagation","returnValue","cancelBubble","element","type","handler","oldSchool","useCapture","addEventListener","ontype","old_handler","new_handler","old_handlers","old_result","new_result","makeHandler","loadScript","scriptUrlToLoad","callback","addScript","scriptTag","createElement","src","onload","onerror","_scripts$0$parentNode","scripts","querySelectorAll","parentNode","insertBefore","body","appendChild","_info","campaignParams","customParams","campaign_keywords","concat","params","kwkey","kw","URL","searchEngine","referrer","search","searchInfo","keyword","browser","user_agent","vendor","opera","browserVersion","regex","Chrome","Safari","Opera","Firefox","Konqueror","BlackBerry","Mozilla","parseFloat","browserLanguage","language","userLanguage","os","os_name","os_version","device","deviceType","referringDomain","parser","href","host","properties","_info$os","$os","$os_version","$browser","$device","$device_type","$current_url","location","$host","$pathname","pathname","$browser_version","$browser_language","$screen_height","$screen_width","$viewport_height","innerHeight","$viewport_width","innerWidth","$lib","$lib_version","$insert_id","$time","people_properties","_info$os2","getClassName","el","className","baseVal","getAttribute","getSafeText","elText","shouldCaptureElement","isSensitiveElement","childNodes","child","isTextNode","textContent","split","filter","shouldCaptureValue","isElementNode","nodeType","isTag","tag","tagName","toLowerCase","isDocumentFragment","autocaptureCompatibleElements","curEl","classes","name","id","includes","getDirectAndNestedSpanText","target","getNestedSpanText","trim","_child$tagName","spanText","RageClick","enabled","clicks","y","lastClick","abs","DOMAIN_MATCH_REGEX","cookieStore","is_supported","msg","get","nameEQ","ca","cookie","c","parse","JSON","set","days","cross_subdomain","is_secure","cdomain","expires","secure","hostname","domain","date","setTime","getTime","toUTCString","new_cookie_val","encodeURIComponent","stringify","remove","_localStorage_supported","localStore","supported","localStorage","getItem","setItem","removeItem","localPlusCookieStore","_objectSpread","extend","distinct_id","memoryStorage","memoryStore","sessionStorageSupported","sessionStore","sessionStorage","PEOPLE_DISTINCT_ID_KEY","ALIAS_ID_KEY","EVENT_TIMERS_KEY","AUTOCAPTURE_DISABLED_SERVER_SIDE","SESSION_RECORDING_ENABLED_SERVER_SIDE","CONSOLE_LOG_RECORDING_ENABLED_SERVER_SIDE","SESSION_RECORDING_RECORDER_VERSION_SERVER_SIDE","SESSION_ID","ENABLED_FEATURE_FLAGS","PERSISTENCE_EARLY_ACCESS_FEATURES","STORED_PERSON_PROPERTIES_KEY","STORED_GROUP_PROPERTIES_KEY","SURVEYS","FLAG_CALL_REPORTED","USER_STATE","POSTHOG_QUOTA_LIMITED","RESERVED_PROPERTIES","CASE_INSENSITIVE_PERSISTENCE_TYPES","PostHogPersistence","config","token","props","campaign_params_saved","custom_campaign_params","storage_type","storage","user_state","load","update_config","save","_typeof","keys","found","disabled","entry","expire_days","default_value","_this","default_expiry","hasChanges","_this2","register","$referrer","$referring_domain","set_disabled","set_cross_subdomain","set_secure","event_name","timers","state","autocapture","_initializedTokens","_isDisabledServerSide","_isAutocaptureEnabled","_setIsAutocaptureEnabled","instance","_instance$persistence","disabled_server_side","persistence","enabled_client_side","get_config","_previousElementSibling","previousElementSibling","_el","previousSibling","_getAugmentPropertiesFromElement","elem","attributes","attr","propertyKey","propertyValue","_getPropertiesFromElement","maskInputs","maskText","tag_name","attributeName","nthChild","nthOfType","currentElem","_getDefaultProperties","eventType","$event_type","$ce_version","_extractCustomPropertyValue","customProperty","propValues","matchedElem","_getCustomProperties","targetElementList","_customProperties","eventSelector","eventElement","_getEventTarget","srcElement","_e$target","shadowRoot","composedPath","_captureEvent","_this$rageclicks","eventName","MouseEvent","rageclicks","isRageClick","clientX","clientY","autocaptureConfig","url_allowlist","allowlist","some","dom_event_allowlist","element_allowlist","elementType","css_selector_allowlist","selector","parentIsUsefulElement","compStyles","getComputedStyle","getPropertyValue","shouldCaptureDomEvent","elementsJson","autocaptureAugmentProperties","explicitNoCapture","shouldCaptureEl","augmentProperties","$elements","capture","_navigate","_addDomEventHandlers","_this3","init","_this$config","__autocapture","map","afterDecideResponse","response","enabledForProject","numBuckets","numEnabledBuckets","charCodeSum","isBrowserSupported","func","bind","_bind_instance_methods","_safewrap_instance_methods","PERSISTENCE_ACTIVE_FEATURE_FLAGS","PERSISTENCE_OVERRIDE_FEATURE_FLAGS","PERSISTENCE_FEATURE_FLAG_PAYLOADS","filterActiveFeatureFlags","featureFlags","_step","activeFeatureFlags","_iterator","_createForOfIteratorHelper","ownProps","resArray","_entries","s","done","_step$value","_slicedToArray","PostHogFeatureFlags","_override_warning","featureFlagEventHandlers","reloadFeatureFlagsQueued","reloadFeatureFlagsInAction","getFlagVariants","enabledFlags","get_property","overriddenFlags","finalFlags","overriddenKeys","warn","_startReloadTimer","anon_distinct_id","$anon_distinct_id","isPaused","setTimeout","_reloadFeatureFlagsRequest","setReloadingPaused","personProperties","groupProperties","encoded_data","get_distinct_id","groups","getGroups","person_properties","group_properties","disable_flags","_send_request","method","_prepare_callback","receivedFeatureFlags","options","decideEndpointWasHit","getFlags","flagValue","flagReportValue","flagCallReported","send_event","$feature_flag","$feature_flag_response","getFlagPayloads","getFeatureFlag","h","currentFlags","currentFlagPayloads","flags","flagPayloads","_persistence$register","$enabled_feature_flags","_persistence$register2","newFeatureFlags","newFeatureFlagPayloads","errorsWhileComputingFlags","parseFeatureFlagDecideResponse","_fireFeatureFlagsCallbacks","unregister","flagsObj","addFeatureFlagsHandler","_this$_prepareFeature","_prepareFeatureFlagsForCallbacks","flagVariants","removeFeatureFlagsHandler","isEnrolled","_this$instance$persis4","enrollmentPersonProp","$feature_enrollment","$set","setPersonPropertiesForFlags","newFlags","_this4","force_reload","existing_early_access_features","earlyAccessFeatures","flag","variantKey","reduce","res","_this$_prepareFeature2","reloadFeatureFlags","existingProperties","groupType","group_type","replacementImageURI","FULL_SNAPSHOT_EVENT_TYPE","META_EVENT_TYPE","INCREMENTAL_SNAPSHOT_EVENT_TYPE","PLUGIN_EVENT_TYPE","MUTATION_SOURCE_TYPE","MAX_MESSAGE_SIZE","CONSOLE_LOG_PLUGIN_NAME","IncrementalSource","MutationRateLimiter","rrweb","_this$options$refillR","_this$options$bucketS","mutationBuckets","refillRate","bucketSize","node","mirror","getNode","nodeName","Element","closestSVG","closest","getId","_data$removes$length","_data$removes","_data$attributes$leng","_data$attributes","_data$texts$length","_data$texts","_data$adds$length","_data$adds","removes","texts","adds","initialMutationCount","numberOfChanges","_this$mutationBuckets","_this$options$onBlock","_this$options","_this$getNodeOrReleva2","getNodeOrRelevantParent","nodeId","max","loggedTracker","onBlockedNode","mutationCount","setInterval","refillBuckets","BASE_ENDPOINT","SESSION_RECORDING_BATCH_KEY","ACTIVE_SOURCES","MouseMove","MouseInteraction","Scroll","ViewportResize","Input","TouchMove","MediaInteraction","Drag","SessionRecording","captureStarted","snapshots","emit","endpoint","stopRrweb","windowId","sessionId","receivedDecide","_flushBuffer","isRecordingEnabled","startCaptureAndTrySendingQueuedSnapshots","stopRecording","enabled_server_side","_this$instance$get_co","recordingVersion_server_side","recorderVersion","_response$sessionReco3","_response$sessionReco5","_response$sessionReco","_response$sessionReco2","_this$instance$persis","_response$sessionReco4","sessionRecording","consoleLogRecordingEnabled","startRecordingIfEnabled","message","_this$instance$sessio","level","onRRwebEmit","plugin","payload","trace","_captureSnapshotBuffered","_startCapture","assign","sessionManager","checkAndGetSessionAndWindowId","recorderJS","getRecordingVersion","__loaded_recorder_version","_onScriptLoaded","_event$data","isUserInteraction","_isInteractiveEvent","isIdle","lastActivityTimestamp","_tryTakeFullSnapshot","_this$instance$sessio2","_this$rrwebRecord","rrwebRecord","takeFullSnapshot","_this$mutationRateLim","sessionRecordingOptions","blockClass","blockSelector","ignoreClass","maskTextClass","maskTextSelector","maskTextFn","maskAllInputs","maskInputOptions","maskInputFn","slimDOMOptions","collectFonts","inlineStylesheet","recordCrossOriginIframes","record","userSessionRecordingOptions","entries","_i","_Object$entries","_Object$entries$_i","mutationRateLimiter","plugins","rrwebConsoleRecord","isConsoleLogCaptureEnabled","getRecordConsolePlugin","_addCaptureHook","_this4$rrwebRecord","addCustomEvent","rawEvent","throttledEvent","throttleMutations","_ensureMaxMessageSize","stringifiedData","matchAll","toLocaleLowerCase","size","ensureMaxMessageSize","_event","updatedPayload","truncateLargeConsoleLogs","_updateWindowAndSessionIds","$snapshot_bytes","$snapshot_data","$session_id","$window_id","_captureMetrics","incr","flushBufferTimer","clearTimeout","_captureSnapshot","_this$buffer","_this5","additionalBytes","transport","_noTruncate","_batchKey","_metrics","rrweb_full_snapshot","PERFORMANCE_EVENTS_MAPPING","entryType","timeOrigin","startTime","redirectStart","redirectEnd","workerStart","fetchStart","domainLookupStart","domainLookupEnd","connectStart","secureConnectionStart","connectEnd","requestStart","responseStart","responseEnd","decodedBodySize","encodedBodySize","initiatorType","nextHopProtocol","renderBlockingStatus","responseStatus","transferSize","renderTime","loadTime","domComplete","domContentLoadedEvent","domInteractive","loadEventEnd","loadEventStart","redirectCount","navigationType","unloadEventEnd","unloadEventStart","duration","ENTRY_TYPES_TO_OBSERVE","POSTHOG_PATHS_TO_IGNORE","WebPerformanceObserver","isEnabled","startObserving","stopObserving","_window","_window$PerformanceOb","observer","supportedEntryTypes","PerformanceObserver","_forceAllowLocalhost","list","getEntries","_capturePerformanceEvent","entryTypes","_this$observer","observe","buffered","disconnect","_ref","remoteEnabled","capturePerformance","path","find","networkRequest","maskNetworkRequestFn","eventJson","toJSON","capturePerformanceEvent","exposesServerTiming","serverTiming","_this$capturePerforma","timing","Decide","_hasBootstrappedFeatureFlags","verbose","parseDecideResponse","_this$instance$webPer","_this$instance$except","status","toolbar","webPerformance","exceptionAutocapture","compression","_step2","apiHost","_loop","_step2$value","scriptUrl","_iterator2","POSTHOG_MANAGED_HOSTS","Toolbar","toolbarParams","toolbarVersion","loadToolbar","history","stateHash","replaceState","title","userIntent","timestampToNearestThirtySeconds","toolbarUrl","endsWith","disableToolbarMetrics","apiURL","instrument","paramsToPersist","_objectWithoutProperties","_excluded","maybeLoadToolbar","GDPR_DEFAULT_PERSISTENCE_PREFIX","optIn","_optInOut","optOut","hasOptedIn","_getStorageValue","hasOptedOut","respectDnt","nav","hasDntOn","dntValue","_hasDoNotTrackFlagOn","clearOptInOut","_getStorage","_getStorageKey","crossSubdomainCookie","persistenceType","persistencePrefix","optValue","cookieExpiration","secureCookie","captureEventName","captureProperties","send_instantly","RequestQueueScaffold","pollInterval","isPolling","_event_queue","_empty_queue_count","_poller","_pollInterval","interval","poll","RequestQueue","_RequestQueueScaffold","_inherits","_super","_createSuper","captureMetrics","handlePollRequest","requests","formatQueue","_","dataKey","requestValues","values","r","request","CaptureMetrics","metrics","by","u8","u16","Uint16Array","u32","fleb","fdeb","clim","freb","eb","b","_a","fl","revfl","revfd","rev","hMap","cd","mb","co","le","rvb","sv","r_1","m","flt","fdt","flm","Compression","fdm","shft","slc","subarray","wbits","o","wbits16","hTree","t","t2","sort","a","i0","i1","i2","maxSym","tr","mbt","ln","dt","lft","cst","i2_1","i2_2","i2_3","lc","cl","cli","cln","cls","w","clen","cf","wfblk","out","pos","dat","wblk","final","syms","lf","df","li","bs","bl","dlt","mlb","_b","ddt","mdb","_c","lclt","nlc","_d","lcdt","ndc","lcfreq","_e","lct","mlcb","nlcc","lm","ll","dm","dl","flen","ftlen","dtlen","llm","lcts","clct","len","dst","deo","et","crct","crc","cr","dopt","opt","pre","post","st","lvl","plvl","lst","msk_1","prev","head","bs1_1","bs2_1","hsh","lc_1","wi","hv","imod","pimod","rem","ch_1","dif","maxn","min","maxd","ml","nl","mmd","md","ti","lin","din","dflt","mem","wbytes","gzh","fn","filename","mtime","gzhl","gzipSync","opts","strToU8","latin1","TextEncoder","encode","ar","ai","addParamsToURL","urlQueryArgs","parameterOptions","halves","argSeparator","formdata","use_val","use_key","arg_separator","tph_arr","_HTTPBuildQuery","encodePostData","blob","Blob","sendBeacon","body_data","xhr","headers","retriesPerformedSoFar","retryQueue","onXHRError","_ref$timeout","timeout","onRateLimited","req","XMLHttpRequest","open","headerValue","headerName","setRequestHeader","withCredentials","onreadystatechange","readyState","decr","responseText","enqueue","send","thirtyMinutes","RetryQueue","rateLimiter","queue","areWeOnline","onLine","_handleWeAreNowOnline","requestData","msToNextRetry","rawBackoffTime","minBackoff","cappedBackoffTime","jitter","pickNextRetryDelay","retryAt","flush","toFlush","_ref2","_executeXhrRequest","isRateLimited","_ref3","on429Response","MAX_SESSION_IDLE_TIMEOUT","MIN_SESSION_IDLE_TIMEOUT","SESSION_LENGTH_LIMIT","SessionIdManager","uuidFn","_windowId","_sessionId","_sessionStartTimestamp","_sessionActivityTimestamp","persistenceName","desiredTimeout","_sessionTimeoutMs","_window_id_storage_key","_primary_window_exists_storage_key","_canUseSessionStorage","lastWindowId","primaryWindowExists","_listenToReloadWindow","_sessionIdChangedHandlers","sessionActivityTimestamp","sessionStartTimestamp","_setSessionId","readOnly","_this$_getSessionId2","_getSessionId","lastTimestamp","startTimestamp","_getWindowId","sessionPastMaximumLength","valuesChanged","newTimestamp","_setWindowId","SentryIntegration","_posthog","organization","projectId","prefix","setupOnce","addGlobalEventProcessor","_event$exception","_exceptions$","_exceptions$2","_exceptions$3","_exceptions$4","__loaded","tags","ui_host","api_host","sessionRecordingStarted","get_session_replay_url","withTimestamp","exceptions","exception","$exception_message","$exception_type","$exception_personURL","$sentry_event_id","event_id","$sentry_exception","$sentry_exception_message","$sentry_exception_type","$sentry_tags","createSegmentIntegration","posthog","Promise","resolve","enrichEvent","ctx","userId","anonymousId","reset","additionalProperties","_calculate_event_properties","isLoaded","track","page","identify","PageViewIdManager","_seenFirstPageView","_pageViewId","isEvent","candidate","Event","isInstanceOf","base","isPrimitive","isBuiltin","isDOMError","WEBPACK_ERROR_REGEXP","STACKTRACE_FRAME_LIMIT","UNKNOWN_FUNCTION","createFrame","lineno","colno","frame","function","in_app","chromeRegex","chromeEvalRegex","geckoREgex","geckoEvalRegex","winjsRegex","defaultStackParser","parsers","sortedParsers","stack","skipFirst","frames","lines","line","cleanedLine","localStack","reverse","parts","subMatch","_extractSafariExtensi2","extractSafariExtensionDetails","_extractSafariExtensi4","isSafariExtension","isSafariWebExtension","ERROR_TYPES_PATTERN","reactMinifiedRegexp","parseStackFrames","ex","stacktrace","popSize","framesToPop","getPopSize","errorPropertiesFromError","$exception_stack_trace_raw","extractExceptionKeysForMessage","maxLength","serialized","errorToProperties","errorProperties","isDOMException","domException","isErrorWithStack","errorPropertiesFromString","code","isErrorEvent","isError","isPlainObject","constructor","errorPropertiesFromObject","$exception_is_synthetic","$exception_source","$exception_lineno","$exception_colno","SurveyType","SurveyQuestionType","ExceptionObserver","_console","_window$onerror","__POSTHOG_INSTRUMENTED__","originalOnErrorHandler","captureException","originalOnUnhandledRejectionHandler","onunhandledrejection","ev","reason","detail","_oO","$exception_handled","unhandledRejectionToProperties","sendExceptionEvent","stopCapturing","_window$onerror2","_window$onunhandledre","_window$onerror3","_this$remoteEnabled","autocaptureExceptionsResponse","autocaptureExceptions","errors_to_ignore","dropRules","errorsToIgnore","rule","startCapturing","debugLog","propertiesToSend","posthogHost","InitType","init_type","posthog_master","PostHogSurveys","forceReload","existingSurveys","surveys","getSurveys","targetingMatchedSurveys","survey","start_date","end_date","_survey$conditions","_survey$conditions2","conditions","urlCheck","selectorCheck","querySelector","linked_flag_key","targeting_flag_key","linkedFlagCheck","isFeatureEnabled","targetingFlagCheck","supportedRetryHeaders","RateLimiter","batchKey","retryAfter","limits","header","responseHeader","getResponseHeader","retryAfterSeconds","parseInt","isNaN","retryAfterMillis","__NOOP","__NOOPTIONS","PRIMARY_INSTANCE_NAME","USE_XHR","ENQUEUE_REQUESTS","defaultConfig","_document$location","_document$location$ho","_window$location","api_method","api_transport","rageclick","cross_subdomain_cookie","persistence_name","cookie_name","loaded","store_google","save_referrer","capture_pageview","capture_pageleave","debug","cookie_expiration","upgrade","disable_session_recording","disable_persistence","disable_cookie","enable_recording_console_log","secure_cookie","protocol","ip","opt_out_capturing_by_default","opt_out_persistence_by_default","opt_out_capturing_persistence_type","opt_out_capturing_cookie_prefix","opt_in_site_apps","property_blacklist","respect_dnt","sanitize_properties","xhr_headers","inapp_protocol","inapp_link_new_window","request_batching","properties_string_max_length","session_recording","mask_all_element_attributes","mask_all_text","advanced_disable_decide","advanced_disable_feature_flags","advanced_disable_feature_flags_on_first_load","advanced_disable_toolbar_metrics","on_xhr_error","statusText","get_device_id","uuid","_onCapture","_capture_metrics","capture_performance","callback_fn","bootstrap","disable_compression","session_idle_timeout_seconds","uuid_version","create_phlib","createComplete","callbacksHandled","initComplete","syncCode","handleCallback","callbackName","INIT_MODULE","PostHog","_init","startObservingIfEnabled","_execute_array","people","segmentIntegration","__captureHooks","__request_queue","_jsc","pageViewIdManager","_requestQueue","_retryQueue","sessionPersistence","to","setProps","setPersonProperties","set_once","_loaded","_window$rrweb","_config$bootstrap","_triggered_notifs","_window$rrweb2","segmentRegister","updateInitComplete","set_config","_handle_queued_event","_gdpr_init","segment","user","set_user_state","then","distinctID","_config$bootstrap2","_config$bootstrap3","deviceID","isIdentifiedID","$device_id","_config$bootstrap4","_config$bootstrap7","activeFlags","_config$bootstrap5","_config$bootstrap5$fe","_config$bootstrap6","_config$bootstrap6$fe","featureFlagPayloads","_config$bootstrap8","_config$bootstrap8$fe","_config$bootstrap9","_config$bootstrap9$fe","register_once","self","_handle_unload","_start_queue_if_opted_in","resetRequestQueue","has_opted_out_capturing","item","_toConsumableArray","jsc","randomized_cb","callback_string","updateUnloadMetrics","unload","jsonData","__compress_and_send_json_request","compressData","GZipJS","Base64","_compressData2","_compressData","_options","DEFAULT_OPTIONS","useSendBeacon","_s$parentNode","script","async","defer","getElementsByTagName","array","fn_name","alias_calls","other_calls","capturing_calls","execute","calls","caller","_this$config$bootstra","_this$config$bootstra2","_this$exceptionAutoca","silenceErrors","optedOut","userOptedOut","update_search_keyword","update_campaign_params","update_referrer_info","has_unique_traits","_invokeCaptureHooks","eventData","event_properties","_this$webPerformance","start_timestamp","remove_event_timer","persistenceProps","infoProperties","_this$sessionManager$","onPageview","$pageview_id","getPageViewId","duration_in_ms","toFixed","blacklisted_prop","property","getFeatureFlagPayload","_unused","updateEarlyAccessFeatureEnrollment","getEarlyAccessFeatures","onFeatureFlags","onSessionId","getActiveMatchingSurveys","new_distinct_id","userPropertiesToSet","userPropertiesToSetOnce","previous_distinct_id","$user_id","device_id","$had_persisted_distinct_id","isKnownAnonymous","get_user_state","$set_once","setAnonymousDistinctId","groupKey","groupPropertiesToSet","existingGroups","resetGroupPropertiesForFlags","$groups","$group_type","$group_key","$group_set","setGroupPropertiesForFlags","resetPersonPropertiesForFlags","reset_device_id","clear","resetSessionId","_this$sessionManager$2","_options$timestampLoo","LOOK_BACK","timestampLookBack","recordingStartTime","alias","original","_register_single","oldConfig","_this$sessionRecordin","started","prop_name","property_name","_this$get_config","has_opted_in_capturing","persistence_type","opt_in_capturing","enable_persistence","opt_out_capturing","clear_persistence","clear_opt_in_out_capturing","_gdpr_update_persistence","cookie_prefix","_gdpr_call_func","klass","functions","_safewrap_class","instances","override_ph_init_func","INIT_SNIPPET","add_dom_loaded_handler","dom_loaded_handler","inst","_dom_loaded"],"mappings":"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"}